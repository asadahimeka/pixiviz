(function(e){function t(t){for(var n,s,r=t[0],c=t[1],l=t[2],u=0,h=[];u<r.length;u++)s=r[u],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&h.push(a[s][0]),a[s]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);d&&d(t);while(h.length)h.shift()();return o.push.apply(o,l||[]),i()}function i(){for(var e,t=0;t<o.length;t++){for(var i=o[t],n=!0,r=1;r<i.length;r++){var c=i[r];0!==a[c]&&(n=!1)}n&&(o.splice(t--,1),e=s(s.s=i[0]))}return e}var n={},a={app:0},o=[];function s(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=n,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=t,r=r.slice();for(var l=0;l<r.length;l++)t(r[l]);var d=c;o.push([0,"chunk-core","chunk-basic","chunk-element","chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("56d7")},"0333":function(e,t,i){},"034f":function(e,t,i){"use strict";i("85ec")},"08dc":function(e,t,i){e.exports=i.p+"img/98606454.8e471ebe.jpg"},"09c8":function(e,t,i){},"0a36":function(e,t,i){},1:function(e,t){},10:function(e,t){},11:function(e,t){},12:function(e,t){},13:function(e,t){},14:function(e,t){},15:function(e,t){},16:function(e,t){},17:function(e,t){},18:function(e,t){},19:function(e,t){},"1b2e":function(e,t,i){"use strict";i("473d")},"1d25":function(e,t,i){"use strict";i("bd7d")},"1d40":function(e,t,i){},2:function(e,t){},20:function(e,t){},"205d":function(e,t,i){"use strict";i("c4c2")},"2c43":function(e,t,i){"use strict";i("9624")},"2f6a":function(e,t,i){},3:function(e,t){},"33f6":function(e,t,i){},3781:function(e,t,i){},"3cd8":function(e,t,i){},"3d57":function(e,t,i){"use strict";i("54e2")},4:function(e,t){},4433:function(e,t,i){},"473d":function(e,t,i){},5:function(e,t){},"54e2":function(e,t,i){},"56d7":function(e,t,i){"use strict";i.r(t);var n=i("1da1"),a=(i("e260"),i("e6cf"),i("cca6"),i("a79d"),i("96cf"),i("2b0e")),o=i("2b27"),s=i.n(o),r=i("dcd5"),c=i("0086"),l=i.n(c),d=i("3878"),u=i.n(d),h=i("e166"),m=i.n(h),p=i("7dc5"),g=(i("b265"),i("1d40"),i("ce50")),f=i.n(g),v=(i("09c8"),i("62ee")),w=i.n(v),b=(i("6abf"),i("e2a4")),k=i.n(b),y=(i("a4d1"),i("c882")),_=i.n(y),x=(i("a0bd"),i("9ade")),C=i.n(x),$=(i("0a36"),i("52d4")),S=i.n($),T=(i("3781"),i("3fea")),I=i.n(T),O=(i("3cd8"),i("77b8")),E=i.n(O),L=(i("bbe2"),i("7180")),z=i.n(L),W=(i("dfa3"),i("85d4")),j=i.n(W),D=(i("2f6a"),i("016f")),M=i.n(D),R=(i("beef"),i("6cda")),A=i.n(R),P=(i("0333"),i("8f69")),F=i.n(P),N=(i("4433"),i("3c57")),U=i.n(N),H=(i("6f27"),i("dbb4")),B=i.n(H),q=(i("974a"),i("8d48")),V=i.n(q);i("adbb");a["default"].use(V.a),a["default"].use(B.a),a["default"].use(U.a),a["default"].use(F.a),a["default"].use(A.a),a["default"].use(M.a),a["default"].use(j.a),a["default"].use(z.a),a["default"].use(E.a),a["default"].use(I.a),a["default"].use(S.a),a["default"].use(C.a),a["default"].use(_.a),a["default"].prototype.$confirm=k.a.confirm,a["default"].prototype.$message=w.a,a["default"].prototype.$notify=f.a;i("33f6"),i("a27f"),i("e9c4");var G=i("5353"),Y=i.n(G),J=i("ddc3"),Q=i.n(J),K=Y()(Q()("pixiviz-data")),X={get:function(e){return Object(n["a"])(regeneratorRuntime.mark((function t(){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,K.get(e,{asBuffer:!1});case 3:return i=t.sent,t.abrupt("return",JSON.parse(i));case 7:if(t.prev=7,t.t0=t["catch"](0),!t.t0.notFound){t.next=11;break}return t.abrupt("return",null);case 11:throw t.t0;case 12:case"end":return t.stop()}}),t,null,[[0,7]])})))()},set:function(e,t){return Object(n["a"])(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,K.put(e,JSON.stringify(t));case 2:case"end":return i.stop()}}),i)})))()}},Z=i("2f62"),ee=(i("498a"),function(){window.addEventListener("storage",(function(){var e=window.localStorage.getItem("enable-dark");"true"===e?!document.documentElement.classList.contains("dark")&&document.documentElement.classList.add("dark"):document.documentElement.classList.contains("dark")&&document.documentElement.classList.remove("dark")}))}),te=function(){setTimeout((function(){var e=document.querySelector('meta[name="theme-color"]'),t=window.getComputedStyle(document.documentElement).getPropertyValue("--background-primary").trim();e.setAttribute("content",t)}))},ie={enabled:window.pixiviz.darkMode},ne={setEnabled:function(e,t){e.enabled=t,window.pixiviz.darkEnabled=t,window.localStorage.setItem("enable-dark",t),t?!document.documentElement.classList.contains("dark")&&document.documentElement.classList.add("dark"):document.documentElement.classList.contains("dark")&&document.documentElement.classList.remove("dark"),te()}},ae={namespaced:!0,state:ie,mutations:ne},oe={expanded:!1},se={setExpanded:function(e,t){e.expanded=t}},re={namespaced:!0,state:oe,mutations:se},ce={images:null,page:null,mode:null,date:null},le={setImages:function(e,t){e.images=t},setPage:function(e,t){e.page=t},setMode:function(e,t){e.mode=t},setDate:function(e,t){e.date=t}},de={namespaced:!0,state:ce,mutations:le},ue={keyword:null,images:null,page:null,suggestions:null,mode:"pic"},he={setKeyword:function(e,t){e.keyword=t},setImages:function(e,t){e.images=t},setPage:function(e,t){e.page=t},setSuggestions:function(e,t){e.suggestions=t},setMode:function(e,t){e.mode=t}},me={namespaced:!0,state:ue,mutations:he},pe={keyword:null,artists:null,page:null},ge={setKeyword:function(e,t){e.keyword=t},setArtists:function(e,t){e.artists=t},setPage:function(e,t){e.page=t}},fe={namespaced:!0,state:pe,mutations:ge},ve={image:null},we={setCache:function(e,t){e.image=t},destroy:function(e){e.image=null}},be={namespaced:!0,state:ve,mutations:we},ke=(i("d81d"),{id:null,images:{},page:{},map:{}}),ye={setId:function(e,t){e.id=t},setImages:function(e,t){e.images[t.id]=t.images},setPage:function(e,t){e.page[t.id]=t.page},setMapItem:function(e,t){e.map[t.id]=t.content}},_e={namespaced:!0,state:ke,mutations:ye},xe=(i("a434"),i("c740"),i("b0c0"),{list:[]}),Ce={addItem:function(e,t){e.list.push(t)},removeItem:function(e,t){e.list.splice(e.list.findIndex((function(e){return e.name===t})),1)}},$e={hasName:function(e){return function(t){return e.list.findIndex((function(e){return e.name===t}))>-1}}},Se={namespaced:!0,state:xe,mutations:Ce,getters:$e},Te={progress:0,ugoiraProgress:0,ugoiraStatus:null},Ie={setProgress:function(e,t){e.progress=t},setUgoiraProgress:function(e,t){e.ugoiraProgress=t},setUgoiraStatus:function(e,t){e.ugoiraStatus=t}},Oe={namespaced:!0,state:Te,mutations:Ie};a["default"].use(Z["a"]);var Ee=new Z["a"].Store({state:{showNSFW:!!localStorage.getItem("pz_showNSFW")||!1},modules:{darkMode:ae,landingBanner:re,rank:de,search:me,userSearch:fe,imageCache:be,artist:_e,download:Se,pic:Oe}}),Le=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[i("transition",{attrs:{mode:"out-in"}},[e.$route.meta.keepAlive?i("keep-alive",[i("router-view")],1):i("router-view")],1),i("transition-group",{staticClass:"right-tag-wrapper",attrs:{mode:"out-in","enter-active-class":"right-tag-in","leave-to-class":"right-tag-out"}},[e.showDownloadList?i("DownloadListTag",{key:"downloadList"}):e._e()],1),i("DownloadList"),i("Maintain",{ref:"maintain",attrs:{text:e.maintainText}})],1)},ze=[],We=i("5530"),je=(i("ac1f"),i("00b4"),i("5319"),i("99af"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"right-tag right-tag-clickable tag-download",on:{click:e.handleClick}},[i("span",[e._v("图片下载中 ("+e._s(e.donwloadCount)+")")])])}),De=[],Me={computed:{donwloadCount:function(){return this.$store.state.download.list.length}},methods:{handleClick:function(){this.$bus.$emit("openDownloadList")}}},Re=Me,Ae=i("2877"),Pe=Object(Ae["a"])(Re,je,De,!1,null,null,null),Fe=Pe.exports,Ne=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-drawer",{staticClass:"download-list",attrs:{title:"下载列表",visible:e.showDrawer},on:{"update:visible":function(t){e.showDrawer=t},"before-close":e.handleClose}},[e.empty?[i("span",{staticClass:"download-list-empty"},[e._v("当前没有进行中的下载...")])]:e._l(e.items,(function(e){return i("DonwloadListItem",{key:e.key,attrs:{item:e}})}))],2)},Ue=[],He=(i("d3b7"),i("159b"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"download-list-item"},[i("div",{staticClass:"download-list-item-head"},[i("div",{staticClass:"download-list-item-head__name"},[i("span",[e._v(e._s(e.item.name))])]),i("div",{staticClass:"download-list-item-head__progress"},[i("span",[e._v(e._s(e.item.progress)+"%")])])]),i("div",{staticClass:"download-list-item-bar",style:e.barStyle})])}),Be=[],qe={props:{item:{type:Object,default:function(){return{name:"",progress:0}}}},computed:{barStyle:function(){var e=this.item.progress;return this.$store.state.darkMode.enabled?"background-image: linear-gradient(to right, #d7707c 0%, #d7707c ".concat(e,"%, #424242 ").concat(e,"%, #424242 100%) !important;"):"background-image: linear-gradient(to right, #8F77B5 0%, #8F77B5 ".concat(e,"%, #eaeaea ").concat(e,"%, #eaeaea 100%) !important;")}}},Ve=qe,Ge=Object(Ae["a"])(Ve,He,Be,!1,null,null,null),Ye=Ge.exports,Je={components:{DonwloadListItem:Ye},data:function(){return{showDrawer:!1,items:[]}},created:function(){this.$bus.$on("openDownloadList",this.show)},computed:{empty:function(){return this.$store.state.download.list<1}},methods:{show:function(){this.showDrawer||(this.showDrawer=!0),this.refreshList(),this.timer=setInterval(this.refreshList,1e3)},handleClose:function(){clearInterval(this.timer),this.timer=null},refreshList:function(){var e=this.$store.state.download.list;if(!(e.length<1)){var t=[];e.forEach((function(e,i){t.push({key:"".concat(e.name,"_").concat(i),name:e.name,progress:e.image.percent||0})})),this.items=t}}}},Qe=Je,Ke=Object(Ae["a"])(Qe,Ne,Ue,!1,null,null,null),Xe=Ke.exports,Ze=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.display?i("div",{staticClass:"maintain-wrapper"},[i("div",{staticClass:"maintain"},[i("div",{staticClass:"maintain-icon"},[i("Construction")],1),i("div",{staticClass:"maintain-text"},[e._m(0),e.displayText?i("div",{class:{"maintain-text--custom":!0,"maintain-text--custom-long":e.isLongText}},[i("span",[e._v(e._s(e.displayText))])]):e._e()])]),i("div",{staticClass:"maintain-footer"},[i("span",[e._v("Pixiviz v"+e._s(e.version))])])]):e._e()},et=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"maintain-text--default"},[i("span",[e._v("站点维护中")])])}],tt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("svg",{attrs:{viewBox:"0 0 64 64"}},[i("path",{attrs:{d:"M61.063 17h-8.438v-2.148a6.564 6.564 0 1 0-3.75 0V17h-33.75v-2.148A6.564 6.564 0 0 0 13.25 2a6.562 6.562 0 0 0-1.874 12.852V17H2.938a.937.937 0 0 0-.938.938v18.75c0 .519.419.938.938.938h8.438v6.563H7.938v3.75h3.437v10.752C11.375 59.53 9.5 62 9.5 62H17s-1.875-2.47-1.875-3.311V47.938h33.75V58.69C48.875 59.53 47 62 47 62h7.5s-1.875-2.47-1.875-3.311V47.938h3.437v-3.75h-3.437v-6.563h8.438a.937.937 0 0 0 .938-.938v-18.75a.938.938 0 0 0-.938-.937m-20.704 1.875h9.907L43.292 35.75h-9.905l6.972-16.875M8.563 8.563c0-2.587 2.099-4.688 4.688-4.688s4.688 2.101 4.688 4.688a4.688 4.688 0 0 1-9.376 0M4.145 35.468a.93.93 0 0 1-.27-.655v-15c0-.519.419-.938.938-.938h6.579L4.145 35.468m9.105 11.283a.688.688 0 1 1 0-1.376a.688.688 0 0 1 0 1.376m.053-11.001l7.372-16.875h9.94L23.641 35.75H13.303m35.572 8.438h-33.75v-6.563h33.75v6.563m1.875 2.563a.688.688 0 1 1 0-1.376a.688.688 0 0 1 0 1.376m0-33.501a4.688 4.688 0 1 1 0-9.376a4.688 4.688 0 0 1 0 9.376m9.375 21.563a.937.937 0 0 1-.938.938h-6.149l6.842-16.557a.927.927 0 0 1 .245.619v15",fill:"currentColor"}})])},it=[],nt={name:"EmojioneMonotoneConstruction"},at=nt,ot=Object(Ae["a"])(at,tt,it,!1,null,null,null),st=ot.exports,rt="1.29.1";console.log("%cPixiviz - v1.29.1\nEnvironment - prod\nBuild time: 2023-07-09 17:06:32","color:#8F77B5");var ct,lt={props:{text:{type:String,default:""}},components:{Construction:st},data:function(){return{display:!1,version:rt}},computed:{displayText:function(){return this.text?this.text.trim():null},isLongText:function(){return this.text.length>14}},methods:{show:function(){this.display=!0}}},dt=lt,ut=Object(Ae["a"])(dt,Ze,et,!1,null,null,null),ht=ut.exports,mt=function(){return/MicroMessenger/i.test(window.navigator.userAgent)},pt=i("2909"),gt=!1,ft=[],vt=function e(t,i,n){if(gt)ft.push([t,i,n]);else{gt=!0;var a=document.createElement("div"),o=document.createElement("span");a.classList.add("bottom-notify"),a.classList.add("bottom-notify--".concat(t)),a.classList.add("fadeInUp"),o.innerText=i,a.appendChild(o);var s=Date.now();a.id="bottom-notify-".concat(s),document.body.appendChild(a),n&&setTimeout((function(){a.classList.remove("fadeInUp"),a.classList.add("fadeOutDown"),setTimeout((function(){document.body.removeChild(a),gt=!1,setTimeout((function(){if(ft.length){var t=ft.shift();e.call.apply(e,[null].concat(Object(pt["a"])(t)))}}),100)}),300)}),n+300)}},wt=i("3835"),bt=i("53ca"),kt=(i("4de4"),i("caad"),i("2532"),i("4e82"),i("b64b"),i("ea5a")),yt=i("5c8a"),_t=i("733f"),xt=new a["default"],Ct=xt,$t=i("bee2"),St=i("d4ec"),Tt=i("262e"),It=i("2caf"),Ot=i("9072"),Et=(i("d9e2"),i("13d5"),i("81b2"),i("0eb6"),i("b7ef"),i("8bd4"),i("b0d6")),Lt=function(){return Et.map((function(e){return decodeURIComponent(atob(e))}))},zt=[].concat(Object(pt["a"])(Lt()),["loli","ペド","恋童","幼女"]),Wt=["漫画素材工坊","描き方","お絵かきTIPS","ペド","恋童","幼女"].concat(Object(pt["a"])(zt)),jt=["漫画"],Dt=["loli","ペド","恋童","幼女"],Mt=function(e){if(e.x_restrict)return!1;if(e.caption){var t=zt.reduce((function(t,i){return t||(t||e.caption.includes(i))}),!1);if(t)return!1}var i=zt.reduce((function(t,i){return t||(t||e.title.includes(i))}),!1);return!i},Rt=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e.filter((function(e){if(!e)return!1;if("illust"!==e.type&&t||e.title.includes("漫画")&&t)return!1;var n=zt.reduce((function(t,i){return t||(t||e.title.includes(i))}),!1);if(n)return!1;var a=Dt.reduce((function(t,i){return t||(t||e.title.includes(i))}),!1);if(a)return!1;if(Array.isArray(e.tags)&&e.tags.length&&(i||t))for(var o=0;o<e.tags.length;o++){if(i&&Wt.includes(e.tags[o].name))return!1;if(t&&jt.includes(e.tags[o].name))return!1}return window.pixiviz.infoMap[e.id]||(window.pixiviz.infoMap[e.id]=e),!0}))},At=500,Pt="user-collection",Ft=null,Nt={},Ut=function(e){Object(Tt["a"])(i,e);var t=Object(It["a"])(i);function i(){return Object(St["a"])(this,i),t.apply(this,arguments)}return Object($t["a"])(i)}(Object(Ot["a"])(Error)),Ht=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t,i,n,a,o=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:{},i=t.bypass,n=void 0!==i&&i,!Ft||n){e.next=3;break}return e.abrupt("return",Ft);case 3:return e.t0=JSON,e.next=6,X.get(Pt);case 6:if(e.t1=e.sent,a=e.t0.parse.call(e.t0,e.t1),a){e.next=12;break}return Ft={},e.abrupt("return",Ft);case 12:return Ft||(Ft={}),Object.assign(Ft,a),Object.keys(Ft).forEach((function(e){Array.isArray(Ft[e])&&(Ft[e]=Ft[e].map((function(t){return t._ctime?("".concat(t._ctime).length>=13&&(t._ctime=Math.floor(Date.now()/1e3)),Nt[e]=Nt[e]||{},Nt[e][t.id]=!0,t):Object(We["a"])(Object(We["a"])({},t),{},{_ctime:Math.floor(Date.now()/1e3)})})),Ft[e]=Rt(Ft[e].sort((function(e,t){var i=e._otime||e._ctime,n=t._otime||t._ctime;return n-i})).filter((function(e){return!!e.image_urls})),!1,!1))})),e.abrupt("return",Ft);case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Bt=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,i){var n,a,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(Array.isArray(Ft[t])||(Ft[t]=[]),!(null!==(n=Ft[t])&&void 0!==n&&n.length&&(null===(a=Ft[t])||void 0===a?void 0:a.length)+1>At)){e.next=3;break}throw new Ut("exceeded size limit");case 3:return Nt[t]||(Nt[t]={}),Nt[t][i.id]&&(o=Ft[t].findIndex((function(e){return e.id===i.id})),o>=0&&Ft[t].splice(o,1)),Nt[t][i.id]=!0,Ft[t].unshift(Object(We["a"])(Object(We["a"])({},i),{},{_ctime:Math.floor(Date.now()/1e3)})),e.next=9,Yt();case 9:case"end":return e.stop()}}),e)})));return function(t,i){return e.apply(this,arguments)}}(),qt=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return Ft=t,Nt={},Object.keys(Ft).forEach((function(e){Ft[e]=Array.isArray(Ft[e])?Ft[e].filter((function(e){return!!e})):[],Ft[e].forEach((function(t){Nt[e]||(Nt[e]={}),Nt[e][t.id]=!0}))})),e.next=5,Yt();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Vt=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,i){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(Array.isArray(Ft[t])){e.next=2;break}throw new Ut("Category not found.");case 2:return n=Ft[t].findIndex((function(e){return e.id===i})),n>=0&&(Ft[t].splice(n,1),Nt[t][i]=!1),e.next=6,Yt();case 6:case"end":return e.stop()}}),e)})));return function(t,i){return e.apply(this,arguments)}}(),Gt=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(Ft){e.next=3;break}return e.next=3,Ht({bypass:!0});case 3:return e.abrupt("return",Object.keys(Ft).reduce((function(e,i){var n;return e||!(null===(n=Nt[i])||void 0===n||!n[t])}),!1));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Yt=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,X.set(Pt,JSON.stringify(Ft));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Jt=200,Qt="user-history";window.BroadcastChannel&&(ct=new BroadcastChannel("pixiviz-history"));var Kt={},Xt=null,Zt=function(){var e;Ct.$emit("history-updated"),null===(e=ct)||void 0===e||e.postMessage("history-updated")},ei=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t,i,n,a,o=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:{},i=t.bypass,n=void 0!==i&&i,!Xt||n){e.next=3;break}return e.abrupt("return",Xt);case 3:return e.t0=JSON,e.next=6,X.get(Qt);case 6:if(e.t1=e.sent,a=e.t0.parse.call(e.t0,e.t1),Array.isArray(a)){e.next=10;break}return e.abrupt("return",null);case 10:e.prev=10,Xt=Rt(a,!1).map((function(e){return e._ctime?e:Object(We["a"])(Object(We["a"])({},e),{},{_ctime:Math.floor(Date.now()/1e3)})})),e.next=18;break;case 14:return e.prev=14,e.t2=e["catch"](10),console.error("Failed to get user history.",e.t2),e.abrupt("return",null);case 18:return Kt={},Xt.forEach((function(e){Kt[e.id]=!0})),e.abrupt("return",Xt.sort((function(e,t){return t._ctime-e._ctime})));case 21:case"end":return e.stop()}}),e,null,[[10,14]])})));return function(){return e.apply(this,arguments)}}(),ti=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(Array.isArray(Xt)){e.next=7;break}return e.next=3,ei();case 3:if(e.t0=e.sent,e.t0){e.next=6;break}e.t0=[];case 6:Xt=e.t0;case 7:Kt[t.id]?(i=Xt.findIndex((function(e){return e.id===t.id})),i>=0&&Xt.splice(i,1)):Kt[t.id]=!0,Xt.unshift(Object(We["a"])(Object(We["a"])({},t),{},{_ctime:Math.floor(Date.now()/1e3)})),Zt(),Xt.length>Jt&&(n=Xt.pop(),delete Kt[n.id]),oi({emitPixlandEvent:!0});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ii=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:Xt=t,Kt={},Xt.forEach((function(e){Kt[e.id]=!0})),Zt(),oi();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ni=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(Array.isArray(Xt)){e.next=7;break}return e.next=3,ei();case 3:if(e.t0=e.sent,e.t0){e.next=6;break}e.t0=[];case 6:Xt=e.t0;case 7:t.forEach((function(e){if(Kt[e.id]){var t=Xt.findIndex((function(t){return t.id===e.id})),i=Xt[t];Xt[t]=Object(We["a"])(Object(We["a"])({},i),{},{_ctime:e._ctime})}else Kt[e.id]=!0,Xt.unshift(e)})),Xt.sort((function(e,t){return t._ctime-e._ctime})),oi();case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ai=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(Xt){e.next=3;break}return e.next=3,ei();case 3:Xt=Xt.filter((function(e){return e._ctime>t})),oi();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),oi=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t,i,n,a=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},i=t.emitPixlandEvent,n=void 0!==i&&i,e.next=3,X.set(Qt,JSON.stringify(Xt));case 3:n&&Ct.$emit("pixland-start-sync");case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),si=function(){return!Xt||Xt.length<1?null:Xt[0]},ri=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:Xt=null,Kt={},ii([]);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ci=function(e){var t={},i=[];Object.keys(e).forEach((function(n){var a=e[n];i.push(a),t[a]||(t[a]=[]),t[a].push(n)}));var n=Math.max.apply(Math,i);return t[n][0]},li=function(e){var t=null===e||void 0===e?void 0:e.trust_host;return!t||!Array.isArray(t)||"string"!==typeof t||!(Array.isArray(t)&&!t.includes(window.location.host)||"string"===typeof t&&window.location.host!==t)},di=function(){window.pixiviz||(window.pixiviz={}),window.pixiviz.pixland={}};window.addEventListener("pixland_user-login",(function(){di(),window.pixiviz.pixland.isLogin=!0})),window.addEventListener("pixland_user-logout",(function(){di(),window.pixiviz.pixland.isLogin=!1}));var ui,hi=new _t["a"]({fileHost:"worker.pixland.pwp.app"}),mi="pixland-last-sync",pi=10,gi=parseInt(window.localStorage.getItem(mi),10)||-1,fi=!1,vi=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var i,n,a,o,s,r,c,l,d,u,h,m,p,g,f,v;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=t.history,n=t.collection,a=t.lastHistoryClear,o=t.picData,o=o||{},e.next=6,ei();case 6:if(e.t0=e.sent,e.t0){e.next=9;break}e.t0=[];case 9:if(s=e.t0,r=a||-1,c=(s||[]).filter((function(e){return e._ctime>=gi&&e._ctime>=r})),l=(i||[]).filter((function(e){return e.t>=gi&&e.t>=r})),d=l.map((function(e){var t=e.i,i=o[t];return i?Object(We["a"])(Object(We["a"])({},i),{},{id:t,_ctime:e.t}):null})).filter((function(e){return!!e})),ni(d),u=i.map((function(e){return e.i})),h=Object(yt["a"])(i),m=Object(yt["a"])(o),c.forEach((function(e){if(u.includes(e.id)){var t=h.findIndex((function(t){return t.i===e.id}));t>=0&&(h[t].t=Math.floor(Date.now()/1e3),m[e.id]=e)}else h.unshift({i:e.id,t:Math.floor(Date.now()/1e3)}),m[e.id]=e})),h=h.sort((function(e,t){return t.t-e.t})),h.length>Jt){p=h.length-Jt,g={},p&&(g=bi(n));while(p)f=h.pop(),v=f.i,m[v]&&!g[v]&&delete m[v],p--}if(!(r>0)){e.next=25;break}return e.next=25,ai(r);case 25:return e.abrupt("return",[h,m]);case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),wi=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(hi){e.next=2;break}return e.abrupt("return");case 2:return e.next=5,hi.getUserData();case 5:if(t=e.sent,Array.isArray(t.history)){e.next=8;break}return e.abrupt("return");case 8:return i=bi(t.collection),t.history.forEach((function(e){var n=e.i;t.picData[n]&&(i[n]||delete t.picData[n])})),t.history=[],t.lastHistoryClear=Math.floor(Date.now()/1e3),e.next=15,hi.uploadUserData(t);case 15:gi=Math.floor(Date.now()/1e3),window.localStorage.setItem(mi,gi);case 17:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),bi=function(e){var t={},i={};return Object.keys(e).forEach((function(n){var a=e[n];a.forEach((function(e,a){var o=e.id||e.i;t[o]||(t[o]=!0),i[n]||(i[n]={}),i[n][o]=a}))})),[t,i]},ki=function(e){var t={};return e.forEach((function(e){t[e.id]||(t[e.id]=!0)})),t},yi=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var i,n,a,o,s,r,c,l,d,u,h,m,p,g,f,v,w,b,k,y,_,x;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=t.history,n=t.collection,a=t.picData,n=n||{},a=a||{},("object"!==Object(bt["a"])(n)||"object"===Object(bt["a"])(n)&&!Object.keys(n).length)&&(n={}),e.next=8,Ht();case 8:if(e.t0=e.sent,e.t0){e.next=11;break}e.t0={};case 11:if(o=e.t0,("object"!==Object(bt["a"])(o)||"object"===Object(bt["a"])(o)&&!Object.keys(o).length)&&(o={}),s=Object(yt["a"])(a),Object.keys(n).length||!Object.keys(o).length){e.next=21;break}return Object.keys(o).forEach((function(e){var t=o[e];t.forEach((function(e){s[e.id]||(s[e.id]=e)}))})),r={},Object.keys(o).forEach((function(e){r[e]=o[e].map((function(e){return s[e.id]=e,{i:e.id,t:Math.floor(Date.now()/1e3),o:e._ctime||Math.floor(Date.now()/1e3)}}))})),e.abrupt("return",[r,s]);case 21:if(Object.keys(o).length||!Object.keys(n).length){e.next=27;break}return c={},Object.keys(n).forEach((function(e){var t=n[e];c[e]=t.map((function(e){return Object(We["a"])(Object(We["a"])({},a[e.i]),{},{id:e.i,_ctime:e.t,_otime:e.o})}))})),qt(c),e.abrupt("return",[n,a]);case 27:return l=bi(o),d=Object(wt["a"])(l,2),u=d[0],h=d[1],m=bi(n),p=Object(wt["a"])(m,2),g=p[0],f=p[1],v=ki(i),w={},b={},k={},y={},Object.keys(o).forEach((function(e){var t=o[e];b[e]||(b[e]=[]),k[e]||(k[e]=[]),t.forEach((function(t){t._ctime>=gi&&!g[t.id]?k[e].push(t):t._ctime<gi&&!g[t.id]&&b[e].push(t)}))})),Object.keys(n).forEach((function(e){var t=n[e];w[e]||(w[e]=[]),y[e]||(y[e]=[]),t.forEach((function(t){t.t>=gi&&!u[t.i]?w[e].push(t):t.t<gi&&!u[t.i]&&y[e].push(t)}))})),_=Object(yt["a"])(o),x=Object(yt["a"])(n),Object.keys(b).forEach((function(e){var t=b[e];Array.isArray(t)&&t.length&&(t.forEach((function(t){var i,n=null===(i=h[e])||void 0===i?void 0:i[t.id];"undefined"!==typeof n&&(_[e][n]=null)})),_[e]=_[e].filter((function(e){return!!e})))})),Object.keys(w).forEach((function(e){var t=w[e];Array.isArray(t)&&t.length&&(_[e]=_[e].concat(t.map((function(e){return Object(We["a"])(Object(We["a"])({},a[e.i]),{},{id:e.i,_ctime:e.t,_otime:e.o})}))));var i={};_[e]=_[e].filter((function(e){return!i[e.id]&&(i[e.id]=!0,!0)}))})),qt(_),Object.keys(y).forEach((function(e){var t=y[e];t.forEach((function(t){var i,n=null===(i=f[e])||void 0===i?void 0:i[t.i];"undefined"!==typeof n&&(x[e][n]=null),v[t.i]||delete s[t.i]})),x[e]=x[e].filter((function(e){return!!e}))})),Object.keys(k).forEach((function(e){var t=k[e];t.forEach((function(t){s[t.id]=Object(yt["a"])(t);var i=Math.floor(Date.now()/1e3);x[e]||(x[e]=[]),x[e].push({i:t.id,t:i,o:t._ctime})}));var i={};x[e]=x[e].filter((function(e){return!i[e.i]&&(i[e.i]=!0,!0)}))})),e.abrupt("return",[x,s]);case 51:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_i=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t,i,n,a,o,s,r,c,l,d,u,h,m=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=m.length>0&&void 0!==m[0]?m[0]:{},a=n.immediate,o=void 0!==a&&a,null!==hi&&void 0!==hi&&hi.isLogin()){e.next=3;break}return e.abrupt("return");case 3:if(s=Math.floor(Date.now()/1e3),r=(null===(t=window.pixiviz)||void 0===t||null===(i=t.config)||void 0===i?void 0:i.syncMinSpan)||pi,o){e.next=13;break}if(!(s-gi<r||ui||fi)){e.next=11;break}return ui&&(clearTimeout(ui),ui=null),ui=setTimeout((function(){ui=null,_i()}),1e3*r),e.abrupt("return");case 11:e.next=14;break;case 13:ui&&(clearTimeout(ui),ui=null);case 14:return e.prev=14,fi=!0,Math.floor(Date.now()/1e3),e.next=20,hi.getUserData();case 20:return c=e.sent,e.next=24,Object(kt["d"])(JSON.stringify(c));case 24:return l=e.sent,e.next=28,vi(c);case 28:return d=e.sent,c.history=d[0],c.picData=d[1],e.next=33,yi(c);case 33:return u=e.sent,c.collection=u[0],c.picData=u[1],e.next=38,Object(kt["d"])(JSON.stringify(c));case 38:if(h=e.sent,h!==l){e.next=44;break}return gi=Math.floor(Date.now()/1e3),window.localStorage.setItem(mi,gi),e.abrupt("return");case 44:return e.next=47,hi.uploadUserData(c);case 47:gi=Math.floor(Date.now()/1e3),window.localStorage.setItem(mi,gi),e.next=54;break;case 51:e.prev=51,e.t0=e["catch"](14),console.error("[pixland] sync failed",e.t0);case 54:return e.prev=54,fi=!1,e.finish(54);case 57:case"end":return e.stop()}}),e,null,[[14,51,54,57]])})));return function(){return e.apply(this,arguments)}}();Ct.$on("pixland-start-sync",(function(){var e,t,i,n;null!==(e=window.pixiviz)&&void 0!==e&&e.config&&!li(window.pixiviz.config)||!hi.isLogin()||null!==(t=window.pixiviz)&&void 0!==t&&null!==(i=t.config)&&void 0!==i&&null!==(n=i.pixland)&&void 0!==n&&n.maintain||_i()})),window.addEventListener("beforeunload",(function(){var e,t,i,n,a;ui&&clearTimeout(ui),null===(e=window.pixiviz)||void 0===e||null===(t=e.pixland)||void 0===t||!t.isLogin||null!==(i=window.pixiviz)&&void 0!==i&&null!==(n=i.config)&&void 0!==n&&null!==(a=n.pixland)&&void 0!==a&&a.maintain||_i({immediate:!0})}));var xi,Ci,$i=hi,Si=function(){return"https://fonts.loli.net"},Ti=function(){var e=document.createElement("link");e.href="".concat(Si(),"/css2?family=Kosugi+Maru&family=Noto+Sans+SC:wght@100;300;400;500;700;900&display=swap"),e.rel="stylesheet",e.type="text/css",e.crossOrigin="anonymous",document.querySelector("head").appendChild(e)},Ii={name:"app",components:{DownloadList:Xe,DownloadListTag:Fe,Maintain:ht},data:function(){return{maintainText:""}},beforeCreate:function(){if(window.isSafari=/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent),window.matchMedia("(display-mode: standalone)").matches&&(window.isStandAlone=!0),window.pixiviz||(window.pixiviz={}),window.pixiviz.infoMap||(window.pixiviz.infoMap={}),"/"===this.$route.path&&window.localStorage.removeItem("pic-routes"),window.isSafari&&!window.isStandAlone){var e=function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"))};window.addEventListener("resize",e),e()}Ti()},created:function(){var e,t;mt()?this.$router.replace({path:"/anti-share"}):(this.$bus.$on("user-not-online",(function(){vt("warn","电波讯号中断，请检查您的网络连接",3e3)})),this.$bus.$on("api-not-available",(function(){vt("warn","电波失联，我们暂时无法连接至服务器...",3e3)})),this.$bus.$on("proxy-not-available",(function(){vt("warn","电波失联，我们暂时无法连接至图片服务器...",3e3)})),this.$bus.$on("dark-mode-enable",this.handleDarkModeEnable),this.$bus.$on("dark-mode-disable",this.handleDarkModeDisable),this.$Lazyload.$on("loaded",this.imageLoadedHandler),this.$Lazyload.$on("error",this.imageLoadErrorHandler),this.fitHiRes(),window.localStorage.setItem("last-visit-time",Date.now()),null===(e=this.pixland)||void 0===e||!e.isLogin()||null!==(t=this.$config.pixland)&&void 0!==t&&t.maintain||_i())},mounted:function(){var e=this;if(this.$bus.$once("remote-config-fetched",(function(){e.$nextTick((function(){e.checkMaintain()}))})),this.checkMaintain(),window.addEventListener("resize",this.fitHiRes),"1"===this.$route.query.debug){var t=document.createElement("script");t.src="https://unpkg.com/vconsole/dist/vconsole.min.js",t.onload=function(){new window.VConsole},document.body.appendChild(t)}},beforeDestroy:function(){window.removeEventListener("resize",this.fitHiRes),window.localStorage.setItem("last-visit-time",Date.now())},computed:{showDownloadList:function(){return this.$store.state.download.list.length>0}},methods:{checkMaintain:function(){var e,t=this.$config.maintain;null!==(e=this.$config.maintain)&&void 0!==e&&e.enable&&(this.$refs.maintain.show(),this.maintainText=t.text,document.documentElement.classList.add("no-scrollbar"))},imageLoadedHandler:function(e){this.emitImageCardEvent(Object(We["a"])(Object(We["a"])({},e),{},{eventType:"loaded"}))},imageLoadErrorHandler:function(e){this.emitImageCardEvent(Object(We["a"])(Object(We["a"])({},e),{},{eventType:"error"}))},emitImageCardEvent:function(e){var t=e.el,i=e.src,n=e.eventType,a=t.getAttribute("data-type");if("card"===a){var o=/(\d+)_[a-z0-9_]+\.jpg$/.exec(i);if(!o||o.length<1)return;var s="image-".concat(n,"-card-").concat(t.getAttribute("data-index"),"_").concat(o[1]);this.$bus.$emit(s)}else if(a){var r=t.getAttribute("id");this.$bus.$emit("".concat(a,"-").concat(r,"-").concat(n))}},handleDarkModeEnable:function(){this.$store.commit("darkMode/setEnabled",!0);var e=document.querySelector('meta[name="theme-color"]');e&&e.setAttribute("content","#161616")},handleDarkModeDisable:function(){this.$store.commit("darkMode/setEnabled",!1);var e=document.querySelector('meta[name="theme-color"]');e&&e.setAttribute("content","#fafafa")},fitHiRes:function(){window.innerWidth>=1960&&window.innerHeight>=1280&&(window.innerWidth<=2560?document.documentElement.style.fontSize="16.75px":document.documentElement.style.fontSize="".concat(window.innerWidth/2560*16.75,"px"))}}},Oi=Ii,Ei=(i("034f"),Object(Ae["a"])(Oi,Le,ze,!1,null,null,null)),Li=Ei.exports,zi=i("8c4f"),Wi=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"landing-container"},[i("div",{directives:[{name:"lazy",rawName:"v-lazy:background-image",value:e.landingBG,expression:"landingBG",arg:"background-image"}],staticClass:"landing"},[i("div",{staticClass:"landing-real-content"},[i("Banner",{staticClass:"landing-card",on:{expanded:e.handleExpanded}}),i("SearchBox",{staticClass:"landing-card"}),i("RankBox",{staticClass:"landing-card"})],1)]),i("el-dialog",{staticClass:"landing-announcement",attrs:{title:e.announceTitle,visible:e.showAnnounce,"before-close":e.handleAnnounceClose,top:"8.5vh"},on:{"update:visible":function(t){e.showAnnounce=t}}},[i("pre",{domProps:{innerHTML:e._s(e.announceContent)}}),i("pre",{staticClass:"announce-footer"},[e._v(e._s(e.announceFooter))])])],1)},ji=[],Di=i("b85c"),Mi=(i("2ca0"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"touch",rawName:"v-touch:doubletap",value:e.handleDoubleTap,expression:"handleDoubleTap",arg:"doubletap"}],class:["banner-wrapper",e.expanded?"banner-expanded":"",e.clearMarginBottom?"clear-margin-bottom":""],on:{dblclick:e.handleDblClick}},[i("div",{staticClass:"banner"},[i("div",{class:["banner-title",e.titleUp?"banner-title-up":""]},[i("span",[e._v("Pixiviz")]),e._m(0)]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.expanded,expression:"expanded"}],class:["about",e.aboutShow?"about-show":""]},[i("div",{staticClass:"about-my"},[e._m(1),i("div",{staticClass:"about-my-link"},[i("a",{attrs:{id:"about-history",href:"javascript:;"},on:{click:e.goHistory,contextmenu:function(e){e.preventDefault()}}},[e._v("浏览历史")]),i("a",{attrs:{href:"javascript:;"},on:{click:e.goCollection,contextmenu:function(e){e.preventDefault()}}},[e._v("收藏夹")])])]),i("div",{staticClass:"about-settings"},[e._m(2),i("div",{staticClass:"about-settings-link"},[i("a",{attrs:{id:"about-theme",href:"javascript:;"},on:{click:e.openThemeDialog,contextmenu:function(e){e.preventDefault()}}},[e._v(" 打开设置 ")])])]),i("div",{staticClass:"about-copyright"},[e._m(3),i("div",{staticClass:"about-copyright-item"},[i("span",[i("a",{attrs:{href:"https://github.com/asadahimeka/pixiviz/discussions",target:"_blank"}},[e._v("交流反馈")]),i("span",{staticClass:"about-copyright-split"},[e._v("|")]),i("a",{on:{click:e.goToBgUrl}},[e._v("主页背景")])])]),i("div",{staticClass:"about-copyright-item"},[i("span",[e._v("v "+e._s(e.appVer)+" kai")])]),i("div",{staticClass:"about-copyright-item",on:{click:e.goGitHub}},[i("GitHubIcon")],1)])])]),i("ThemeDialog",{ref:"theme",attrs:{id:"landing-dialog-theme"}})],1)}),Ri=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",[i("sup",{staticStyle:{"font-size":"0.4em","letter-spacing":"0"}},[e._v("Kai")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"about-my-title"},[i("span",[e._v("我的")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"about-settings-title"},[i("span",[e._v("设置")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"about-copyright-item"},[i("span",[e._v("Copyright © 2022 pwp.app.")])])}],Ai=(i("466d"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{staticClass:"dialog dialog-theme",attrs:{title:"设置",width:e.dialogWidth,visible:e.show,"append-to-body":""},on:{"update:visible":function(t){e.show=t}}},[i("el-form",{attrs:{"label-position":"left","label-width":e.labelWidth,model:e.themeForm}},[i("el-form-item",{attrs:{label:"颜色主题"}},[i("el-switch",{attrs:{"active-color":"#2e2e2e","inactive-color":"#E3A7A1","active-text":"暗色","inactive-text":"浅色"},on:{change:e.themeChanged},model:{value:e.themeForm.darkMode,callback:function(t){e.$set(e.themeForm,"darkMode",t)},expression:"themeForm.darkMode"}})],1),i("el-form-item",{attrs:{label:"模式"}},[i("el-switch",{attrs:{"active-color":"#2e2e2e","inactive-color":"#3e3e3e","active-text":"固定颜色","inactive-text":"自动切换",disabled:!e.themeForm.darkMode},on:{change:e.themeModeChanged},model:{value:e.themeForm.darkPersist,callback:function(t){e.$set(e.themeForm,"darkPersist",t)},expression:"themeForm.darkPersist"}})],1),i("el-form-item",{attrs:{label:"显示 NSFW 内容","label-width":"140px"}},[i("el-switch",{attrs:{value:e.$store.state.showNSFW,"active-text":"是","inactive-text":"否"},on:{change:e.nsfwChanged}})],1)],1)],1)}),Pi=[],Fi=i("5a0c"),Ni=i.n(Fi),Ui={computed:{dialogWidth:function(){return this.screenWidth<=320?"308px":this.screenWidth<768?"320px":"480px"}}},Hi={data:function(){return{show:!1,themeForm:{darkMode:!1,darkPersist:!1},screenWidth:document.documentElement.clientWidth}},mixins:[Ui],computed:{labelWidth:function(){return this.screenWidth<=320?"72px":"80px"}},created:function(){window.addEventListener("resize",this.windowResized);var e=window.localStorage.getItem("enable-dark");this.themeForm.darkMode="true"===e;var t=window.localStorage.getItem("dark-persist");this.themeForm.darkPersist="true"===t},methods:{open:function(){this.show=!0},themeChanged:function(e){if(e){var t=Ni()(),i=t.hour();this.themeForm.darkPersist||i<6||i>=18?this.enableDarkMode():this.disableDarkMode()}else this.disableDarkMode()},themeModeChanged:function(e){if(e)this.addDarkClass();else{var t=Ni()(),i=t.hour();i>=6&&i<18&&this.removeDarkClass()}window.pixiviz.darkPersist=e,window.localStorage.setItem("dark-persist",e)},nsfwChanged:function(e){e?this.$confirm("确定要开启 NSFW 作品显示吗？请确保您的年龄已满18岁，且未违反当地法律法规所规定的内容。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){localStorage.setItem("pz_showNSFW",1),setTimeout((function(){location.reload()}),200)})):(localStorage.removeItem("pz_showNSFW"),setTimeout((function(){location.reload()}),200))},enableDarkMode:function(){this.$bus.$emit("dark-mode-enable")},disableDarkMode:function(){this.$bus.$emit("dark-mode-disable")},windowResized:function(){this.screenWidth=document.documentElement.clientWidth}}},Bi=Hi,qi=(i("8610"),Object(Ae["a"])(Bi,Ai,Pi,!1,null,"3c5fd048",null)),Vi=qi.exports,Gi=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("svg",{staticClass:"icon",attrs:{t:"1582719754601",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2107"}},[i("path",{attrs:{d:"M512 12.64c-282.752 0-512 229.216-512 512 0 226.208 146.72 418.144 350.144 485.824 25.6 4.736 35.008-11.104 35.008-24.64 0-12.192-0.48-52.544-0.704-95.328-142.464 30.976-172.512-60.416-172.512-60.416-23.296-59.168-56.832-74.912-56.832-74.912-46.464-31.776 3.52-31.136 3.52-31.136 51.392 3.616 78.464 52.768 78.464 52.768 45.664 78.272 119.776 55.648 148.992 42.56 4.576-33.088 17.856-55.68 32.512-68.48-113.728-12.928-233.28-56.864-233.28-253.024 0-55.904 20-101.568 52.768-137.44-5.312-12.896-22.848-64.96 4.96-135.488 0 0 43.008-13.76 140.832 52.48a491.296 491.296 0 0 1 128.16-17.248c43.488 0.192 87.328 5.888 128.256 17.248 97.728-66.24 140.64-52.48 140.64-52.48 27.872 70.528 10.336 122.592 5.024 135.488 32.832 35.84 52.704 81.536 52.704 137.44 0 196.64-119.776 239.936-233.792 252.64 18.368 15.904 34.72 47.04 34.72 94.816 0 68.512-0.608 123.648-0.608 140.512 0 13.632 9.216 29.6 35.168 24.576C877.472 942.624 1024 750.784 1024 524.64c0-282.784-229.248-512-512-512z","p-id":"2108",fill:"#f8f8f8"}})])},Yi=[],Ji={},Qi=Object(Ae["a"])(Ji,Gi,Yi,!1,null,null,null),Ki=Qi.exports,Xi="https://github.com/asadahimeka/pixiviz",Zi={name:"Landing.Banner",components:{GitHubIcon:Ki,ThemeDialog:Vi},data:function(){return{expanded:!1,expandLock:!1,titleUp:!1,aboutShow:!1,clearMarginBottom:!1,appVer:rt,landingBgId:this.$config.landing_bg_id}},beforeDestroy:function(){this.$emit("expanded",!1),this.$store.commit("landingBanner/setExpanded",!1)},methods:{goToBgUrl:function(){var e,t=(null===(e=sessionStorage.getItem("__home-bg"))||void 0===e?void 0:e.match(/\/(\d+)_p\d+_master1200/)[1])||98606454;window.open("/pic/".concat(t),"_blank")},handleDblClick:function(e){var t=this;e.target.getAttribute("class")&&e.target.getAttribute("class").includes("el-switch")||this.expandLock||(this.expandLock=!0,this.expanded?(this.aboutShow=!1,this.clearMarginBottom=!1,document.documentElement.classList.contains("no-scrollbar")||document.documentElement.classList.add("no-scrollbar"),this.$emit("expanded",!1),setTimeout((function(){t.titleUp=!1,setTimeout((function(){t.expanded=!1,t.$store.commit("landingBanner/setExpanded",t.expanded),setTimeout((function(){t.expandLock=!1,document.documentElement.classList.contains("no-scrollbar")&&document.documentElement.classList.remove("no-scrollbar")}),500)}),350)}),350)):(this.expanded=!0,document.documentElement.classList.contains("no-scrollbar")||document.documentElement.classList.add("no-scrollbar"),this.$store.commit("landingBanner/setExpanded",this.expanded),this.$emit("expanded",!0),setTimeout((function(){t.clearMarginBottom=!0}),200),setTimeout((function(){t.titleUp=!0,setTimeout((function(){t.aboutShow=!0,setTimeout((function(){t.expandLock=!1,document.documentElement.classList.contains("no-scrollbar")&&document.documentElement.classList.remove("no-scrollbar")}),500)}),350)}),350)))},handleDoubleTap:function(){this.handleDblClick()},openThemeDialog:function(){this.$refs.theme.open()},openPrivacyDialog:function(){this.$refs.privacy.open()},goHistory:function(){this.$router.push("/history")},goCollection:function(){this.$router.push("/collection")},goGitHub:function(){window.isSafari?window.location.href=Xi:window.open(Xi,"_blank")},showAccountDialog:function(){var e,t;li(this.$config)?this.pixland?this.pixland.userStorage?null===(e=this.$refs.user)||void 0===e||e.open():null===(t=this.$refs.login)||void 0===t||t.open():this.$message.error("Pixland 初始化失败，请刷新页面后再试"):this.$message.error("帐号功能暂不开放")}}},en=Zi,tn=Object(Ae["a"])(en,Mi,Ri,!1,null,null,null),nn=tn.exports,an=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],class:["searchbox-wrapper",e.bannerExpanded?"searchbox-hide":""]},[i("div",{staticClass:"searchbox"},[i("div",{staticClass:"searchbox-title"},[i("span",[e._v("寻找你"),i("el-dropdown",{attrs:{trigger:"click",placement:"bottom"},on:{command:e.handleModeChanged}},[i("span",[e._v(e._s(e.searchModeText))]),i("el-dropdown-menu",{staticClass:"search-dropdown",attrs:{slot:"dropdown"},slot:"dropdown"},["pic"!==e.searchMode?i("el-dropdown-item",{attrs:{command:"pic"}},[e._v(" 想看的画作 ")]):e._e(),"user"!==e.searchMode?i("el-dropdown-item",{attrs:{command:"user"}},[e._v(" 喜欢的画师 ")]):e._e()],1)],1)],1)]),i("div",{staticClass:"searchbox-input"},[i("el-input",{attrs:{spellcheck:"false"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitSearch.apply(null,arguments)}},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),i("div",{staticClass:"searchbox-button"},[i("button",{on:{click:e.handleSearchClick}},[i("i",{staticClass:"el-icon-search"})])])])])},on=[],sn=(i("841c"),{name:"Landing.SearchBox",data:function(){return{show:!0,search:"",bannerExpanded:!1,searchMode:this.$store.state.search.mode||"pic"}},computed:{searchModeText:function(){return"pic"===this.searchMode?"想看的画作":"喜欢的画师"}},watch:{"$store.state.landingBanner.expanded":function(e){var t=this;e?(this.bannerExpanded=e,setTimeout((function(){t.show=!1}),500)):(this.show=!0,setTimeout((function(){t.bannerExpanded=e}),150))}},methods:{submitSearch:function(){var e;if(this.search)return this.search&&(e=this.search.trim(),e.length<1)?(this.$message.error("呐，输入关键词再搜索！！"),void(this.search="")):void("pic"===this.searchMode?(this.$router.push({name:"Search",params:{keyword:this.search}}),this.$cookies.set("search-from","","1h")):"user"===this.searchMode&&(this.$router.push({name:"UserSearch",params:{keyword:this.search}}),this.$cookies.set("usearch-from","","1h")));this.$message.error("呐，输入关键词再搜索！！")},handleSearchClick:function(){this.submitSearch()},handleModeChanged:function(e){this.searchMode=e,this.$store.commit("search/setMode",this.searchMode)}}}),rn=sn,cn=Object(Ae["a"])(rn,an,on,!1,null,null,null),ln=cn.exports,dn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],class:["rankbox-wrapper",e.bannerExpanded?"rankbox-hide":""]},[i("div",{staticClass:"rankbox"},[e._m(0),i("div",{staticClass:"rankbox-options"},[i("div",{staticClass:"rankbox-options-text",attrs:{"data-mode":"month"},on:{click:function(t){return t.preventDefault(),e.toRank("month")}}},[i("a",{attrs:{href:"/rank?mode=month"}},[e._v("月")])]),i("span",{staticClass:"rankbox-options-split"},[e._v("/")]),i("div",{staticClass:"rankbox-options-text",attrs:{"data-mode":"week"},on:{click:function(t){return t.preventDefault(),e.toRank("week")}}},[i("a",{attrs:{href:"/rank?mode=week"}},[e._v("周")])]),i("span",{staticClass:"rankbox-options-split"},[e._v("/")]),i("div",{staticClass:"rankbox-options-text",attrs:{"data-mode":"day"},on:{click:function(t){return t.preventDefault(),e.toRank("day")}}},[i("a",{attrs:{href:"/rank?mode=day"}},[e._v("日")])])])])])},un=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"rankbox-title"},[i("span",[e._v("排行榜")])])}],hn={name:"Landing.RankBox",data:function(){return{show:!0,bannerExpanded:!1}},watch:{"$store.state.landingBanner.expanded":function(e){var t=this;e?(this.bannerExpanded=e,setTimeout((function(){t.show=!1}),500)):(this.show=!0,setTimeout((function(){t.bannerExpanded=e}),150))}},methods:{toRank:function(e){this.$cookies.set("rank-from","","1h"),this.$cookies.set("rank-mode",e,"1h"),this.$cookies.set("rank-scroll",0,"1h"),this.$cookies.set("rank-reset","true","1h"),this.$router.push("/rank")}}},mn=hn,pn=Object(Ae["a"])(mn,dn,un,!1,null,null,null),gn=pn.exports,fn="pixiviz-remote-config",vn=function(){window.localStorage.removeItem(fn)},wn=function(){var e=window.localStorage.getItem(fn);if(!e)return null;try{var t=JSON.parse(e);if(Date.now()-t.time>108e5)return vn(),null;var i=(null===t||void 0===t?void 0:t.value)||null;return i}catch(n){return console.error(n),null}},bn=function(e){var t=0;return new Promise((function(i){var n=setInterval((function(){var a,o;null!==(a=window.pixiviz)&&void 0!==a&&null!==(o=a.config)&&void 0!==o&&o.IS_REMOTE_CONFIG&&(clearInterval(n),i()),t+=.1,t>=e&&(clearInterval(n),i())}),100)}))},kn={name:"Landing",components:{Banner:nn,SearchBox:ln,RankBox:gn},data:function(){return{staticLandingBG:i("08dc"),landingBG:i("08dc"),guideNotice:null,notFirstUse:!1,announceId:-1,announceTitle:"",announceFooter:"",showAnnounce:!1,announceContent:!1}},created:function(){document.title="Pixiviz",this.fetchLandingBg()},mounted:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var i,n,a,o,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(li(e.$config)){t.next=2;break}return t.abrupt("return");case 2:if(null!==(i=window.pixiviz)&&void 0!==i&&null!==(n=i.config)&&void 0!==n&&n.IS_REMOTE_CONFIG){t.next=5;break}return t.next=5,bn(5);case 5:null!==(a=e.$config)&&void 0!==a&&a.check_announce&&e.fetchAnnounce(),null!==(o=e.$config)&&void 0!==o&&o.show_guide&&e.checkFirstUse(),null!==(s=e.$config)&&void 0!==s&&s.show_donate&&e.displayDonate();case 8:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){this.guideNotice&&this.guideNotice.close(),this.donateNotice&&this.donateNotice.close()},methods:{handleExpanded:function(e){this.$refs.bannerPlaceholder&&this.$refs.bannerPlaceholder.expandedChanged(e)},checkVersionMatch:function(e){var t,i=Object(Di["a"])(e);try{for(i.s();!(t=i.n()).done;){var n=t.value;if(!rt.startsWith(n))return!1}}catch(a){i.e(a)}finally{i.f()}return!0},checkLastVisitTime:function(e){var t=window.localStorage.getItem("last-visit-time");if(!t)return!1;var i=parseInt(t,10);return i>=e},fetchLandingBg:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var i,n,a,o,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i=sessionStorage.getItem("__home-bg"),!i){t.next=4;break}return e.landingBG=i,t.abrupt("return");case 4:return t.prev=4,n="/prks/now/ajax/illust/discovery",t.next=8,e.axios.get(n,{baseURL:"/",params:{mode:"safe",max:1}});case 8:a=t.sent,o=a.data.illusts.filter((function(e){return!e.isAdContainer}))[0].url,o="https://nfn.kanata.ml/pximg".concat(o.replace(/\/-\/c\/\d+x\d+.*\/.*\/img\//i,"/img-master/img/").replace(/(_p\d+_)\w+1200/,"$1master1200")),s=new Image,s.onload=function(){setTimeout((function(){e.landingBG=o,sessionStorage.setItem("__home-bg",o)}),200),s=null},s.src=o,t.next=19;break;case 16:t.prev=16,t.t0=t["catch"](4),e.landingBG=e.staticLandingBG;case 19:case"end":return t.stop()}}),t,null,[[4,16]])})))()},fetchAnnounce:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var i,n,a,o,s,r,c,l,d,u,h,m,p,g,f,v,w;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.axios.get(e.$config.announcement_feed,{withCredentials:!1});case 3:i=t.sent,t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](0),console.error("Fetch remote announcement failed",t.t0);case 9:if(i.data){t.next=11;break}return t.abrupt("return");case 11:n=Object(Di["a"])(i.data),t.prev=12,n.s();case 14:if((a=n.n()).done){t.next=32;break}if(o=a.value,s=o.id,r=o.title,c=o.content,l=o.footer,d=o.start,u=o.expires,h=o.matchVersion,m=o.lastVisitAfter,p=window.localStorage.getItem("announce-read-id"),g=!d||d<=Date.now(),f=!u||u<Date.now(),v=!h||e.checkVersionMatch(h),w=!m||e.checkLastVisitTime(m),!(p&&parseInt(p,10)>=parseInt(s,10)||!g||f)&&v&&w){t.next=24;break}return t.abrupt("continue",30);case 24:return e.announceId=s,e.announceTitle=r,e.announceContent=c,e.announceFooter=l,e.showAnnounce=!0,t.abrupt("break",32);case 30:t.next=14;break;case 32:t.next=37;break;case 34:t.prev=34,t.t1=t["catch"](12),n.e(t.t1);case 37:return t.prev=37,n.f(),t.finish(37);case 40:case"end":return t.stop()}}),t,null,[[0,6],[12,34,37,40]])})))()},handleAnnounceClose:function(e){window.localStorage.setItem("announce-read-id",this.announceId),e()},checkFirstUse:function(){var e=this;if(window.localStorage){var t=window.localStorage.getItem("not-first-use");"true"!==t?(document.body.addEventListener("click",this.guideNoticeClicked,!1),window.localStorage.setItem("not-first-use",!0),this.$nextTick((function(){e.guideNotice=e.$notify({title:"",position:"top-right",customClass:"oneline-notice-container",dangerouslyUseHTMLString:!0,duration:8e3,onClose:e.guideNoticeClosed,message:'\n          <div class="oneline-notice">\n            <span data-name="notice-firstuse">第一次来到 Pixiviz？你可能需要<span class="notice-link" data-name="link-guide">食用指南</span></span>\n          </div>'})}))):this.notFirstUse=!0}},displayDonate:function(){var e=this;if(this.notFirstUse){var t=window.localStorage.getItem("last-show-donate");t&&(Date.now()-parseInt(t,10))/1e3<=432e3||Math.random()<=.75&&(window.localStorage.setItem("last-show-donate",Date.now()),document.body.addEventListener("click",this.donateNoticeClicked,!1),this.$nextTick((function(){e.donateNotice=e.$notify({title:"",position:"top-right",customClass:"oneline-notice-container",dangerouslyUseHTMLString:!0,duration:15e3,onClose:e.donateNoticeClosed,message:'\n\t\t\t\t\t\t\t<div class="oneline-notice">\n\t\t\t\t\t\t\t\t<span data-name="notice-donate">有了大家的发电，服务姬就能健康地活下去了，广告什么的才不上呢！ -&gt; <span class="notice-link" data-name="link-donate">点这里即刻投喂服务姬</span></span>\n\t\t\t\t\t\t\t</div>'})})))}},guideNoticeClicked:function(e){e.target.dataset.name&&"link-guide"===e.target.dataset.name&&(window.isSafari?window.location.href=this.$config.guide_url:window.open(this.$config.guide_url,"_blank"),this.guideNotice.close())},guideNoticeClosed:function(){document.body.removeEventListener("click",this.guideNoticeClicked,!1)},donateNoticeClicked:function(e){e.target.dataset.name&&"link-donate"===e.target.dataset.name&&(window.isSafari?window.location.href=this.$config.donate_url:window.open(this.$config.donate_url,"_blank"),this.donateNotice.close())},donateNoticeClosed:function(){document.body.addEventListener("click",this.donateNoticeClicked,!1)}}},yn=kn,_n=(i("86b4"),Object(Ae["a"])(yn,Wi,ji,!1,null,"f005c6a2",null)),xn=_n.exports,Cn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:{"rank-container":!0,"ipad-only":e.iPadStyle}},[i("div",{staticClass:"rank-header"},[i("div",{staticClass:"rank-header-title"},[i("span",[e._v("排行榜")]),i("div",{staticClass:"rank-header-title-category"},[i("span",[e._v(e._s(e.modeText))]),i("el-popover",{attrs:{placement:"bottom","popper-class":"rank-category-popover",trigger:"click"}},[i("ModeSwitcher",{attrs:{mode:e.mode},on:{"mode-changed":e.handleModeChanged}}),i("i",{staticClass:"el-icon-refresh",attrs:{slot:"reference"},slot:"reference"})],1)],1),i("div",{staticClass:"rank-header-close"},[i("i",{staticClass:"el-icon-close",on:{click:e.handleBack}})])])]),i("div",{staticClass:"rank-body"},[i("div",{staticClass:"rank-body-date"},[i("div",{staticClass:"rank-body-date-item rank-body-date-back",on:{click:function(t){return e.handleDateChanged(-1)}}},[i("i",{staticClass:"el-icon-arrow-left"}),i("span",[e._v(e._s(e.backDateText)+e._s(e.dateUnit))])]),i("el-popover",{attrs:{placement:"bottom","popper-class":"rank-date-popover",width:"320",trigger:"click"}},[i("DateSwitcher",{ref:"dateSwitcher",attrs:{date:e.dateObject},on:{"date-selected":e.handleDateSelected}}),i("div",{staticClass:"rank-body-date-item rank-body-date-date",attrs:{slot:"reference"},slot:"reference"},[i("span",[e._v(e._s(e.displayDate))])])],1),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showDateNext,expression:"showDateNext"}],staticClass:"rank-body-date-item rank-body-date-next",on:{click:function(t){return e.handleDateChanged(1)}}},[i("span",[e._v(e._s(e.nextDateText)+e._s(e.dateUnit))]),i("i",{staticClass:"el-icon-arrow-right"})])],1),i("div",{staticClass:"rank-body-content"},[i("div",{staticClass:"waterfall-wrapper"},[i("Waterfall",{key:e.waterfallResponsive,ref:"waterfall",class:{"waterfall-responsive":e.waterfallResponsive},style:e.waterfallResponsive?null:{width:e.mobileWaterfallWidth+"px"},attrs:{images:e.images,cardWidth:e.cardWidth,imageType:"medium"},on:{"card-clicked":e.handleCardClicked}})],1)])]),e.loadFailed?i("div",{staticClass:"infinite-failed"},[i("p",[e._v("看上去数据加载失败了")]),i("el-button",{attrs:{type:"primary",round:""},on:{click:e.fetchNew}},[e._v("点我重试")])],1):e._e(),e.loadFailed?e._e():i("infinite-loading",{attrs:{identifier:e.waterfallIdentifier,spinner:"spiral"},on:{infinite:e.infiniteHandler}}),i("BackToTop",{ref:"backToTop"})],1)},$n=[],Sn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"container",staticClass:"waterfall-container",style:{height:(e.maxHeight||0)+"px"}},e._l(e.displayImages,(function(t){return i("ImageCard",{key:t.index,staticClass:"waterfall-item",attrs:{image:t,cardWidth:e.cardWidth,imageType:e.imageType,position:e.positionMap[t.index],isCollection:e.isCollection},on:{clicked:e.handleCardClicked,remove:e.handleCardRemoved}})})),1)},Tn=[],In=(i("a9e3"),i("fb6a"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"image-card-wrapper",style:e.positionStyle},[i("a",{class:{"image-card":!0,"image-card-status-error":e.loadError||e.block,"image-card--more":e.moreMenuVisible},style:{width:e.cardWidth+"px",height:e.loadHeight+"px"},attrs:{href:e.loadError||e.block||!e.image?"javascript:;":"/pic/"+e.image.id},on:{click:function(t){return t.preventDefault(),e.handleClick.apply(null,arguments)}}},[e.block?i("div",{staticClass:"image-card-overlay image-card-block"},[e.loadHeight>=128?i("div",{staticClass:"image-card-overlay-icon"},[i("i",{staticClass:"el-icon-warning-outline"})]):e._e(),i("div",{class:["image-card-overlay-tip",e.loadHeight<128?"image-card-overlay-tip-xs":null]},[i("span",[e._v("该图片无法展示")])])]):e._e(),e.loadError?i("div",{staticClass:"image-card-overlay image-card-error"},[e.loadHeight>=128?i("div",{staticClass:"image-card-overlay-icon"},[i("i",{staticClass:"el-icon-warning-outline"})]):e._e(),i("div",{class:["image-card-overlay-tip",e.loadHeight<128?"image-card-overlay-tip-xs":null]},[i("span",[e._v("图片加载失败")])])]):e._e(),e.image&&e.image.page_count>1?i("div",{staticClass:"image-card-count"},[i("span",[e._v(e._s(e.image?e.image.page_count:""))])]):e._e(),e.isCollection?i("el-dropdown",{attrs:{trigger:"hover",placement:"bottom"},on:{command:e.handleMoreCommand,"visible-change":e.handleMenuVisibleChanged},nativeOn:{click:function(e){e.stopPropagation()}}},[i("div",{staticClass:"image-card-more"},[i("IconMore",{staticClass:"image-card-more__icon"})],1),i("el-dropdown-menu",{staticClass:"image-card-dropdown",attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{attrs:{command:"remove"}},[e._v(" 取消收藏 ")])],1)],1):e._e(),e.block?e._e():i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"},{name:"lazy",rawName:"v-lazy:background-image",value:e.source,expression:"source",arg:"background-image"}],ref:"image",staticClass:"image-card-image",attrs:{"data-index":e.image?e.image.index:"","data-type":"card"}}),i("div",{staticClass:"image-card-title"},[e._v(" "+e._s(e.image.title)+" ")])],1)])}),On=[],En=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("svg",{staticClass:"icon",attrs:{t:"1661880102948",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2602",width:"20",height:"20"}},[i("path",{attrs:{d:"M184.41216 421.855232c-49.990656 0-90.499072 40.516608-90.499072 90.49088 0 49.975296 40.50944 90.492928 90.499072 90.492928 49.975296 0 90.483712-40.517632 90.483712-90.492928C274.896896 462.37184 234.387456 421.855232 184.41216 421.855232zM512.442368 421.855232c-49.989632 0-90.498048 40.516608-90.498048 90.49088 0 49.975296 40.50944 90.492928 90.498048 90.492928 49.99168 0 90.483712-40.517632 90.483712-90.492928C602.92608 462.37184 562.434048 421.855232 512.442368 421.855232zM838.038528 421.855232c-49.974272 0-90.483712 40.516608-90.483712 90.49088 0 49.975296 40.510464 90.492928 90.483712 90.492928 49.989632 0 90.500096-40.517632 90.500096-90.492928C928.538624 462.37184 888.02816 421.855232 838.038528 421.855232z","p-id":"2603",fill:"#ffffff"}})])},Ln=[],zn={},Wn=Object(Ae["a"])(zn,En,Ln,!1,null,null,null),jn=Wn.exports,Dn={name:"Common.ImageCard",props:{image:{type:Object,default:function(){return{}}},imageType:{type:String,default:"medium"},cardWidth:{type:Number,default:100},position:{type:Object,default:function(){return null}},absolute:{type:Boolean,default:!0},isCollection:{type:Boolean,default:!1}},components:{IconMore:jn},watch:{image:{immediate:!0,handler:function(){this.loading=!0,this.loadError=!1,this.removeEvents(),this.registerEvents()}}},data:function(){return{loading:!1,loadError:!1,block:!this.$store.state.showNSFW&&!!this.image.x_restrict,moreMenuVisible:!1}},created:function(){this.registerEvents()},beforeDestroy:function(){this.removeEvents()},computed:{source:function(){if(this.block||!this.image)return"";var e=this.image.image_urls[this.imageType].replace("i.pximg.net",this.getHost());return window.isSafari&&(e=e.replace("_10_webp","_70")),e},positionStyle:function(){if(!this.absolute)return null;var e=this.position?this.position.top:0,t=this.position?this.position.left:0;return{position:"absolute",top:"".concat(e,"px"),left:"".concat(t,"px")}},loadHeight:function(){return this.position?this.position.height:0},cardIdentifier:function(){return this.image?"".concat(this.image.index,"_").concat(this.image.id):""}},methods:{registerEvents:function(){this.$bus.$on("image-loaded-card-".concat(this.cardIdentifier),this.loadedHandler),this.$bus.$on("image-error-card-".concat(this.cardIdentifier),this.errorHandler)},removeEvents:function(){this.$bus.$off("image-loaded-card-".concat(this.cardIdentifier),this.loadedHandler),this.$bus.$off("image-error-card-".concat(this.cardIdentifier),this.errorHandler)},getHost:function(){var e=this.$config.image_proxy_host;if("object"!==Object(bt["a"])(e))return e;if(!e.idxList){var t=Object.keys(e);if(t&&Array.isArray(t)&&t.length)return t[0]}var i=Number(this.image.id)%e.idxList.length,n=e.idxList[i],a=e[n];return a},handleClick:function(){this.block||this.loadError||this.$emit("clicked",this.image.id)},loadedHandler:function(){this.loading=!1,this.loadError=!1,this.$forceUpdate()},errorHandler:function(){this.loading=!1,this.loadError=!0,this.$forceUpdate()},handleMoreCommand:function(e){switch(e){case"remove":this.$emit("remove",this.image.id);break}},handleMenuVisibleChanged:function(e){this.moreMenuVisible=e}}},Mn=Dn,Rn=Object(Ae["a"])(Mn,In,On,!1,null,null,null),An=Rn.exports,Pn=500,Fn=1e3,Nn={name:"Common.Waterfall",props:{images:{type:Array},cardWidth:{type:Number},imageType:{type:String},squaredImage:{type:Boolean,default:!1},gap:{type:Number,default:16},rowsPerSection:{type:Number,default:3},isCollection:{type:Boolean,default:!1}},components:{ImageCard:An},data:function(){return{positionMap:{},widthStore:{},heightStore:{},group:{},inGroup:{},sections:[{}],sectionsIdx:0,displayImages:[],storedImagesLength:0,currentSectionCount:0,containerWidth:0,maxHeight:0,screenWidth:document.documentElement.clientWidth,screenHeight:document.documentElement.clientHeight,scrollTop:document.documentElement.scrollTop,containerOffset:0,groupSize:Pn,additionalDistance:Fn}},computed:{columns:function(){return Math.floor((this.containerWidth+this.gap)/(this.cardWidth+this.gap))}},watch:{images:"imagesChanged",columns:"columnsChanged",cardWidth:"cardWidthChanged",screenWidth:function(e){var t=this;this.resizeTimer&&clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout((function(){t.screenWidthChanged(e)}),300)}},created:function(){this.resetWidthStore(),this.resetHeightStore(),this.resetPositionMap(),window.addEventListener("resize",this.handleWindowResize),window.addEventListener("scroll",this.handleScroll,{passive:!0})},mounted:function(){this.containerWidth=this.getContainerWidth(),this.containerOffset=this.getContainerOffset()},updated:function(){this.containerWidth=this.getContainerWidth()},beforeDestroy:function(){window.removeEventListener("resize",this.handleWindowResize),window.removeEventListener("scroll",this.handleScroll)},methods:{getContainerWidth:function(){return this.$refs.container?this.$refs.container.offsetWidth:0},getContainerOffset:function(){if(this.$refs.container){var e=document.documentElement.getBoundingClientRect(),t=this.$refs.container.getBoundingClientRect();return t.top-e.top}},imagesChanged:function(){this.images.length<=this.storedImagesLength?this.renderWaterfall():(this.computePosition(),this.setMaxHeight(),this.setDisplay()),this.storedImagesLength=this.images.length},columnsChanged:function(){this.renderWaterfall()},cardWidthChanged:function(){this.renderWaterfall()},screenWidthChanged:function(){this.containerWidth=this.getContainerWidth()},renderWaterfall:function(){this.resetGroup(),this.resetSections(),this.resetWidthStore(),this.resetHeightStore(),this.resetPositionMap(),this.setMaxHeight(),this.setDisplay()},setDisplay:function(){for(var e=this,t=this.rowsPerSection*this.columns,i=this.scrollTop-this.additionalDistance,n=this.scrollTop+this.screenHeight+this.additionalDistance,a=Math.floor(i/this.groupSize),o=Math.floor(n/this.groupSize),s=[],r={},c=function(i){r[i]||(s=s.concat(e.images.slice(i*t,(i+1)*t)),r[i]=!0)},l=a;l<=o;l++)this.group[l]&&this.group[l].forEach(c);window.requestAnimationFrame?window.requestAnimationFrame((function(){e.displayImages=s,e.$forceUpdate()})):(this.displayImages=s,this.$forceUpdate())},resetWidthStore:function(){this.widthStore={};for(var e=0;e<this.columns;e++)this.widthStore[e]=(this.cardWidth+this.gap)*e},resetHeightStore:function(){this.heightStore={};for(var e=0;e<this.columns;e++)this.heightStore[e]=0},resetPositionMap:function(){this.displayImages=[],this.positionMap={},this.computePosition()},resetGroup:function(){this.group={},this.inGroup={}},resetSections:function(){this.sections=[{}],this.currentSectionCount=0},computePosition:function(){var e=this;if(this.widthStore&&this.heightStore&&this.columns){var t=this.columns*this.rowsPerSection;this.images.forEach((function(i,n){var a=n;if(i.index=n,!e.positionMap[a]){e.$set(e.positionMap,a,{});var o,s,r,c=e.squaredImage?e.cardWidth:e.getLoadHeight(i);if(e.$set(e.positionMap[a],"height",c),n<e.columns)o=e.widthStore[n],s=0,r=n;else{var l=e.getMinHeightCol();o=e.widthStore[l],s=e.heightStore[l],r=l}e.currentSectionCount<t?e.currentSectionCount+=1:(e.currentSectionCount=1,e.sections.push({})),e.$set(e.positionMap[a],"left",o),e.$set(e.positionMap[a],"top",s),e.heightStore[r]+=c+e.gap;var d=e.sections.length-1,u=e.sections[d],h=u.head,m=u.tail;("undefined"===typeof h||s<h)&&(e.sections[d].head=s);var p=s+c;("undefined"===typeof m||p>m)&&(e.sections[d].tail=p)}})),this.sections.forEach((function(t,i){if(!e.inGroup[i]){var n=t.head,a=t.tail;if("undefined"!==typeof n&&"undefined"!==typeof a){for(var o=Math.floor(n/e.groupSize),s=Math.floor(a/e.groupSize),r=o;r<=s;r++)e.group[r]||(e.group[r]=[]),e.group[r].push(i);e.inGroup[i]=!0}}}))}},getLoadHeight:function(e){return Math.floor(e.height/(e.width/this.cardWidth))},getMinHeightCol:function(){for(var e=Number.MAX_VALUE,t=0,i=0;i<this.columns;i++)this.heightStore[i]<e&&(e=this.heightStore[i],t=i);return t},getMaxHeight:function(){for(var e=0,t=0;t<this.columns;t++)this.heightStore[t]>e&&(e=this.heightStore[t]);return e},setMaxHeight:function(){this.maxHeight=this.getMaxHeight()},handleCardClicked:function(e){this.$emit("card-clicked",e)},handleCardRemoved:function(e){this.$emit("card-removed",e)},handleWindowResize:function(){this.screenWidth=document.documentElement.clientWidth,this.screenHeight=document.documentElement.clientHeight,this.containerOffset=this.getContainerOffset()},handleScroll:function(){var e=this;this.scrollTimer&&(clearTimeout(this.scrollTimer),this.scrollTimer=null),this.scrollTimer=setTimeout((function(){e.handleScroll.apply(!0)}),200),this.lastScroll&&Date.now()-this.lastScroll<200||(this.lastScroll=Date.now(),this.containerOffset=this.getContainerOffset(),this.scrollTop=document.documentElement.scrollTop-this.containerOffset,this.setDisplay(),clearTimeout(this.scrollTimer),this.scrollTimer=null)}}},Un=Nn,Hn=Object(Ae["a"])(Un,Sn,Tn,!1,null,null,null),Bn=Hn.exports,qn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],class:["back2top",e.showClass?"back2top-show":""],on:{click:e.handleClick}},[i("i",{staticClass:"el-icon-top"})])},Vn=[],Gn=0,Yn={name:"Common.BackToTop",data:function(){return{show:!1,showClass:!1}},created:function(){window.addEventListener("scroll",this.handleScroll)},beforeDestroy:function(){window.removeEventListener("scroll",this.handleScroll)},methods:{hide:function(){var e=this;this.show&&(this.showClass=!1,setTimeout((function(){e.show=!1}),300)),Gn=window.pageYOffset},display:function(){var e=this;this.show||(this.show=!0,setTimeout((function(){e.showClass=e.show}),0))},handleScroll:function(){window.pageYOffset-Gn<-50?this.hide():window.pageYOffset-Gn>100&&(this.display(),Gn=window.pageYOffset)},handleClick:function(){window.scrollTo({top:0,behavior:"smooth"})}}},Jn=Yn,Qn=Object(Ae["a"])(Jn,qn,Vn,!1,null,null,null),Kn=Qn.exports,Xn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"rank-mode-switcher"},[i("div",{staticClass:"rank-mode-switcher-body"},[i("div",{staticClass:"rank-mode-item-row"},[i("div",{class:{"rank-mode-item":!0,"rank-mode-item-picked":"day"===e.mode},on:{click:function(t){return e.handleClick("day")}}},[i("span",[e._v("日排行榜")])]),i("div",{class:{"rank-mode-item":!0,"rank-mode-item-picked":"week"===e.mode},on:{click:function(t){return e.handleClick("week")}}},[i("span",[e._v("周排行榜")])]),i("div",{class:{"rank-mode-item":!0,"rank-mode-item-picked":"month"===e.mode},on:{click:function(t){return e.handleClick("month")}}},[i("span",[e._v("月排行榜")])])]),i("div",{staticClass:"rank-mode-item-row"},[i("div",{class:{"rank-mode-item":!0,"rank-mode-item-picked":"day_male"===e.mode},on:{click:function(t){return e.handleClick("day_male")}}},[i("span",[e._v("男性热榜")])]),i("div",{class:{"rank-mode-item":!0,"rank-mode-item-picked":"day_female"===e.mode},on:{click:function(t){return e.handleClick("day_female")}}},[i("span",[e._v("女性热榜")])]),i("div",{class:{"rank-mode-item":!0,"rank-mode-item-picked":"week_original"===e.mode},on:{click:function(t){return e.handleClick("week_original")}}},[i("span",[e._v("原创周榜")])]),i("div",{class:{"rank-mode-item":!0,"rank-mode-item-picked":"week_rookie"===e.mode},on:{click:function(t){return e.handleClick("week_rookie")}}},[i("span",[e._v("新人周榜")])])]),i("div",{staticClass:"rank-mode-item-row"},[i("div",{class:{"rank-mode-item":!0,"rank-mode-item-picked":"day_ai"===e.mode},on:{click:function(t){return e.handleClick("day_ai")}}},[i("span",[e._v("AI 日榜")])]),i("div",{class:{"rank-mode-item":!0,"rank-mode-item-picked":"day_r18"===e.mode},on:{click:function(t){return e.handleClick("day_r18")}}},[i("span",[e._v("R18 日榜")])]),i("div",{class:{"rank-mode-item":!0,"rank-mode-item-picked":"day_r18_ai"===e.mode},on:{click:function(t){return e.handleClick("day_r18_ai")}}},[i("span",[e._v("R18-AI 日榜")])])]),i("div",{staticClass:"rank-mode-item-row"},[i("div",{class:{"rank-mode-item":!0,"rank-mode-item-picked":"day_male_r18"===e.mode},on:{click:function(t){return e.handleClick("day_male_r18")}}},[i("span",[e._v("R18 男性日榜")])]),i("div",{class:{"rank-mode-item":!0,"rank-mode-item-picked":"day_female_r18"===e.mode},on:{click:function(t){return e.handleClick("day_female_r18")}}},[i("span",[e._v("R18 女性日榜")])]),i("div",{class:{"rank-mode-item":!0,"rank-mode-item-picked":"week_r18"===e.mode},on:{click:function(t){return e.handleClick("week_r18")}}},[i("span",[e._v("R18 周榜")])]),i("div",{class:{"rank-mode-item":!0,"rank-mode-item-picked":"week_r18g"===e.mode},on:{click:function(t){return e.handleClick("week_r18g")}}},[i("span",[e._v("R18-G 周榜")])])]),i("div",{staticClass:"rank-mode-item-row"},[i("div",{class:{"rank-mode-item":!0,"rank-mode-item-picked":"day_manga"===e.mode},on:{click:function(t){return e.handleClick("day_manga")}}},[i("span",[e._v("漫画日榜")])]),i("div",{class:{"rank-mode-item":!0,"rank-mode-item-picked":"week_manga"===e.mode},on:{click:function(t){return e.handleClick("week_manga")}}},[i("span",[e._v("漫画周榜")])]),i("div",{class:{"rank-mode-item":!0,"rank-mode-item-picked":"month_manga"===e.mode},on:{click:function(t){return e.handleClick("month_manga")}}},[i("span",[e._v("漫画月榜")])])]),i("div",{staticClass:"rank-mode-item-row"},[i("div",{class:{"rank-mode-item":!0,"rank-mode-item-picked":"week_rookie_manga"===e.mode},on:{click:function(t){return e.handleClick("week_rookie_manga")}}},[i("span",[e._v("漫画新人周榜")])]),i("div",{class:{"rank-mode-item":!0,"rank-mode-item-picked":"day_r18_manga"===e.mode},on:{click:function(t){return e.handleClick("day_r18_manga")}}},[i("span",[e._v("R18 漫画日榜")])]),i("div",{class:{"rank-mode-item":!0,"rank-mode-item-picked":"week_r18_manga"===e.mode},on:{click:function(t){return e.handleClick("week_r18_manga")}}},[i("span",[e._v("R18 漫画周榜")])])])])])},Zn=[],ea={name:"Rank.ModeSwitcher",props:["mode"],methods:{handleClick:function(e){this.$emit("mode-changed",e)}}},ta=ea,ia=Object(Ae["a"])(ta,Xn,Zn,!1,null,null,null),na=ia.exports,aa=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"rank-date-switcher"},[i("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","picker-options":e.pickerOpt},on:{change:e.handleChange},model:{value:e.selectDate,callback:function(t){e.selectDate=t},expression:"selectDate"}})],1)},oa=[],sa={name:"Rank.DateSwitcher",props:["date"],data:function(){return{selectDate:this.date.toDate(),pickerOpt:{disabledDate:function(e){return e&&e.valueOf()>Date.now()-1728e5}}}},methods:{handleChange:function(e){this.$emit("date-selected",e)}}},ra=sa,ca=Object(Ae["a"])(ra,aa,oa,!1,null,null,null),la=ca.exports,da={getCardWidth:function(e){return e>=768?280:(document.documentElement.clientWidth-64)/2}},ua=function(e,t){return new Proxy(t,{apply:function(t,i,n){var a;return(a=e.setAttribute).call.apply(a,[e].concat(Object(pt["a"])(n))),t.call.apply(t,[i].concat(Object(pt["a"])(n)))}})},ha=function(){if(xi)return xi;var e=document.querySelector("#og-title");e.setAttribute=ua(document.querySelector("#meta-name"),e.setAttribute);var t=document.querySelector("#og-desc");t.setAttribute=ua(document.querySelector("#meta-desc"),t.setAttribute);var i=document.querySelector("#og-image");return i.setAttribute=ua(document.querySelector("#meta-image"),i.setAttribute),xi={ogTitle:e,ogDesc:t,ogImage:i,ogUrl:document.querySelector("#og-url")},xi},ma=function(e,t){Object.keys(t).forEach((function(i){var n;null===(n=e[i])||void 0===n||n.setAttribute("content",t[i])}))},pa={day:"日排行榜",week:"周排行榜",month:"月排行榜",day_male:"男性热榜",day_female:"女性热榜",week_original:"原创周榜",week_rookie:"新人周榜",day_ai:"AI 日榜",day_r18:"R18 日榜",day_r18_ai:"R18-AI 日榜",day_male_r18:"R18 男性日榜",day_female_r18:"R18 女性日榜",week_r18:"R18 周榜",week_r18g:"R18-G 周榜",day_manga:"漫画日榜",week_manga:"漫画周榜",month_manga:"漫画月榜",week_rookie_manga:"漫画新人周榜",day_r18_manga:"R18 漫画日榜",week_r18_manga:"R18 漫画周榜"},ga={name:"Rank",components:{Waterfall:Bn,BackToTop:Kn,ModeSwitcher:na,DateSwitcher:la},data:function(){return{page:null!==this.$store.state.rank.page?this.$store.state.rank.page:1,dateObject:this.$store.state.rank.date?this.$store.state.rank.date:Ni()().subtract(2,"day"),mode:this.initMode()||"day",images:this.$store.state.rank.images?this.$store.state.rank.images:[],backDateText:"前一",nextDateText:"后一",routeFrom:"",waterfallIdentifier:Math.round(100*Math.random()),screenWidth:document.documentElement.clientWidth,cardWidth:this.getCardWidth(document.documentElement.clientWidth),waterfallResponsive:document.documentElement.clientWidth>767,scrollTop:0,loadFailed:!1,cachedState:null,iPadStyle:/iPad/i.test(navigator.userAgent)}},computed:{date:function(){return this.dateObject.format("YYYY-MM-DD")},modeText:function(){return pa[this.mode]},dateUnit:function(){return this.mode.includes("day")?"天":this.mode.includes("week")?"周":this.mode.includes("month")?"月":this.mode},displayDate:function(){return this.mode.includes("day")?this.dateObject.format("YYYY-MM-DD"):this.mode.includes("week")?"".concat(this.dateObject.format("YYYY-MM")," 第 ").concat(Math.floor(this.dateObject.date()/7)+1," 周"):this.mode.includes("month")?this.dateObject.format("YYYY-MM"):this.dateObject.format("YYYY-MM-DD")},showDateNext:function(){return(Ni()().startOf("day").unix()-this.dateObject.unix())/86400>2},mobileWaterfallWidth:function(){return 2*this.cardWidth+32}},watch:{dateObject:function(){this.$store.commit("rank/setDate",this.dateObject)},page:function(){this.$store.commit("rank/setPage",this.page)},mode:function(){var e=this;this.$store.commit("rank/setMode",this.mode),this.$nextTick((function(){e.setOgTagData()}))},screenWidth:function(e){var t=this;this.resizeTimer&&clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout((function(){t.screenWidth=e,t.scrollTop=document.documentElement.scrollTop,t.screenWidth<=767?t.waterfallResponsive=!1:t.waterfallResponsive=!0,t.$nextTick((function(){t.cardWidth=t.getCardWidth(t.screenWidth),document.documentElement.scrollTop=t.scrollTop}))}),300)}},created:function(){this.routeFrom=this.$cookies.get("rank-from"),"Landing"===this.routeFrom&&(this.routeFrom=null)},mounted:function(){var e=this,t=parseInt(this.$cookies.get("rank-scroll"),10);this.images.length>0?t&&this.$nextTick((function(){window.scrollTo(0,t),t>300&&e.$refs.backToTop&&e.$refs.backToTop.display()})):this.$cookies.set("rank-scroll",0,"1h");var i=this.$cookies.get("rank-reset");"true"===i&&this.reset(),this.$cookies.remove("rank-reset"),this.$nextTick((function(){window.addEventListener("resize",e.windowResized,!1),window.addEventListener("scroll",e.handleScroll,!1)})),document.title="".concat(this.modeText," - Pixiviz"),this.setOgTagData()},beforeDestroy:function(){window.removeEventListener("scroll",this.handleScroll,!1),window.removeEventListener("resize",this.windowResized,!1)},methods:{infiniteHandler:function(e){var t=this;this.cachedState=e,this.axios.get("".concat(this.$config.api_prefix,"/rank"),{params:{mode:this.mode,date:this.date,page:this.page}}).then((function(i){if(i.data&&i.data.illusts)if(0!==i.data.illusts.length){var n=Rt(i.data.illusts);t.images=t.images.concat(n),t.$store.commit("rank/setImages",t.images),t.$refs.waterfall&&(t.$refs.waterfall.firstLoad=!1),t.page+=1,t.$store.commit("rank/setPage",t.page),e.loaded()}else e.complete();else e.complete()}),(function(i){console.error("Failed to fetch rank data.",i),e.complete(),t.loadFailed=!0,t.cachedState=null}))},refreshWaterfall:function(){this.page=1,this.images=[],this.waterfallIdentifier+=1,this.$forceUpdate()},reset:function(){this.page=1;var e=this.$cookies.get("rank-mode");this.mode=e||"day",this.dateObject=Ni()().subtract(2,"day"),this.images=[],this.waterfallIdentifier+=1,this.$forceUpdate()},fetchNew:function(){var e=this;this.loadFailed=!1,this.images?this.$nextTick((function(){var t;null===(t=e.cachedState)||void 0===t||t.reset()})):this.$nextTick((function(){e.refreshWaterfall(),window.scrollTo(0,0)}))},initMode:function(){var e=this.$route.query.mode;e&&this.$store.commit("rank/setMode",e);var t=this.$store.state.rank.mode;if(t)return t;var i=this.$cookies.get("rank-mode");return i||"day"},handleModeChanged:function(e){this.mode=e||"day",document.title="".concat(this.modeText," - Pixiviz"),this.$cookies.set("rank-mode",this.mode,"1h"),this.$router.replace({query:{mode:this.mode}}),this.refreshWaterfall()},handleBack:function(){this.routeFrom?this.$router.push("".concat(this.routeFrom)):this.$router.push("/")},handleDateChanged:function(e){"天"===this.dateUnit?this.dateObject=this.dateObject.add(1*e,"day"):"周"===this.dateUnit?this.dateObject=this.dateObject.add(1*e,"week"):"月"===this.dateUnit&&(this.dateObject=this.dateObject.add(1*e,"month")),this.$refs.dateSwitcher.selectDate=this.dateObject.toDate(),this.refreshWaterfall()},handleDateSelected:function(e){this.dateObject=Ni()(e),this.refreshWaterfall()},handleCardClicked:function(e){this.$cookies.set("pic-from","rank","1h");var t=window.pixiviz.infoMap[e];t&&this.$store.commit("imageCache/setCache",t),this.$router.push("/pic/".concat(e))},handleScroll:function(){this.$cookies.set("rank-scroll",document.documentElement.scrollTop,"1h")},windowResized:function(){this.screenWidth=document.documentElement.clientWidth},getCardWidth:function(e){return da.getCardWidth(e)},setOgTagData:function(){ma(ha(),{ogTitle:"".concat(this.modeText," - Pixiviz"),ogDesc:"最新二次元插画排行 - ".concat(this.modeText,"，跨次元链接"),ogUrl:window.location.href,ogImage:"".concat(this.$config.website_url,"/favicon.png")})}}},fa=ga,va=Object(Ae["a"])(fa,Cn,$n,!1,null,null,null),wa=va.exports,ba=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.infoLoading,expression:"infoLoading"}],class:["pic-container",e.infoLoading?"pic-container-loading":null,e.block||e.loadFailed?"pic-container-failed":null,e.lightboxShow?"pic-container-lockscroll":null],attrs:{"element-loading-text":"正在获取画作信息"}},[e.showPic?i("div",{staticClass:"pic"},[i("div",{staticClass:"pic-presentation"},[i("Presentation",{directives:[{name:"show",rawName:"v-show",value:e.image,expression:"image"}],ref:"presentation",attrs:{image:e.image,block:e.block,loaded:e.imageLoaded},on:{"image-load":e.handleImageLoad,"image-loaded":e.handleImageLoaded,"download-current":e.startDownloadCurrent,"lightbox-open":e.handleLightBoxOpen,"lightbox-close":e.handleLightBoxClose}})],1),i("div",{staticClass:"pic-side"},[i("Author",{directives:[{name:"show",rawName:"v-show",value:e.author,expression:"author"}],attrs:{author:e.author,imageId:e.image?e.image.id:null},on:{navigate:e.handleArtistNavigate,close:e.handleClose}}),i("Download",{directives:[{name:"show",rawName:"v-show",value:e.image,expression:"image"}],ref:"download",attrs:{image:e.image,loaded:e.imageLoaded},on:{"download-current":e.startDownloadCurrent}}),i("Related",{directives:[{name:"show",rawName:"v-show",value:e.relatedImages.length>0,expression:"relatedImages.length > 0"}],key:e.showPart,ref:"related",attrs:{images:e.showPart?e.imageSlice:e.relatedImages,oimages:e.relatedImages,page:e.relatedPage,offset:e.pageOffset,completed:e.relatedCompleted,orientation:e.screenOrientation},on:{go:e.handleRelatedPageChanged,"infite-load":e.handleRelatedInfiniteLoad,"change-page-size":e.handlePageSizeChanged}})],1)]):e._e(),e.block?i("Overlay",{attrs:{text:"很抱歉，我们不能展示这幅作品"}}):e._e(),e.loadFailed?i("Overlay",{attrs:{text:"您想看的作品似乎走丢了",showRefresh:!0}}):e._e(),!e.infoLoading&&e.actionShow?i("div",{class:["pic-action",e.actionShowClass?"pic-action-show":null]},[i("HomeIcon",{on:{action:e.handleAction}}),i("RankIcon",{on:{action:e.handleAction}}),i("LinkIcon",{on:{action:e.handleAction}}),i("BackIcon",{on:{action:e.handleAction}})],1):e._e()],1)},ka=[],ya=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"pic-presentation-image-wrapper",style:{width:e.imageWidth+"px"}},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.imageLoading,expression:"imageLoading"}],class:{"pic-presentation-image":!0,"pic-presentation-image__firstload":e.imageFirstLoad},style:e.imageSizeStyles,attrs:{"element-loading-text":e.imageLoadingText}},[e.isUgoira&&e.ugoiraLoaded?i("img",{ref:"image",style:e.imageSizeStyles,attrs:{src:e.ugoiraSource}}):i("img",{directives:[{name:"context",rawName:"v-context",value:"context",expression:"'context'"}],ref:"image",style:e.imageSizeStyles,attrs:{src:e.loadingSource},on:{click:e.openLightBox}}),i("div",{staticStyle:{clear:"both"}}),e.imageLoadError?i("div",{staticClass:"pic-presentation-image-error"},[e._m(0),e._m(1)]):e._e()]),i("Paginator",{attrs:{page:e.page,pageCount:e.image?e.image.page_count:0},on:{"page-turn":e.handlePageChanged}}),e.image?i("div",{staticClass:"pic-presentation-info"},[i("div",{staticClass:"pic-presentation-info-title"},[i("span",[e._v(e._s(e.image?e.image.title:""))]),i("i",{staticClass:"icon-star",on:{click:e.doCollect}},[e.inCollection?i("StarFill"):i("Star")],1),e.renderShareOverlay?i("i",{ref:"shareIcon",on:{click:e.openShareOverlay}},[i("Share")],1):i("i",{ref:"shareIcon"},[i("Share")],1)]),i("div",{staticClass:"pic-presentation-info-caption"},[i("a",{attrs:{href:"https://www.pixiv.net/artworks/"+e.image.id,target:"_blank",rel:"noopenner noreferrer"}},[e._v("在 Pixiv 上查看")]),i("a",{staticClass:"show_comments",on:{click:function(t){e.showComments=!0}}},[e._v("查看评论")])]),i("div",{staticClass:"pic-presentation-info-caption"},[i("span",{domProps:{innerHTML:e._s(e.image?e.image.caption:"")}})]),i("div",{staticClass:"pic-presentation-info-tags"},e._l(e.tags,(function(t){return i("div",{key:t.id,staticClass:"pic-tag"},[i("a",{attrs:{"data-tag":t.name},on:{click:e.handleTagClicked}},[e._v("#"+e._s(t.name))])])})),0),i("div",{staticClass:"pic-presentation-info-stat"},[i("div",{staticClass:"pic-stat"},[i("i",{staticClass:"el-icon-view"}),i("span",[e._v(e._s(e.views))])]),i("div",{staticClass:"pic-stat"},[i("i",{staticClass:"el-icon-star-on"}),i("span",[e._v(e._s(e.bookmarks))])])]),i("div",{staticClass:"pic-presentation-info-time"},[i("span",[e._v(e._s(e.createTime))])])]):e._e(),e.lightBoxShow?i("LightBox",{attrs:{src:e.lightBoxSource,isLanding:e.isLanding,isOverHeight:e.isOverHeight,isMobileOverHeight:e.isMobileOverHeight},on:{loaded:e.handleLightBoxLoaded,close:e.onLightBoxClose,download:e.callDownload,copy:e.copyImage}}):e._e(),i("ContextMenu",{ref:"context",attrs:{width:128},on:{"item-clicked":e.handleContextClicked}},[i("ContextMenuItem",{attrs:{name:"down"}},[e._v("下载")]),e.showCopyImage?i("ContextMenuItem",{attrs:{name:"copy-image"}},[e._v("复制图片")]):e._e()],1),e.renderShareOverlay?i("ShareOverlay",{directives:[{name:"show",rawName:"v-show",value:e.showShareOverlay,expression:"showShareOverlay"}],ref:"shareOverlay",class:{"share-overlay--wechat":e.isInWechat},on:{close:e.handleShareOverlayClose}}):e._e(),i("el-dialog",{attrs:{visible:e.showComments},on:{"update:visible":function(t){e.showComments=t}}},[e.showComments?i("iframe",{staticStyle:{width:"100%",height:"60vh",border:"0"},attrs:{src:"https://now.pixiv.pics/#/comments/"+e.image.id}}):e._e()])],1)},_a=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"pic-presentation-image-error-icon"},[i("i",{staticClass:"el-icon-warning-outline"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"pic-presentation-image-error-tip"},[i("span",[e._v("图片加载失败")])])}],xa=i("ade3"),Ca=(i("3ca3"),i("ddb0"),i("2b3d"),i("9861"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.pageCount>1?i("div",{staticClass:"pic-presentation-page"},[i("div",{staticClass:"pic-presentation-page-back",on:{click:function(t){return e.handleGo(-1)}}},[e.page>1?[i("i",{staticClass:"el-icon-arrow-left"}),i("span",[e._v("前一页")])]:e._e()],2),e.pageCount<=1?i("div",{staticClass:"pic-presentation-page-back"}):e._e(),i("div",{staticClass:"pic-presentation-page-number"},[i("span",[e._v(e._s(e.page)+" / "+e._s(e.pageCount))])]),e.page<e.pageCount?i("div",{staticClass:"pic-presentation-page-next",on:{click:function(t){return e.handleGo(1)}}},[i("span",[e._v("下一页")]),i("i",{staticClass:"el-icon-arrow-right"})]):e._e(),e.page>=e.pageCount?i("div",{staticClass:"pic-presentation-page-next"}):e._e()]):e._e()}),$a=[],Sa={name:"Pic.Pagniator",props:["page","pageCount"],methods:{handleGo:function(e){this.$emit("page-turn",e)}}},Ta=Sa,Ia=Object(Ae["a"])(Ta,Ca,$a,!1,null,null,null),Oa=Ia.exports,Ea=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:["lightbox",{"lightbox--anim":e.anim}],on:{click:e.handleClick}},[i("img",{class:["lightbox-content",e.isLanding?"lightbox-content-landing":null,e.isOverHeight?"lightbox-content-overheight":null,e.isMobileOverHeight?"lightbox-content-mobileoverheight":null],attrs:{src:e.src},on:{load:e.handleOnLoad}})])},La=[],za=(i("130f"),{name:"Pic.LightBox",props:["src","isLanding","isOverHeight","isMobileOverHeight"],watch:{src:{immediate:!0,handler:function(e){this.imageUrl=e,this.loaded=!1}}},data:function(){return{loaded:!1,anim:!1,imageUrl:""}},mounted:function(){var e=this;setImmediate((function(){e.anim=!0}))},beforeDestroy:function(){this.imageUrl=""},methods:{handleClick:function(){var e=this;this.anim=!1,setTimeout((function(){e.$emit("close")}),100)},handleOnLoad:function(){this.loaded=!0,this.$emit("loaded")}}}),Wa=za,ja=Object(Ae["a"])(Wa,Ea,La,!1,null,null,null),Da=ja.exports,Ma=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("svg",{attrs:{viewBox:"0 0 512 512"}},[i("path",{attrs:{d:"M444.7 230.4l-141.1-132c-1.7-1.6-3.3-2.5-5.6-2.4-4.4.2-10 3.3-10 8v66.2c0 2-1.6 3.8-3.6 4.1C144.1 195.8 85 300.8 64.1 409.8c-.8 4.3 5 8.3 7.7 4.9 51.2-64.5 113.5-106.6 212-107.4 2.2 0 4.2 2.6 4.2 4.8v65c0 7 9.3 10.1 14.5 5.3l142.1-134.3c2.6-2.4 3.4-5.2 3.5-8.4-.1-3.2-.9-6.9-3.4-9.3z",fill:"currentColor"}})])},Ra=[],Aa={},Pa=Object(Ae["a"])(Aa,Ma,Ra,!1,null,null,null),Fa=Pa.exports,Na=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("svg",{attrs:{width:"1em",height:"1em",viewBox:"0 0 256 256"}},[i("path",{attrs:{fill:"currentColor",d:"M187.3 232a16.1 16.1 0 0 1-8.7-2.6l-50.5-31.9h-.2L81 227.2a18 18 0 0 1-20.1-.6a18.6 18.6 0 0 1-7-19.6l13.5-53.1a.8.8 0 0 0-.2-.8L22 115.5a16.8 16.8 0 0 1-5.2-18.1A16.4 16.4 0 0 1 31.4 86l59-3.8a.5.5 0 0 0 .4-.3l22-55.5a16.3 16.3 0 0 1 30.4 0l22 55.5a.5.5 0 0 0 .4.3l59 3.8a16.4 16.4 0 0 1 14.6 11.4a16.8 16.8 0 0 1-5.2 18.1l-45.2 37.6a.8.8 0 0 0-.2.8l14.5 57.3a16.6 16.6 0 0 1-6.3 17.7a16.8 16.8 0 0 1-9.5 3.1ZM128 181.5a16 16 0 0 1 8.7 2.5l50.4 31.9h.2a.7.7 0 0 0 .3-.3c.1-.1.1-.2 0-.6l-14.5-57.3a16.8 16.8 0 0 1 5.4-17l45.3-37.6c.1-.1.3-.3.1-.8s-.2-.4-.3-.4l-59.1-3.8a16.4 16.4 0 0 1-14.1-10.4l-22.1-55.4c-.1-.3-.2-.3-.3-.3s-.2 0-.3.3l-22.1 55.5a16.4 16.4 0 0 1-14.1 10.4L32.4 102c-.1 0-.2 0-.3.4s0 .7.1.8l45.3 37.6a16.8 16.8 0 0 1 5.4 17L69.4 211a2.5 2.5 0 0 0 .9 2.6a1.6 1.6 0 0 0 2.1.1l46.9-29.7a16 16 0 0 1 8.7-2.5Z"}})])},Ua=[],Ha={name:"PhStar"},Ba=Ha,qa=Object(Ae["a"])(Ba,Na,Ua,!1,null,null,null),Va=qa.exports,Ga=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("svg",{attrs:{width:"1em",height:"1em",viewBox:"0 0 256 256"}},[i("path",{attrs:{fill:"currentColor",d:"m234 115.5l-45.2 37.6l14.3 58.1a16.5 16.5 0 0 1-15.8 20.8a16.1 16.1 0 0 1-8.7-2.6l-50.5-31.9h-.2L81 227.2a18 18 0 0 1-20.1-.6a18.5 18.5 0 0 1-7-19.6l13.5-53.1L22 115.5a16.8 16.8 0 0 1-5.2-18.1A16.5 16.5 0 0 1 31.4 86l59-3.8l22.4-55.8A16.4 16.4 0 0 1 128 16a16.4 16.4 0 0 1 15.2 10.4l22 55.5l59.4 4.1a16.4 16.4 0 0 1 14.6 11.4a16.8 16.8 0 0 1-5.2 18.1Z"}})])},Ya=[],Ja={name:"PhStarFill"},Qa=Ja,Ka=Object(Ae["a"])(Qa,Ga,Ya,!1,null,null,null),Xa=Ka.exports,Za=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"share-overlay",on:{click:function(t){return t.stopPropagation(),e.handleOverlayClicked.apply(null,arguments)}}},[e._m(0)])},eo=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"share-overlay-control"},[i("div",{staticClass:"share-overlay-control__icon"},[i("i",{staticClass:"el-icon-top"})]),i("div",{staticClass:"share-overlay-control__text"},[i("span",[e._v("点击上方按钮进行分享")])])])}],to={methods:{handleOverlayClicked:function(){this.$emit("close"),document.documentElement.classList.remove("no-scrollbar")}}},io=to,no=Object(Ae["a"])(io,Za,eo,!1,null,null,null),ao=no.exports,oo=i("c4e3"),so=i.n(oo),ro=function(){function e(t){var i=t.url,n=t.frames;Object(St["a"])(this,e),this.zipUrl=i,this.frames=n,this.blobMap=null,this.currentFrame=0,this.onFrame=null,this.status="stopped"}return Object($t["a"])(e,[{key:"load",value:function(){var e=this;if(!this.zipUrl)throw new Error("Ugoria zipUrl is not set.");return new Promise((function(t){var i=new XMLHttpRequest;i.open("GET",e.zipUrl,!0),i.responseType="arraybuffer",i.onload=function(){4!==i.readyState||200!==i.status&&304!==i.status||(e.zipData=i.response,e.loaded=!0,e.progress=100,t(i.response))},i.onprogress=function(t){e.progress=parseInt(t.loaded/t.total*100,10)},i.onloadstart=function(){e.progress=0},i.onloadend=function(){e.progress=100},i.onerror=function(){this.progress=0,t(null)},i.onabort=function(){this.progress=0,t(null)},e.request=i,i.send()}))}},{key:"parse",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t,i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=new so.a,e.next=3,t.loadAsync(this.zipData);case 3:return i=e.sent,n={},e.next=7,Promise.all(this.frames.map((function(e){return new Promise((function(t){i.file(e.file).async("arraybuffer").then((function(i){n[e.file]=window.URL.createObjectURL(new Blob([i],{type:"image/jpeg"})),t()}))}))})));case 7:return this.blobMap=n,this.fullyLoaded=!0,e.abrupt("return",n);case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"play",value:function(){var e=this;if(this.fullyLoaded){if(!this.blobMap)throw new Error("blobMap is empty.");if("function"!==typeof this.onFrame)throw new Error("Cannot locate the onFrame function.");var t=function t(){if("stopped"!==e.status){var i=e.frames[e.currentFrame],n=i.file,a=i.delay,o=0===e.currentFrame?e.frames[e.frames.length-1].delay:e.frames[e.currentFrame-1].delay;(!e.lastFrameTime||e.lastFrameTime&&Date.now()-e.lastFrameTime>=o)&&(e.onFrame.call(e,e.blobMap[n]),e.lastFrameTime=Date.now()),e.currentFrame===e.frames.length-1?e.currentFrame=0:e.currentFrame+=1,setTimeout((function(){t()}),a)}};this.status="playing",t()}}},{key:"stop",value:function(){this.frameTimeout&&(clearTimeout(this.frameTimeout),this.frameTimeout=null),this.status="stopped"}},{key:"cancel",value:function(){this.request&&this.request.abort()}}]),e}(),co=ro,lo=i("2ad9"),uo=i("49f6"),ho="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",mo={name:"Pic.Presentation",props:{image:{type:Object},block:{type:Boolean},loaded:{type:Boolean}},components:{Paginator:Oa,LightBox:Da,ShareOverlay:ao,Share:Fa,Star:Va,StarFill:Xa},data:function(){var e=this;return{showComments:!1,sizeCache:{},limitWidth:1152,limitHeight:796,screenWidth:document.documentElement.clientWidth,screenHeight:document.documentElement.clientHeight,imageEl:null,loadingSource:ho,lightBoxSource:"",useLarge:!1,imageSize:{},imageObjs:{},imageWidth:0,imageHeight:0,imageFirstLoad:!1,imageFirstLoaded:!1,imageLoading:!0,imageLoadError:!1,imageLoadTooLong:!1,imageLoadTimer:null,page:1,lightBoxShow:!1,showCopyImage:!!window.ClipboardItem,isUgoira:!1,ugoira:null,ugoiraSource:ho,ugoiraLoaded:!1,ugoiraObserver:window.IntersectionObserver?new IntersectionObserver((function(t){t.forEach((function(t){t.isIntersecting&&e.ugoira&&"stopped"===e.ugoira.status?e.ugoira.play():!t.isIntersecting&&e.ugoira&&"playing"===e.ugoira.status&&e.ugoira.stop()}))})):null,isInQQ:navigator.userAgent.includes("QQ/"),isInWechat:navigator.userAgent.includes("MicroMessenger/"),showShareOverlay:!1,inCollection:!1}},beforeCreate:function(){window.isSafari&&(window.pixiviz.downloadQueue||(window.pixiviz.downloadQueue=[]),window.pixiviz.downloadCounter||(window.pixiviz.downloadCounter=0))},created:function(){this.$bus.$on("download-ugoira",this.downloadUgoira)},mounted:function(){var e=this;this.imageEl=this.$refs.image,window.addEventListener("resize",this.windowResized,!1),this.setLimitWidth(this.screenWidth),this.renderShareOverlay||Object(lo["a"])({key:"share",platforms:[uo["a"],uo["b"],uo["c"]],meta:{title:this.shareTitle,url:window.location.href,desc:this.shareDesc,image:this.shareImage},ref:this.$refs.shareIcon,trigger:"hover",placement:"bottom-end",options:{wechatSharePage:"https://wechat-share.pwp.space/?url={url}&title={title}".concat(window.pixiviz.darkMode?"&dark=1":"")}}),this.$nextTick((function(){"1"===e.$route.query.wechat_share&&e.isInWechat&&e.openShareOverlay()}))},beforeDestroy:function(){window.removeEventListener("resize",this.windowResized,!1),this.cancelAllLoad(),this.progressInterval&&(clearInterval(this.progressInterval),this.progressInterval=null),this.$bus.$off("download-ugoira",this.downloadUgoira)},watch:{image:{immediate:!0,handler:function(e){var t=this;this.$refs.image&&this.ugoiraObserver&&this.ugoiraObserver.unobserve(this.$refs.image),this.imageLoading=!0,this.imageLoadError=!1,this.imageLoadTooLong=!1,clearTimeout(this.imageLoadTimer),this.imageLoadTimer=null,this.page=1,this.sizeCache={},this.cancelAllLoad(),this.imageObjs={},this.imageSize.x=e?e.width:0,this.imageSize.y=e?e.height:0,"ugoira"===e.type?this.isUgoira=!0:this.isUgoira=!1,this.ugoira&&(this.ugoira.stop(),this.ugoira=null),this.ugoiraSource=ho,this.ugoiraLoaded=!1,this.$store.commit("pic/setProgress",0),this.$store.commit("pic/setUgoiraProgress",0),this.$store.commit("pic/setUgoiraStatus",null);var i=document.documentElement.clientWidth;this.setLimitWidth(i),this.checkMobileMode(i),this.setImageSize(e),this.checkFirstLoad(e),this.checkInCollection(e),this.tryLoad(),this.imageLoadTimer=setTimeout((function(){t.imageLoadTooLong=!0}),5e3),this.$emit("image-load"),this.pushUserHistory(e)}},screenWidth:function(){this.setLimitWidth(),this.updateDisplaySize()}},computed:{source:function(){return this.image&&this.image.meta_single_page?this.block?ho:this.image&&this.image.page_count<2?this.image.meta_single_page.original_image_url.replace("i.pximg.net",this.getProxyHost(this.image.id)):this.image&&this.image.page_count>=2?this.image.meta_pages[this.page-1].image_urls.original.replace("i.pximg.net",this.getProxyHost(this.image.id)):ho:ho},largeSource:function(){return this.getImageSource({image:this.image,type:"large"})},imageSizeStyles:function(){var e={width:"".concat(this.imageWidth,"px"),height:"".concat(this.imageHeight,"px").concat(this.loaded?"":" !important")};return this.isUgoira&&Object.assign(e,{transform:"translate3d(0, 0, 0);",cursor:"default;"}),e},tags:function(){return this.image?this.image.tags:[]},views:function(){return this.image?this.image.total_view:0},bookmarks:function(){return this.image?this.image.total_bookmarks:0},createTime:function(){return this.image?Ni()(this.image.create_date).format("YYYY 年 MM 月 DD 日"):null},isLanding:function(){return this.imageWidth<this.imageHeight},isOverHeight:function(){return this.imageHeight/(this.imageWidth/this.screenWidth)>this.screenHeight},isMobileOverHeight:function(){return this.imageWidth/(this.imageHeight/this.screenHeight)>this.screenHeight},imageLoadingText:function(){return this.mobileMode?"大图加载中（".concat(this.$store.state.pic.progress,"%）"):this.imageLoadTooLong?"图片体积较大，请耐心等待~":null},shareDesc:function(){return this.image.caption?"".concat(this.image.caption,"\n\n分享自Pixiviz"):"分享自 Pixiviz"},shareImage:function(){return this.getImageSource({image:this.image,type:"large",page:this.getPage(),usePublicProxy:!0})||"".concat(this.$config.website_url,"/favicon.png")},shareTitle:function(){return this.image&&this.image.title?"".concat(this.image.title," - ").concat(this.image.user.name||"Pixiviz"):"Pixiviz"},renderShareOverlay:function(){return this.isInQQ||this.isInWechat}},methods:{tryLoad:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.lightBoxSource="",e.useLarge=!1,!e.imageObjs[e.page]){t.next=8;break}if(i=e.imageObjs[e.page],!/^blob:/.test(i.src)&&!i.lightboxShowed){t.next=8;break}return e.useLarge=!!e.imageObjs[e.page].useLarge,e.onLoaded(e.imageObjs[e.page]),t.abrupt("return");case 8:e.imageEl&&e.imageEl.setAttribute("src",ho),n=new Image,n.onload=function(){return e.onLoaded(n)},n.onerror=function(){return e.onLoadError()},n.load(e.largeSource),e.useLarge=!0,e.imageObjs[e.page]=n,e.imageObjs[e.page].useLarge=e.useLarge,e.isUgoira&&e.getUgoira();case 17:case"end":return t.stop()}}),t)})))()},getUgoira:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var i,n,a,o,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.axios.get("".concat(e.$config.api_prefix,"/ugoira_metadata"),{params:{id:e.image.id}});case 3:i=t.sent,t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](0),console.error("Failed to fetch ugoira meta data.",t.t0);case 9:return n=i.data.ugoira_metadata,a=n.zip_urls,e.ugoira=new co({url:e.getUgoiraSource(a.original||a.medium),frames:n.frames}),e.ugoiraProgressInterval=setInterval((function(){e.$store.commit("pic/setUgoiraProgress",e.ugoira.progress)}),200),e.ugoira.onFrame=function(t){window.requestAnimationFrame((function(){e.ugoiraSource=t,e.$forceUpdate()}))},t.next=16,e.ugoira.load();case 16:if(o=t.sent,o){t.next=22;break}return clearInterval(e.ugoiraProgressInterval),e.$store.commit("pic/setUgoiraProgress",0),e.$store.commit("pic/setUgoiraStatus","downloadFailed"),t.abrupt("return");case 22:return e.$store.commit("pic/setUgoiraProgress",99),e.$store.commit("pic/setUgoiraStatus","unzip"),clearInterval(e.ugoiraProgressInterval),t.prev=25,t.next=28,e.ugoira.parse();case 28:if(s=t.sent,s){t.next=33;break}return e.$store.commit("pic/setUgoiraProgress",0),e.$store.commit("pic/setUgoiraStatus","unzipFailed"),t.abrupt("return");case 33:t.next=40;break;case 35:return t.prev=35,t.t1=t["catch"](25),e.$store.commit("pic/setUgoiraProgress",0),e.$store.commit("pic/setUgoiraStatus","unzipFailed"),t.abrupt("return");case 40:e.$store.commit("pic/setUgoiraProgress",100),e.$store.commit("pic/setUgoiraStatus",null),e.$bus.$emit("ugoira-loaded",e.image.id),e.ugoiraLoaded=!0,e.ugoira.play(),e.$nextTick((function(){e.ugoiraObserver&&e.ugoiraObserver.observe(e.$refs.image)}));case 46:case"end":return t.stop()}}),t,null,[[0,6],[25,35]])})))()},downloadUgoira:function(){var e=this;if(this.ugoira){var t=new window.GIF({worker:10,workerScript:"/js/gif.worker.js",quality:this.mobileMode?5:2,width:this.image.width,height:this.image.height,background:"#fff"});this.$store.commit("pic/setUgoiraStatus","renderGif");var i=[],n=function(){i.sort((function(e,t){return e.index-t.index})),i.forEach((function(i,n){t.addFrame(i.img,{delay:e.ugoira.frames[n].delay,width:e.image.width,height:e.image.height})})),t.render()};try{this.ugoira.frames.forEach((function(t,a){var o=new Image;o.src=e.ugoira.blobMap[t.file],o.onload=function(){i.push({img:o,index:a}),i.length===e.ugoira.frames.length&&n()}})),t.on("finished",(function(t){e.$store.commit("pic/setUgoiraStatus",null),e.$bus.$emit("ugoira-gif-rendered",window.URL.createObjectURL(t))}))}catch(a){console.error("Cannot generate gif.",a),this.$store.commit("pic/setUgoiraStatus",null),this.$message.error("动图GIF生成失败，请重试")}}},cancelAllLoad:function(){var e=this;this.imageObjs&&(Object.keys(this.imageObjs).forEach((function(t){var i=e.imageObjs[t];i&&i.cancel()})),this.ugoira&&this.ugoira.cancel())},progressCheck:function(){this.imageObjs&&this.imageObjs[this.page]&&this.imageObjs[this.page].percent&&this.$store.commit("pic/setProgress",this.imageObjs[this.page].percent)},onLoaded:function(e){var t=this;this.$store.commit("pic/setProgress",100),this.progressInterval&&(clearInterval(this.progressInterval),this.progressInterval=null,this.loadProgress=100),this.imageFirstLoaded||(this.imageFirstLoad=!1,this.imageFirstLoaded=!0),this.$emit("image-loaded"),this.sizeCache[this.page]||(this.sizeCache[this.page]={},this.sizeCache[this.page]={x:e.width,y:e.height}),this.imageWidth=this.computeWidth(this.sizeCache[this.page].x,this.sizeCache[this.page].y),this.imageHeight=this.computeHeight(this.sizeCache[this.page].x,this.sizeCache[this.page].y),this.imageEl.setAttribute("src",e.src),this.useLarge?this.lightBoxSource=this.source:this.lightBoxSource=e.src,this.$nextTick((function(){t.imageLoading=!1,clearTimeout(t.imageLoadTimer),t.imageLoadTimer=null}))},onLoadError:function(){this.imageLoading=!1,this.imageLoadError=!0,clearTimeout(this.imageLoadTimer),this.imageLoadTimer=null},checkMobileMode:function(){var e=window.matchMedia("(orientation: portrait) and (max-width: 1024px)"),t=window.matchMedia("(max-width: 767px)");e.matches||t.matches?this.mobileMode=!0:this.mobileMode=!1},setImageSize:function(e){this.mobileMode?(this.containerWidth=this.$refs.image?this.$refs.image.clientWidth:document.documentElement.clientWidth-48,this.imageWidth=this.containerWidth,this.imageHeight=this.computeHeight(e?e.width:0,e?e.height:0)):(this.imageWidth=this.computeWidth(e?e.width:0,e?e.height:0),this.imageHeight=this.computeHeight(e?e.width:0,e?e.height:0))},setLimitWidth:function(){var e=this.screenWidth,t=this.screenHeight;e>=2400?t>1280?(this.limitWidth=1680,this.limitHeight=960):(this.limitWidth=1152,this.limitHeight=796):e>1680&&e<=1920?(this.limitWidth=1152,this.limitHeight=796):e>1430&&e<=1680?(this.limitWidth=920,this.limitHeight=640):e>1366&&e<=1430?(this.limitWidth=766,this.limitHeight=580):e>1024&&e<=1366?(this.limitWidth=596,this.limitHeight=540):e<=1024&&(this.limitWidth=582,this.limitHeight=480)},windowResized:function(){this.screenWidth=document.documentElement.clientWidth,this.screenHeight=document.documentElement.clientHeight,this.image&&(this.setLimitWidth(this.screenWidth),this.checkMobileMode(this.screenWidth),this.setImageSize(this.image))},updateDisplaySize:function(){this.sizeCache[this.page]?(this.imageWidth=this.computeWidth(this.sizeCache[this.page].x,this.sizeCache[this.page].y),this.imageHeight=this.computeHeight(this.sizeCache[this.page].x,this.sizeCache[this.page].y)):(this.imageWidth=this.computeWidth(this.imageSize.x,this.imageSize.y),this.imageHeight=this.computeHeight(this.imageSize.x,this.imageSize.y))},computeWidth:function(e,t){var i=t/(e/this.limitWidth);return i>this.limitHeight?e/(t/this.limitHeight):this.limitWidth},computeHeight:function(e,t){if(this.mobileMode)return t/(e/this.containerWidth);var i=t/(e/this.limitWidth);return i>this.limitHeight?this.limitHeight:i},getPage:function(){return this.page},getProxyHost:function(e){var t=this.$config.download_proxy_host;if("object"!==Object(bt["a"])(t))return t;var i=Number(e)%t.idxList.length,n=t.idxList[i],a=t[n];return a},getImageSource:function(e){var t=e.image,i=e.type,n=e.page,a=void 0===n?this.page:n,o=e.usePublicProxy,s=void 0!==o&&o,r=s?this.$config.public_proxy:this.getProxyHost(t.id);if(t&&t.meta_single_page){if(this.block)return ho;var c=ho;return t&&t.page_count<2&&t.image_urls?c=t.image_urls[i].replace("i.pximg.net",r):t&&t.page_count>=2&&t.meta_pages[a-1]&&(c=t.meta_pages[a-1].image_urls[i].replace("i.pximg.net",r)),window.isSafari&&(c=c.replace("_webp","")),"large"===i&&(c=c.replace(/\/c\/\d+x\d+(_\d+)?\//g,"/")),c}return ho},getUgoiraSource:function(e){var t=this.getProxyHost(this.image.id);return e.replace("i.pximg.net",t)},checkFirstLoad:function(e){this.imageFirstLoad||this.imageFirstLoaded||(this.imageFirstLoad=!0),this.imageFirstLoad&&!this.imageFirstLoaded?this.loadingSource=this.getImageSource({image:e,type:"medium"}):this.loadingSource=ho},handlePageChanged:function(e){var t=this.imageObjs[this.page];t&&t.cancel(),this.page+=1*e,this.tryLoad(),this.$emit("image-load"),this.imageLoading=!0,this.imageLoadError=!1},handleTagClicked:function(e){this.$cookies.set("search-from","pic/".concat(this.image.id)),this.$router.push("/search/".concat(e.currentTarget.dataset.tag))},handleContextClicked:function(e){"down"===e?this.callDownload():"copy-image"===e&&this.copyImage()},callDownload:function(){this.$emit("download-current")},copyImage:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.imageObjs[e.page].src.startsWith("http")&&"image/png"===e.imageObjs[e.page].blob.type){t.next=6;break}return i=function(){return new Promise((function(t){var i=new Image,a=setTimeout((function(){e.$notify({title:"",position:"top-right",customClass:"oneline-notice-container",dangerouslyUseHTMLString:!0,duration:3e3,message:'\n                <div class="oneline-notice">\n                  <span data-name="oneline-notice">图片复制中，请不要切到其他窗口~</span>\n                </div>'})}),500);i.setAttribute("crossOrigin","*"),i.onload=function(){var o=document.createElement("canvas");o.width=i.width,o.height=i.height;var s=o.getContext("2d");s.drawImage(i,0,0,i.width,i.height),o.toBlob(function(){var i=Object(n["a"])(regeneratorRuntime.mark((function i(n){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,navigator.clipboard.write([new window.ClipboardItem(Object(xa["a"])({},n.type,n))]);case 3:clearTimeout(a),t(),i.next=11;break;case 7:throw i.prev=7,i.t0=i["catch"](0),e.$notify({title:"",position:"top-right",customClass:"oneline-notice-container",dangerouslyUseHTMLString:!0,duration:5e3,message:'\n                    <div class="oneline-notice">\n                      <span data-name="oneline-notice">图片复制失败，复制成功前请不要切窗口</span>\n                    </div>'}),i.t0;case 11:case"end":return i.stop()}}),i,null,[[0,7]])})));return function(e){return i.apply(this,arguments)}}())},i.load(e.imageObjs[e.page].src)}))},t.next=4,i();case 4:t.next=8;break;case 6:return t.next=8,navigator.clipboard.write([new window.ClipboardItem(Object(xa["a"])({},e.imageObjs[e.page].blob.type,e.imageObjs[e.page].blob))]);case 8:e.$notify({title:"",position:"top-right",customClass:"oneline-notice-container",dangerouslyUseHTMLString:!0,duration:2e3,message:'\n          <div class="oneline-notice">\n            <span data-name="oneline-notice">图片已复制到剪贴板了~</span>\n          </div>'});case 9:case"end":return t.stop()}}),t)})))()},openLightBox:function(){this.imageLoading||this.imageLoadError||!this.lightBoxSource||(this.lightBoxShow=!0,this.$emit("lightbox-open"),document.documentElement.classList.add("no-scrollbar"))},onLightBoxClose:function(){this.lightBoxShow=!1,this.$emit("lightbox-close"),document.documentElement.classList.remove("no-scrollbar")},handleLightBoxLoaded:function(){this.useLarge&&this.lightBoxShow&&(this.imageEl.setAttribute("src",this.lightBoxSource),this.imageObjs[this.page].src=this.lightBoxSource,this.imageObjs[this.page].useLarge=!1,this.imageObjs[this.page].lightboxShowed=!0)},pushUserHistory:function(e){return Object(n["a"])(regeneratorRuntime.mark((function t(){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i=si(),!i||i.id!==e.id){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,ti(e);case 5:case"end":return t.stop()}}),t)})))()},openShareOverlay:function(){this.showShareOverlay=!0,document.documentElement.classList.add("no-scrollbar")},handleShareOverlayClose:function(){this.showShareOverlay=!1},checkInCollection:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function i(){var n;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(n=e||t.image,null!==n&&void 0!==n&&n.id){i.next=4;break}return t.inCollection=!1,i.abrupt("return");case 4:return i.next=6,Gt(n.id);case 6:t.inCollection=i.sent;case 7:case"end":return i.stop()}}),i)})))()},doCollect:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.image){t.next=2;break}return t.abrupt("return");case 2:if(e.inCollection){t.next=16;break}return t.prev=3,t.next=6,Bt("default",e.image);case 6:t.next=14;break;case 8:if(t.prev=8,t.t0=t["catch"](3),!(t.t0 instanceof Ut&&"exceeded size limit"===t.t0.message)){t.next=13;break}return e.$message.error("收藏夹栏位已用光，是时候清理收藏夹了~"),t.abrupt("return");case 13:throw t.t0;case 14:t.next=18;break;case 16:return t.next=18,Vt("default",e.image.id);case 18:return t.next=20,e.checkInCollection();case 20:e.$nextTick((function(){e.$forceUpdate(),_i({immediate:!0})}));case 21:case"end":return t.stop()}}),t,null,[[3,8]])})))()}}},po=mo,go=(i("3d57"),Object(Ae["a"])(po,ya,_a,!1,null,"b43b00cc",null)),fo=go.exports,vo=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"pic-author"},[i("div",{staticClass:"pic-author-title"},[i("span",[e._v("画师")]),i("div",{staticClass:"pic-close mobile-hide",on:{click:e.handleClose}},[i("i",{staticClass:"el-icon-close"})])]),i("div",{staticClass:"pic-author-info"},[i("div",{directives:[{name:"lazy",rawName:"v-lazy:background-image",value:e.avatar,expression:"avatar",arg:"background-image"}],staticClass:"pic-author-info-avatar"}),i("a",{class:{"pic-author-name--long":e.isLongName},attrs:{href:this.author?"/artist/"+this.author.id:"javascript:;"},on:{click:function(t){return t.preventDefault(),e.toArtistPage.apply(null,arguments)}}},[e._v(" "+e._s(e.authorName)+" ")])])])},wo=[],bo={name:"Pic.Author",props:["author","imageId"],computed:{avatar:function(){return this.author?this.author.profile_image_urls.medium.replace("i.pximg.net","i.pixiv.re"):""},authorName:function(){return this.author?this.author.name:""},isLongName:function(){return this.authorName&&this.authorName.length>12}},methods:{getProxyHost:function(){var e=this.$config.image_proxy_host;if("object"!==Object(bt["a"])(e))return e;var t=ci(e);return t},toArtistPage:function(){this.$emit("navigate",this.author.id)},handleClose:function(){this.$emit("close")}}},ko=bo,yo=Object(Ae["a"])(ko,vo,wo,!1,null,null,null),_o=yo.exports,xo=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"pic-download"},[i("div",{staticClass:"pic-download-title"},[i("span",[e._v("下载")]),i("i",{staticClass:"pic-download-title-icon mobile-hide icon-qrcode",on:{click:e.openDownloadQRCode}},[i("QRCodeIcon")],1),i("i",{staticClass:"pic-download-title-icon el-icon-setting",on:{click:e.openDownloadSettings}})]),i("div",{class:{"pic-download-items":!0,"pic-download-items--multiple":e.showDownloadAll}},[i("el-button",{style:e.downloadCurrentStyle,attrs:{type:"primary",disabled:e.disableDownloadCurrent},on:{click:e.downloadCurrent}},[e._v(" "+e._s(e.downloadCurrentText)+" ")]),"ugoira"===e.image.type?i("el-button",{style:e.downloadUgoiraStyle,attrs:{type:"primary",disabled:e.disableDownloadUgoria},on:{click:e.downloadUgoira}},[e._v(" "+e._s(e.downloadUgoiraText)+" ")]):e._e(),e.showDownloadAll?i("el-button",{attrs:{type:"primary",disabled:e.downloadStarted},on:{click:e.downloadAll}},[e._v(" 下载所有 ")]):e._e()],1),i("el-dialog",{staticClass:"dialog pic-download-dialog",attrs:{title:"下载设置",visible:e.settingsVisible},on:{"update:visible":function(t){e.settingsVisible=t},close:e.handleSettingsClose}},[i("el-form",{attrs:{"label-position":"left","label-width":"120px",model:e.settingsForm}},[i("el-form-item",{attrs:{label:"单张下载文件名"}},[i("el-input",{model:{value:e.settingsForm.singleFileName,callback:function(t){e.$set(e.settingsForm,"singleFileName",t)},expression:"settingsForm.singleFileName"}})],1),i("el-form-item",{attrs:{label:"多张下载文件名"}},[i("el-input",{model:{value:e.settingsForm.multiFileName,callback:function(t){e.$set(e.settingsForm,"multiFileName",t)},expression:"settingsForm.multiFileName"}})],1)],1),i("div",{staticClass:"pic-download-dialog-tips"},[i("p",[i("span",{staticClass:"no-select"},[e._v("标题：")]),i("span",[e._v("{title}")]),i("span",{staticClass:"no-select"},[e._v("，画师：")]),i("span",[e._v("{author}")]),i("span",{staticClass:"no-select"},[e._v("，图片ID：")]),i("span",[e._v("{id}")]),i("span",{staticClass:"no-select"},[e._v("，序号：")]),i("span",[e._v("{index}")])])]),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.settingsVisible=!1}}},[e._v("取消")]),i("el-button",{attrs:{type:"primary"},on:{click:e.handleSettingsSubmit}},[e._v("确定")])],1)],1),i("DownloadQRCode",{ref:"downloadQR"})],1)},Co=[],$o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("svg",{staticClass:"icon",attrs:{t:"1615014494453",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2140"}},[i("path",{attrs:{d:"M461.938 75.093H111.502c-20.138 0-36.409 16.27-36.409 36.41v350.435c0 5.006 4.096 9.102 9.103 9.102h377.742c5.006 0 9.102-4.096 9.102-9.102V84.196c0-5.007-4.096-9.103-9.102-9.103z m-63.716 323.13h-250.31V147.91h250.31v250.311z","p-id":"2141"}}),i("path",{attrs:{d:"M241.209 314.027h63.715c5.007 0 9.103-4.096 9.103-9.103V241.21c0-5.006-4.096-9.102-9.103-9.102H241.21c-5.006 0-9.102 4.096-9.102 9.102v63.715c0 5.007 4.096 9.103 9.102 9.103zM461.938 552.96H84.196c-5.007 0-9.103 4.096-9.103 9.102v350.436c0 20.138 16.27 36.409 36.41 36.409h350.435c5.006 0 9.102-4.096 9.102-9.103V562.062c0-5.006-4.096-9.102-9.102-9.102z m-63.716 323.129h-250.31V625.778h250.31v250.31z","p-id":"2142"}}),i("path",{attrs:{d:"M241.209 791.893h63.715c5.007 0 9.103-4.096 9.103-9.102v-63.715c0-5.007-4.096-9.103-9.103-9.103H241.21c-5.006 0-9.102 4.096-9.102 9.103v63.715c0 5.006 4.096 9.102 9.102 9.102z m671.289-716.8H562.062c-5.006 0-9.102 4.096-9.102 9.103v377.742c0 5.006 4.096 9.102 9.102 9.102h377.742c5.007 0 9.103-4.096 9.103-9.102V111.502c0-20.138-16.27-36.409-36.41-36.409z m-36.41 323.13h-250.31V147.91h250.31v250.311z","p-id":"2143"}}),i("path",{attrs:{d:"M719.076 314.027h63.715c5.006 0 9.102-4.096 9.102-9.103V241.21c0-5.006-4.096-9.102-9.102-9.102h-63.715c-5.007 0-9.103 4.096-9.103 9.102v63.715c0 5.007 4.096 9.103 9.103 9.103zM939.804 552.96h-54.613c-5.006 0-9.102 4.096-9.102 9.102v152.462h-88.747V562.062c0-5.006-4.096-9.102-9.102-9.102H562.062c-5.006 0-9.102 4.096-9.102 9.102v377.742c0 5.007 4.096 9.103 9.102 9.103h54.614c5.006 0 9.102-4.096 9.102-9.103V662.187h88.746V778.24c0 5.006 4.096 9.102 9.103 9.102h216.177c5.007 0 9.103-4.096 9.103-9.102V562.062c0-5.006-4.096-9.102-9.103-9.102z","p-id":"2144"}}),i("path",{attrs:{d:"M778.24 876.089h-54.613c-5.007 0-9.103 4.096-9.103 9.102v54.613c0 5.007 4.096 9.103 9.103 9.103h54.613c5.006 0 9.102-4.096 9.102-9.103v-54.613c0-5.006-4.096-9.102-9.102-9.102z m161.564 0h-54.613c-5.006 0-9.102 4.096-9.102 9.102v54.613c0 5.007 4.096 9.103 9.102 9.103h54.613c5.007 0 9.103-4.096 9.103-9.103v-54.613c0-5.006-4.096-9.102-9.103-9.102z","p-id":"2145"}})])},So=[],To={},Io=Object(Ae["a"])(To,$o,So,!1,null,null,null),Oo=Io.exports,Eo=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"downloadqr-fade"}},[e.show?i("div",{staticClass:"downloadqr-wrapper",on:{click:function(t){return t.target!==t.currentTarget?null:e.handleWrapperClicked.apply(null,arguments)}}},[i("div",{staticClass:"downloadqr"},[i("div",{staticClass:"downloadqr-code",domProps:{innerHTML:e._s(e.code)}}),i("div",{staticClass:"downloadqr-tip"},[i("span",[e._v("请使用手机扫描二维码下载图片")])])])]):e._e()])},Lo=[],zo=i("be4e"),Wo=i.n(zo),jo={data:function(){return{show:!1,url:"https://pixiviz.pwp.app/"}},computed:{code:function(){return new Wo.a(this.url).svg()}},methods:{open:function(){this.show=!0,document.documentElement.classList.contains("no-scrollbar")||document.documentElement.classList.add("no-scrollbar");var e=window.location.href;window.location.href.includes("?")?e+="&":e+="?",e+="mobileDownload=true",this.url=e},handleWrapperClicked:function(){this.show=!1,document.documentElement.classList.contains("no-scrollbar")&&document.documentElement.classList.remove("no-scrollbar")}}},Do=jo,Mo=Object(Ae["a"])(Do,Eo,Lo,!1,null,null,null),Ro=Mo.exports,Ao=function(e,t){var i=document.createElementNS("http://www.w3.org/1999/xhtml","a");i.download=t,i.href=e;var n=new MouseEvent("click");setTimeout((function(){i.dispatchEvent(n)}))},Po={props:{image:{type:Object},loaded:{type:Boolean}},components:{QRCodeIcon:Oo,DownloadQRCode:Ro},data:function(){return{downloadStarted:!1,downloadCurrentLock:!1,downloadCurrentStyle:null,downloadUgoiraLock:!1,downloadUgoiraStyle:null,settingsVisible:!1,settingsForm:{singleFileName:this.$downloadSettings.singleFileName,multiFileName:this.$downloadSettings.multiFileName},isMobile:document.documentElement.clientWidth<=767}},created:function(){this.$bus.$on("start-download-ugoira",this.downloadUgoira),this.$bus.$on("ugoira-gif-rendered",this.saveUgoira)},beforeDestroy:function(){this.$bus.$off("start-download-ugoira",this.downloadUgoira),this.$bus.$off("ugoira-gif-rendered",this.saveUgoira)},computed:{originalUrls:function(){return!this.image||this.image.page_count<2?null:this.image.meta_pages},downloadCurrentText:function(){return this.image?!this.loaded&&this.$store.state.pic.progress&&this.$store.state.pic.progress<100?this.isMobile?"大图加载中":"大图加载中（".concat(this.$store.state.pic.progress,"%）..."):"ugoira"!==this.image.type?this.image.page_count>1?"保存当前":"点我保存":"保存静态图片":""},downloadUgoiraText:function(){if(this.$store.state.pic.ugoiraStatus){var e=this.$store.state.pic.ugoiraStatus;if("downloadFailed"===e)return"动图下载失败";if("unzip"===e)return"动图解析中...";if("unzipFailed"===e)return"动图解析失败";if("renderGif"===e)return"正在生成GIF..."}return this.$store.state.pic.ugoiraProgress<100?"动图加载中（".concat(this.$store.state.pic.progress,"%）..."):"保存动图"},showDownloadAll:function(){return!!this.image&&this.image.page_count>1},disableDownloadCurrent:function(){return this.downloadCurrentLock||!this.loaded},disableDownloadUgoria:function(){return null!==this.$store.state.pic.ugoiraStatus||this.downloadUgoiraLock||100!==this.$store.state.pic.ugoiraProgress}},watch:{"$store.state.pic.progress":function(e){this.$store.state.darkMode.enabled,this.downloadCurrentStyle="background-image: linear-gradient(to right, #8F77B5 0%, #8F77B5 ".concat(e,"%, #999 ").concat(e,"%, #999 100%) !important;"),this.$forceUpdate()},"$store.state.pic.ugoiraProgress":function(e){this.$store.state.darkMode.enabled,this.downloadUgoiraStyle="background-image: linear-gradient(to right, #8F77B5 0%, #8F77B5 ".concat(e,"%, #999 ").concat(e,"%, #999 100%) !important;"),this.$forceUpdate()}},methods:{openDownloadQRCode:function(){this.$refs.downloadQR.open()},openDownloadSettings:function(){this.settingsVisible=!0},handleSettingsClose:function(){var e=this,t=["singleFileName","multiFileName"];t.forEach((function(t){e.settingsForm[t]=e.$downloadSettings[t]}))},handleSettingsSubmit:function(){var e=this,t=["singleFileName","multiFileName"],i={singleFileName:"{title}-{id}",multiFileName:"{title}-{id}-{index}"};t.forEach((function(t){e.$downloadSettings[t]=e.settingsForm[t]||i[t]})),window.localStorage.setItem("download-settings",JSON.stringify(this.$downloadSettings)),this.settingsVisible=!1},createDownloadTimer:function(){var e=this;window.pixiviz.downloadTimer=setInterval((function(){if(window.pixiviz.downloadQueue.length){var t=window.pixiviz.downloadQueue.shift();e.downloadImage(t.url,t.name),window.pixiviz.downloadIdleSeconds=0}else window.pixiviz.downloadIdleSeconds++,window.pixiviz.downloadIdleSeconds>10&&(clearInterval(window.pixiviz.downloadTimer),window.pixiviz.downloadTimer=null)}),1e3)},getDownloadName:function(e){var t;return t="single"===e?this.$downloadSettings.singleFileName:this.$downloadSettings.multiFileName,t=t.replace("{title}",this.image.title).replace("{id}",this.image.id).replace("{author}",this.image.user.name),t},downloadImage:function(e,t){var i=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n)window.pixiviz.downloadQueue.push({url:e,name:t});else{var a=new Image;a.setAttribute("crossOrigin","*"),a.onload=function(){var e=document.createElement("canvas");e.width=a.width,e.height=a.height;var n=e.getContext("2d");n.drawImage(a,0,0,a.width,a.height),e.toBlob((function(e){var i=window.URL.createObjectURL(e);Ao(i,t)})),i.$store.getters["download/hasName"](t)&&i.$store.commit("download/removeItem",t)},setTimeout((function(){a.blobLoaded||i.$store.commit("download/addItem",{name:t,image:a})}),1e3),a.load(e)}},getDownloadHost:function(){var e=this.$config.download_proxy_host;if("object"!==Object(bt["a"])(e))return e;var t=Number(this.image.id)%e.idxList.length,i=e.idxList[t],n=e[i];return n},downloadCurrent:function(){var e=this;this.downloadCurrentStyle=null,this.downloadCurrentLock||(this.downloadCurrentLock=!0,setTimeout((function(){e.downloadCurrentLock=!1}),1e3)),this.$emit("download-current")},downloadUgoira:function(){var e=this;this.downloadUgoiraStyle=null,this.downloadUgoiraLock||(this.downloadUgoiraLock=!0,this.downloadUgoiraLockTimeout=setTimeout((function(){e.downloadUgoiraLock=!1}),1e4)),this.$bus.$emit("download-ugoira")},saveUgoira:function(e){this.downloadUgoiraLockTimeout&&(this.downloadUgoiraLock=!1,clearTimeout(this.downloadUgoiraLockTimeout),this.downloadUgoiraLockTimeout=null);var t=this.getDownloadName("single");Ao(e,t)},downloadAll:function(){var e=this;if(this.originalUrls){this.notification=this.$notify({title:"",position:"top-right",customClass:"oneline-notice-container",dangerouslyUseHTMLString:!0,duration:2e3,message:'\n          <div class="oneline-notice">\n            <span data-name="notice-download">您的下载已经开始了~</span>\n          </div>'});for(var t=this.getDownloadName("multi"),i=0;i<this.originalUrls.length;i++){var n=this.originalUrls[i].image_urls.original;this.downloadImage(n.replace("i.pximg.net",this.getDownloadHost()),t.replace("{index}",i),window.isSafari)}window.isSafari&&(window.pixiviz.downloadTimer||this.createDownloadTimer()),this.downloadStarted=!0,setTimeout((function(){e.downloadStarted=!1}),3e3),this.contextMenuVisible=!1}else this.$message.error("无法获取所有图片的文件地址")}}},Fo=Po,No=Object(Ae["a"])(Fo,xo,Co,!1,null,null,null),Uo=No.exports,Ho=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"pic-related"},[i("div",{staticClass:"pic-related-title"},[i("span",[e._v("相关作品")]),e.orientation.includes("landscape")&&e.oimages.length>=6?i("div",{staticClass:"pic-related-paginator"},[e.hasPrev?i("div",{staticClass:"pic-related-paginator-item pic-related-paginator__left",on:{click:function(t){return e.handleGo(-1)}}},[i("i",{staticClass:"el-icon-arrow-left"})]):e._e(),i("div",{staticClass:"pic-related-paginator-item pic-related-paginator__right",on:{click:function(t){return e.handleGo(1)}}},[i("i",{staticClass:"el-icon-arrow-right"})])]):e._e()]),i("div",{staticClass:"pic-related-content"},[i("div",{staticClass:"waterfall-wrapper"},[i("Waterfall",{ref:"waterfall",attrs:{images:e.images,cardWidth:e.cardWidth,squaredImage:!0,imageType:"square_medium"},on:{"card-clicked":e.handleCardClicked}})],1)]),e.completed&&e.images.length<1?i("div",{staticClass:"pic-related-content-completed"},[i("span",[e._v("没有相关图片...")])]):e._e(),e.orientation.includes("portrait")&&e.images.length>0?i("infinite-loading",{attrs:{identifier:e.waterfallIdentifier,spinner:"spiral"},on:{infinite:e.infiniteHandler}}):e._e()],1)},Bo=[],qo={name:"Pic.Related",props:["images","oimages","page","orientation","completed"],components:{Waterfall:Bn},data:function(){return{screenWidth:document.documentElement.clientWidth,screenHeight:document.documentElement.clientHeight,waterfallIdentifier:Math.round(100*Math.random())}},computed:{hasPrev:function(){return this.page>1},cardWidth:function(){return this.screenWidth>=1360?(this.$emit("change-page-size",6),208):this.screenWidth>1024&&this.screenWidth<1360?this.orientation.includes("portrait")?(this.$emit("change-page-size",20),Math.floor((this.screenWidth-32)/4)-16):(this.$emit("change-page-size",6),172):this.screenWidth>768&&this.screenWidth<=1024?this.orientation.includes("portrait")||this.screenWidth<this.screenHeight?(this.$emit("change-page-size",20),Math.floor((this.screenWidth-32)/4)-16):(this.$emit("change-page-size",6),151):this.screenWidth>567&&this.screenWidth<=768?(this.$emit("change-page-size",30),Math.floor((this.screenWidth-32)/3)-16):(this.screenWidth,this.$emit("change-page-size",30),Math.floor((this.screenWidth-32)/2)-16)}},mounted:function(){var e=this;this.$nextTick((function(){window.addEventListener("resize",e.windowResized,!1)}))},watch:{images:function(){this.screenWidth=document.documentElement.clientWidth},oimages:function(){this.screenWidth=document.documentElement.clientWidth},screenWidth:function(e){this.screenWidth=e}},beforeDestroy:function(){window.removeEventListener("resize",this.windowResized,!1)},methods:{windowResized:function(){this.screenWidth=document.documentElement.clientWidth,this.screenHeight=document.documentElement.clientHeight},handleCardClicked:function(e){var t=window.pixiviz.infoMap[e];t&&this.$store.commit("imageCache/setCache",t);var i="/pic/".concat(e);this.$route.path!==i&&this.$router.push(i)},handleGo:function(e){this.$emit("go",e)},infiniteHandler:function(e){this.$emit("infite-load",e)}}},Vo=qo,Go=Object(Ae["a"])(Vo,Ho,Bo,!1,null,null,null),Yo=Go.exports,Jo=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"pic-overlay"},[i("div",{staticClass:"pic-overlay-wrapper"},[e._m(0),i("div",{staticClass:"pic-overlay-tip"},[i("span",[e._v(e._s(e.text))])]),e.showBack?i("div",{staticClass:"pic-overlay-back"},[e.showRefresh?i("el-button",{attrs:{type:"primary",round:""},on:{click:e.handleRefresh}},[e._v("刷新")]):e._e(),i("el-button",{attrs:{type:"primary",round:""},on:{click:e.handleBack}},[e._v("返回")])],1):e._e(),e.showBack?e._e():i("div",{staticClass:"pic-overlay-back"},[e.showRefresh?i("el-button",{attrs:{type:"primary",round:""},on:{click:e.handleRefresh}},[e._v("刷新")]):e._e(),i("el-button",{attrs:{type:"primary",round:""},on:{click:e.handleBackLanding}},[e._v("返回主页")])],1)])])},Qo=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"pic-overlay-icon"},[i("i",{staticClass:"el-icon-warning-outline"})])}],Ko={name:"Pic.Overlay",props:["text","showRefresh"],data:function(){return{showBack:!1}},mounted:function(){this.$cookies.get("pic-from")&&(this.showBack=!0)},methods:{handleBack:function(){window.history.go(-1)},handleRefresh:function(){window.location.reload()},handleBackLanding:function(){this.$router.push("/")}}},Xo=Ko,Zo=Object(Ae["a"])(Xo,Jo,Qo,!1,null,null,null),es=Zo.exports,ts=function(){return window.matchMedia("(orientation: portrait)").matches?"portrait":"landscape"},is=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("i",{staticClass:"icon icon-home",on:{click:e.handleClick}})},ns=[],as={methods:{handleClick:function(){this.$emit("action","home")}}},os=as,ss=(i("1b2e"),Object(Ae["a"])(os,is,ns,!1,null,"78213fdc",null)),rs=ss.exports,cs=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("i",{staticClass:"icon icon-rank",on:{click:e.handleClick}})},ls=[],ds={methods:{handleClick:function(){this.$emit("action","rank")}}},us=ds,hs=(i("2c43"),Object(Ae["a"])(us,cs,ls,!1,null,"2797a469",null)),ms=hs.exports,ps=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("i",{staticClass:"icon icon-link",on:{click:e.handleClick}})},gs=[],fs={methods:{handleClick:function(){this.$emit("action","copy-image")}}},vs=fs,ws=(i("205d"),Object(Ae["a"])(vs,ps,gs,!1,null,"1ca65780",null)),bs=ws.exports,ks=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("i",{staticClass:"icon icon-back",on:{click:e.handleClick}})},ys=[],_s={methods:{handleClick:function(){this.$emit("action","back")}}},xs=_s,Cs=(i("1d25"),Object(Ae["a"])(xs,ks,ys,!1,null,"65f360c2",null)),$s=Cs.exports,Ss=i("d576"),Ts={name:"Pic",data:function(){return{image:null,infoLoading:!0,loadFailed:!1,block:!1,imageLoaded:!1,relatedImages:[],relatedLoading:!1,relatedCompleted:!1,relatedPage:1,relatedPageSize:6,realRelatedPage:1,pageOffset:0,from:this.$cookies.get("pic-from"),screenOrientation:screen&&screen.orientation?screen.orientation.type:ts(),showPart:screen&&screen.orientation?screen.orientation.type.includes("landscape"):ts().includes("landscape"),lastOffset:0,actionShow:!1,actionShowClass:!1,link:window.location.href,lightboxShow:!1,mobileDownload:!1}},components:{Presentation:fo,Author:_o,Download:Uo,Related:Yo,Overlay:es,HomeIcon:rs,RankIcon:ms,LinkIcon:bs,BackIcon:$s},computed:{showPic:function(){return!this.infoLoading&&!this.block&&!this.loadFailed},imageId:function(){return this.$route.params.id},imageSlice:function(){return this.relatedImages.slice((this.relatedPage-1)*this.relatedPageSize,this.relatedPage*this.relatedPageSize)},author:function(){return this.image&&this.image.user?this.image.user:null}},mounted:function(){var e=this;null===this.image?(this.fetchInfo(),document.title="图片".concat(this.imageId," - Pixiviz")):document.title="".concat(this.image.title," - Pixiviz"),this.setOgTagData(),this.showFloatTimeout=setTimeout((function(){e.showActionFloat()}),2e3),window.addEventListener("orientationchange",this.handleScreenRotate,!1),window.addEventListener("resize",this.handleResize,!1),window.addEventListener("scroll",this.handleScroll),window.scrollTo({top:0}),this.lastOffset=0;var t=window.localStorage.getItem("pic-routes"),i=t&&JSON.parse(t)||[];if(i&&i.length>0){var n=i.pop();"pic"===n.type&&n.from===this.imageId&&(i.mtime=Date.now(),window.localStorage.setItem("pic-routes",JSON.stringify(i)))}this.$route.query&&"true"===this.$route.query.mobileDownload&&(this.mobileDownload=!0,this.$router.replace({query:null})),this.from&&this.from.startsWith("pic/")&&(this.from=null)},beforeDestroy:function(){window.removeEventListener("orientationchange",this.handleScreenRotate,!1),window.removeEventListener("resize",this.handleResize,!1),window.removeEventListener("scroll",this.handleScroll)},watch:{"$route.params.id":"handleIdChanged",infoLoading:{handler:function(e){e?document.documentElement.classList.contains("no-scrollbar")||(window.scrollTo(0,0),document.documentElement.classList.add("no-scrollbar")):document.documentElement.classList.remove("no-scrollbar")}}},methods:{getApiPrefix:function(){if(!this.imageId)throw new Error("No image id.");var e=parseInt(this.imageId,10),t=this.$config.api_prefix_list;return t[e%t.length]},fetchInfo:function(){var e=this;return this.$store.state.imageCache.image?(this.image=this.$store.state.imageCache.image,this.afterLoad(),this.$store.commit("imageCache/destroy"),void(this.infoLoading=!1)):this.imageId?void this.axios.get("".concat(this.getApiPrefix(),"/illust"),{params:{id:this.imageId},maxRetryTimes:3}).then((function(t){if(!t.data||!t.data.illust)return e.infoLoading=!1,void(e.loadFailed=!0);e.infoLoading=!1,e.image=t.data.illust,e.afterLoad()}),(function(){e.infoLoading=!1,e.loadFailed=!0})):(this.infoLoading=!1,void(this.loadFailed=!0))},afterLoad:function(){var e=this;this.$store.state.showNSFW||Mt(this.image)?(this.fetchRelated(),this.$nextTick((function(){document.title="".concat(e.image.title," - Pixiviz"),e.setOgTagData(),e.mobileDownload&&(e.mobileDownload=!1,"ugoira"===e.type?e.waitAndDownloadUgoira():e.startDownloadCurrent())}))):this.block=!0},waitAndDownloadUgoira:function(){var e=this;this.$bus.$once("ugoira-loaded",(function(t){e.mobileDownload=!1,t===e.imageId&&e.$bus.$emit("start-download-ugoira")}))},startDownloadCurrent:function(){var e=this.$refs.presentation.source,t=this.$refs.presentation.page;if(t>1){var i=this.$refs.download.getDownloadName("multi");this.$refs.download.downloadImage(e,i.replace("{index}",t))}else{var n=this.$refs.download.getDownloadName("single");this.$refs.download.downloadImage(e,n)}},fetchRelated:function(e){var t=this;this.imageId&&(this.relatedLoading=!0,this.axios.get("".concat(this.getApiPrefix(),"/related"),{params:{id:this.imageId,page:this.realRelatedPage}}).then((function(i){if(!i.data.illusts||0===i.data.illusts.length)return t.relatedLoading=!1,t.relatedCompleted=!0,void(e&&e.complete());var n=Rt(i.data.illusts,!1,!1);t.relatedImages=t.relatedImages.concat(n),t.relatedLoading=!1,e&&e.loaded()}),(function(){t.relatedLoading=!1,t.relatedCompleted=!0,e&&e.complete()})))},handleIdChanged:function(){this.infoLoading=!0,this.downloadStarted=!1,this.fetchInfo(),this.relatedPage=1,this.realRelatedPage=1,this.relatedImages=[],document.title="图片".concat(this.imageId," - Pixiviz"),this.setOgTagData(),this.lastOffset=0,this.closeActionFloat()},handleImageLoad:function(){this.imageLoaded=!1,this.$forceUpdate()},handleImageLoaded:function(){this.imageLoaded=!0,this.setOgTagData()},handlePageSizeChanged:function(e){this.relatedPageSize=e},handleRelatedPageChanged:function(e){e<0?this.relatedPage-=1:this.relatedPage*this.relatedPageSize>=this.relatedImages.length-this.relatedPageSize?this.relatedLoading||(this.realRelatedPage+=1,this.fetchRelated()):this.relatedPage+=1},handleScreenRotate:function(){var e=screen&&screen.orientation?screen.orientation.type:ts();this.screenOrientation.includes("portrait")&&e.includes("landscape")?this.showPart=!0:this.screenOrientation.includes("landscape")&&e.includes("portrait")&&(this.showPart=!1),this.screenOrientation=e},handleResize:function(){this.handleScreenRotate()},handleRelatedInfiniteLoad:function(e){this.realRelatedPage+=1,this.fetchRelated(e)},handleArtistNavigate:function(e){var t=window.localStorage.getItem("pic-routes"),i=t&&JSON.parse(t)||[];i.length<1&&i.push({type:"entry",from:this.from}),i.push({type:"pic",from:this.imageId}),i.mtime=Date.now(),window.localStorage.setItem("pic-routes",JSON.stringify(i)),this.$router.push("/artist/".concat(e))},handleClose:function(){var e=window.localStorage.getItem("pic-routes"),t=e&&JSON.parse(e)||[];if(t.length<1)this.$router.push(this.from?"/".concat(this.from):"/");else{var i=t.pop();"entry"===i.type?(window.localStorage.removeItem("pic-routes"),this.$router.push("/".concat(i.from)),this.$cookies.remove("pic-from")):"artist"===i.type?(t.mtime=Date.now(),window.localStorage.setItem("pic-routes",JSON.stringify(t)),this.$router.push("/artist/".concat(i.from))):(window.localStorage.removeItem("pic-routes"),this.$router.push("/"))}},handleLightBoxOpen:function(){this.lightboxShow=!0},handleLightBoxClose:function(){this.lightboxShow=!1},closeActionFloat:function(){var e=this;this.actionShowClass&&(this.actionShowClass=!1,setTimeout((function(){e.actionShow=!1,e.showFloatTimeout&&(clearTimeout(e.showFloatTimeout),e.showFloatTimeout=null)}),300))},showActionFloat:function(){var e=this;this.actionShow||(this.actionShow=!0,setTimeout((function(){e.actionShowClass=!0}),100))},handleScroll:function(){var e=this,t=document.documentElement.scrollTop;window.pageYOffset-this.lastOffset<0&&t>200&&this.closeActionFloat(),this.showFloatTimeout&&(clearTimeout(this.showFloatTimeout),this.showFloatTimeout=null),this.showFloatTimeout=setTimeout((function(){e.showActionFloat()}),1500),this.lastOffset=window.pageYOffset},handleAction:function(e){switch(e){case"home":this.$router.push("/");break;case"rank":this.$router.push("/rank");break;case"copy-image":Ss["a"](window.location.href),this.$notify({title:"",position:"top-right",customClass:"oneline-notice-container",dangerouslyUseHTMLString:!0,duration:2e3,message:'\n              <div class="oneline-notice">\n                <span data-name="oneline-notice">当前页面的链接已复制到剪贴板~</span>\n              </div>'});break;case"back":this.handleClose();break;default:break}},setOgTagData:function(){var e;this.$refs.presentation&&this.image&&(e=this.$refs.presentation.getImageSource({image:this.image,type:"square_medium",page:this.$refs.presentation.getPage(),usePublicProxy:!0})),ma(ha(),this.image?{ogTitle:this.image.title?"".concat(this.image.title," - ").concat(this.image.user.name||"Pixiviz"):"Pixiviz",ogDesc:(this.image.caption.length>50?this.image.caption.substr(0,20):this.image.caption)||"分享自 Pixiviz",ogUrl:window.location.href,ogImage:e||"".concat(this.$config.website_url,"/favicon.png")}:{ogTitle:"图片".concat(this.imageId," - Pixiviz"),ogDesc:"分享自 Pixiviz",ogUrl:window.location.href,ogImage:"".concat(this.$config.website_url,"/favicon.png")})}}},Is=Ts,Os=Object(Ae["a"])(Is,ba,ka,!1,null,null,null),Es=Os.exports,Ls=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:["search-container",e.iPadStyle?"ipad-only":null],style:e.keywordBlocked?{filter:"blur("+e.blockedCount/3+"px"}:null},[i("div",{staticClass:"search-responsive search-header"},[e._m(0),i("div",{staticClass:"search-header-input"},[i("el-input",{attrs:{placeholder:"输入搜索关键词",spellcheck:"false"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitSearch.apply(null,arguments)}},model:{value:e.keywordInput,callback:function(t){e.keywordInput=t},expression:"keywordInput"}},[i("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})])],1),i("el-dropdown",{staticStyle:{"margin-left":"15px","vertical-align":"0.5em"},attrs:{trigger:"click"},on:{command:e.onUserIriCmd}},[i("span",{staticClass:"el-dropdown-link"},[e._v(" users入り"),i("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.usersIriTags,(function(t){return i("el-dropdown-item",{key:t.value,attrs:{command:t.value}},[e._v(e._s(t.text))])})),1)],1),i("div",{staticClass:"search-header-close"},[i("i",{staticClass:"el-icon-close",on:{click:e.handleBack}})])],1),e.suggestions.length>0&&e.showContent?i("div",{ref:"suggestions",staticClass:"search-responsive search-suggestion",on:{mouseenter:e.enterSuggesion,mouseleave:e.leaveSuggestion,touchstart:e.suggestionTouchStart,touchmove:e.suggestionTouchMove}},[i("div",{ref:"suggestionItems",staticClass:"search-suggestion-items"},e._l(e.suggestions,(function(t){return i("div",{key:t,staticClass:"search-suggestion-item",on:{click:function(i){return e.handleSuggestionClick(t)}}},[i("span",[e._v(e._s(t))])])})),0)]):e._e(),e.showContent?i("div",{staticClass:"search-content"},[i("div",{staticClass:"waterfall-wrapper"},[i("Waterfall",{key:e.waterfallResponsive,ref:"waterfall",class:{"waterfall-responsive":e.waterfallResponsive},style:e.waterfallResponsive?null:{width:e.mobileWaterfallWidth+"px"},attrs:{images:e.images,cardWidth:e.cardWidth,imageType:"medium"},on:{"card-clicked":e.handleCardClicked}})],1)]):e._e(),e.keywordBlocked?i("div",{staticClass:"search-content search-content-blocked"},[i("p",[e._v("别搜了，这里真的没有色图...")])]):e._e(),e.sensitiveBlocked?i("div",{staticClass:"search-content search-content-blocked"},[i("p",[e._v("找不到任何匹配的结果，请换一个搜索关键词试试吧~")])]):e._e(),e.showContent&&e.loadFailed?i("div",{staticClass:"infinite-failed"},[i("p",[e._v("看上去数据加载失败了")]),i("el-button",{attrs:{type:"primary",round:""},on:{click:e.fetchNew}},[e._v("点我重试")])],1):e._e(),e.showContent&&!e.loadFailed?i("infinite-loading",{attrs:{identifier:e.waterfallIdentifier,spinner:"spiral"},on:{infinite:e.infiniteHandler}}):e._e(),i("BackToTop",{ref:"backToTop"})],1)},zs=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"search-header-title"},[i("span",[e._v("搜索")])])}],Ws=(i("7db0"),i("517b")),js={methods:{updateSuggestionTranslate:function(){this.suggestionTranslate<0&&(this.suggestionTranslate=0),this.suggestionTranslate>this.$refs.suggestionItems.scrollWidth-this.$refs.suggestionItems.clientWidth&&(this.suggestionTranslate=this.$refs.suggestionItems.scrollWidth-this.$refs.suggestionItems.clientWidth),this.$refs.suggestionItems.setAttribute("style","transform: translateX(-".concat(this.suggestionTranslate,"px)"))},scrollSuggesion:function(e){e.preventDefault(),e.stopPropagation(),this.$refs.suggestionItems&&(this.suggestionTranslate+=2.5*e.deltaY,this.updateSuggestionTranslate())},enterSuggesion:function(){this.$refs.suggestions&&this.$refs.suggestions.scrollWidth>this.$refs.suggestions.clientWidth&&window.addEventListener("mousewheel",this.scrollSuggesion,{passive:!1})},leaveSuggestion:function(){window.removeEventListener("mousewheel",this.scrollSuggesion,{passive:!1})},suggestionTouchStart:function(e){this.suggestionTouchX=e.touches[0].pageX,e.preventDefault(),e.stopPropagation()},suggestionTouchMove:function(e){var t=this.suggestionTouchX-e.touches[0].pageX;this.suggestionTranslate+=1.625*t,this.updateSuggestionTranslate(),this.suggestionTouchX=e.touches[0].pageX,e.preventDefault(),e.stopPropagation()}}},Ds=/^\d{2,8}$/,Ms=[],Rs=[].concat(Object(pt["a"])(Lt()),["loli","ペド","恋童","幼女","小学生"]),As={name:"Search",components:{Waterfall:Bn,BackToTop:Kn},mixins:[js],data:function(){return{page:null!==this.$store.state.search.page?this.$store.state.search.page:1,images:this.initImages(),suggestions:this.$store.state.search.suggestions?this.$store.state.search.suggestions:[],keyword:this.$route.params.keyword,keywordInput:this.$route.params.keyword,keywordBlocked:!1,sensitiveBlocked:!1,blockedCount:0,waterfallIdentifier:Math.round(100*Math.random()),from:this.$cookies.get("search-from"),loadFailed:!1,cachedState:null,screenWidth:document.documentElement.clientWidth,cardWidth:this.getCardWidth(document.documentElement.clientWidth),waterfallResponsive:document.documentElement.clientWidth>767,scrollTop:0,suggestionTranslate:0,iPadStyle:/iPad/i.test(navigator.userAgent),illustNotice:null,usersIriTags:[{text:"users入り",value:""},{text:"30000users入り",value:"30000users入り"},{text:"20000users入り",value:"20000users入り"},{text:"10000users入り",value:"10000users入り"},{text:"7500users入り",value:"7500users入り"},{text:"5000users入り",value:"5000users入り"},{text:"1000users入り",value:"1000users入り"},{text:"500users入り",value:"500users入り"},{text:"250users入り",value:"250users入り"},{text:"100users入り",value:"100users入り"}]}},watch:{"$route.params.keyword":"handleKeywordChanged",screenWidth:function(e){var t=this;this.resizeTimer&&clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout((function(){t.screenWidth=e,t.scrollTop=document.documentElement.scrollTop,t.screenWidth<=767?t.waterfallResponsive=!1:t.waterfallResponsive=!0,t.$nextTick((function(){t.cardWidth=t.getCardWidth(t.screenWidth),document.documentElement.scrollTop=t.scrollTop}))}),300)}},computed:{showContent:function(){return!this.keywordBlocked&&!this.sensitiveBlocked},mobileWaterfallWidth:function(){return 2*this.cardWidth+32},usersIriTag:function(){var e,t=this;return null===(e=this.usersIriTags.find((function(e){var i=e.value;return i&&t.keywordInput.includes(i)})))||void 0===e?void 0:e.value}},mounted:function(){var e=this;this.checkBlocked(),this.keyword!==this.$store.state.search.keyword&&this.fetchSuggestion(),this.checkIfId(),this.$store.commit("search/setKeyword",this.keyword);var t=parseInt(this.$cookies.get("search-scroll"),10);this.images.length>0?t&&this.$nextTick((function(){window.scrollTo(0,t),t>300&&e.$refs.backToTop&&e.$refs.backToTop.display()})):this.$cookies.set("serach-scroll",0,"1h"),this.$nextTick((function(){window.addEventListener("resize",e.windowResized,!1),window.addEventListener("scroll",e.handleScroll,!1)})),document.title="搜索 - ".concat(this.keyword," - Pixiviz"),this.setOgTagData()},beforeDestroy:function(){this.illustNotice&&this.illustNotice.close(),this.leaveSuggestion(),window.removeEventListener("resize",this.windowResized,!1),window.removeEventListener("scroll",this.handleScroll,!1)},methods:{initImages:function(){return this.$store.state.search.keyword===this.$route.params.keyword&&this.$store.state.search.images||[]},onUserIriCmd:function(e){if(e){var t=this.keywordInput;this.keywordInput="".concat(t.replace(/\d+users入り/g,"").trim()," ").concat(e),this.submitSearch()}},infiniteHandler:Object(Ws["a"])((function(e){var t=this;this.page>5?e.complete():!this.keywordBlocked&&this.keyword?(this.cachedState=e,this.axios.get("".concat(this.$config.api_prefix,"/search"),{params:{word:this.keyword,page:this.page}}).then((function(i){if(500===i.status)return e.complete(),void(t.loadFailed=!0);if(i.data.illusts)if(0!==i.data.illusts.length){var n=Rt(i.data.illusts,!1,!0);t.images=t.images.concat(n),t.$store.commit("search/setImages",t.images),t.$refs.waterfall&&(t.$refs.waterfall.firstLoad=!1),t.page+=1,t.$store.commit("search/setPage",t.page),e.loaded()}else e.complete();else e.complete()}),(function(i){console.error("Fetch search data error",i),e.complete(),t.loadFailed=!0,t.cachedState=null}))):e.complete()}),1e3),fetchSuggestion:function(){var e=this;this.usersIriTag||this.axios.get("".concat(this.$config.api_prefix,"/search_autocomplete"),{params:{word:this.keyword}}).then((function(t){var i;Array.isArray(null===(i=t.data)||void 0===i?void 0:i.tags)&&(e.suggestions=t.data.tags.map((function(e){return e.name})).filter((function(t){return t!==e.keyword&&e.checkSuggestion(t)})),e.$store.commit("search/setSuggestions",e.suggestions))}))},checkSuggestion:function(e){var t=Rs.reduce((function(t,i){return t||(t||e.includes(i))}),!1);return!t},fetchNew:function(){var e=this;this.loadFailed=!1,this.images?this.$nextTick((function(){var t;null===(t=e.cachedState)||void 0===t||t.reset()})):this.$nextTick((function(){e.refreshWaterfall(),e.resetScrollState()}))},checkIfId:function(){Ds.test(this.keyword)&&!isNaN(this.keyword)&&this.checkIfIllust()},checkIfIllust:function(){var e=this;this.axios.get("".concat(this.$config.api_prefix,"/illust"),{params:{id:parseInt(this.keyword,10)},maxRetryTimes:0}).then((function(t){if(t&&t.data&&t.data.illust){var i=t.data.illust;Mt(i)&&(document.body.addEventListener("click",e.illustNoticeClick,!1),e.illustNotice=e.$notify({title:"您要找的可能是：",position:"bottom-left",dangerouslyUseHTMLString:!0,duration:5e3,onClose:e.illustNoticeClose,message:'\n            <div class="search-notify">\n              <span data-name="search-notify-illust">画作 '.concat(i.title," （ID: ").concat(e.keyword,"）</span>\n            </div>")}))}}))},refreshWaterfall:function(){this.page=1,this.images=[],this.waterfallIdentifier+=1},submitSearch:function(){if(!this.keywordInput||this.keywordInput.length<1||this.keywordInput&&this.keywordInput.trim().length<1)return this.$message.error("呐，输入关键词再搜索！！"),void(this.keywordInput="");if(this.keywordInput=this.keywordInput.trim(),this.keywordInput!==this.keyword){var e="/search/".concat(encodeURIComponent(this.keywordInput));this.$route.path!==e&&this.$router.push(e),this.leaveSuggestion()}},checkBlocked:function(){var e=this,t=!1;this.blockedCountTime=parseInt(window.localStorage.getItem("blocked_count_time"),10),(new Date).valueOf()-this.blockedCountTime>18e4?(this.blockedCount=1,window.localStorage.setItem("blocked_count",1),window.localStorage.setItem("blocked_count_time",(new Date).valueOf())):(this.blockedCount=parseInt(window.localStorage.getItem("blocked_count"),10),this.blockedCount?(window.localStorage.setItem("blocked_count",this.blockedCount+1),window.localStorage.setItem("blocked_count_time",(new Date).valueOf())):(window.localStorage.setItem("blocked_count",1),window.localStorage.setItem("blocked_count_time",(new Date).valueOf())));var i,n=Object(Di["a"])(Ms);try{for(n.s();!(i=n.n()).done;){var a=i.value;a.test(this.keyword)&&(t=!0)}}catch(s){n.e(s)}finally{n.f()}this.keywordBlocked=t;var o=Rs.reduce((function(t,i){return t||(t||e.keyword.includes(i))}),!1);o&&(this.sensitiveBlocked=!0)},handleKeywordChanged:function(e){e!==this.keyword&&(this.keyword=e,this.keywordInput=e,this.checkBlocked(),this.$store.commit("search/setKeyword",this.keyword),this.$store.commit("search/setImages",[]),this.$store.commit("search/setPage",1),this.refreshWaterfall(),this.resetScrollState(),this.fetchSuggestion(),this.checkIfId(),this.loadFailed=!1,document.title="".concat(this.keyword," - Pixiviz"),this.setOgTagData())},handleCardClicked:function(e){var t=this.$cookies.get("search-from");if(t!=="pic/".concat(e)){this.$cookies.set("pic-from","search/".concat(encodeURIComponent(this.$route.params.keyword)),"1h");var i=window.pixiviz.infoMap[e];i&&this.$store.commit("imageCache/setCache",i),this.$router.push("/pic/".concat(e))}},handleSuggestionClick:function(e){this.$router.push("/search/".concat(encodeURIComponent(e))),this.leaveSuggestion()},handleBack:function(){this.from?this.$router.push("/".concat(this.from)):this.$router.push("/")},handleScroll:function(){this.$cookies.set("search-scroll",document.documentElement.scrollTop,"1h")},resetScrollState:function(){this.scrollTop=0,this.$cookies.set("search-scroll",0,"1h")},windowResized:function(){this.screenWidth=document.documentElement.clientWidth},getCardWidth:function(e){return da.getCardWidth(e)},illustNoticeClick:function(e){e.target.dataset.name&&"search-notify-illust"===e.target.dataset.name&&(this.$router.push("/pic/".concat(encodeURIComponent(this.keyword))),this.illustNotice.close())},illustNoticeClose:function(){document.body.removeEventListener("click",this.illustNoticeClick,!1)},setOgTagData:function(){ma(ha(),{ogTitle:"".concat(this.keyword," - 搜索"),ogDesc:"二次元插画搜索，跨次元链接，就在 Pixiviz",ogUrl:window.location.href,ogImage:"".concat(this.$config.website_url,"/favicon.png")})}}},Ps=As,Fs=Object(Ae["a"])(Ps,Ls,zs,!1,null,null,null),Ns=Fs.exports,Us=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"search-container usearch-container"},[i("div",{staticClass:"usearch-responsive search-header"},[e._m(0),i("div",{staticClass:"search-header-input"},[i("el-input",{attrs:{placeholder:"输入画师名称或 ID",spellcheck:"false"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitSearch.apply(null,arguments)}},model:{value:e.keywordInput,callback:function(t){e.keywordInput=t},expression:"keywordInput"}},[i("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})])],1),i("div",{staticClass:"search-header-close"},[i("i",{staticClass:"el-icon-close",on:{click:e.handleBack}})])]),i("div",{staticClass:"usearch-responsive usearch-content"},e._l(e.artists,(function(t){return i("ArtistCard",{key:t.user.id,attrs:{artist:t,cardWidth:e.imageCardWidth},on:{"card-clicked":e.handleCardClicked,"entry-clicked":e.handleEntryClicked}})})),1),e.loadFailed?i("div",{staticClass:"infinite-failed"},[i("p",[e._v("看上去数据加载失败了")]),i("el-button",{attrs:{type:"primary",round:""},on:{click:e.fetchNew}},[e._v("点我重试")])],1):e._e(),e.loadFailed?e._e():i("infinite-loading",{attrs:{identifier:e.infiniteId,spinner:"spiral"},on:{infinite:e.loadArtistsData}},[i("span",{attrs:{slot:"no-results"},slot:"no-results"},[e._v("这里没有数据...")]),i("span",{attrs:{slot:"no-more"},slot:"no-more"},[e._v("没有更多结果了...")])]),i("BackToTop",{ref:"backToTop"})],1)},Hs=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"search-header-title"},[i("span",[e._v("搜索")])])}],Bs=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"artist-card"},[i("div",{staticClass:"artist-card-header"},[i("div",{staticClass:"artist-card-header__info"},[i("div",{staticClass:"artist-card-header__avatar"},[i("div",{directives:[{name:"lazy",rawName:"v-lazy"}],staticClass:"avatar",style:{backgroundImage:"url("+this.avatar+")"}})]),i("div",{staticClass:"artist-card-header__name"},[i("span",[e._v(e._s(e.name))])]),i("div",{staticClass:"artist-card-header__id mobile-hide"},[i("span",[i("span",{staticClass:"no-select"},[e._v("ID: ")]),e._v(e._s(e.artistId))])])]),i("div",{staticClass:"artist-card-header__button"},[i("el-button",{attrs:{type:"primary",round:""},on:{click:e.handleEntryClicked}},[e._v("进入画师主页")])],1)]),e.userIllusts.length?i("div",{staticClass:"artist-card-content"},e._l(e.userIllusts,(function(t){return i("ImageCard",{key:t.id,attrs:{image:t,imageType:"square_medium",cardWidth:e.cardWidth,absolute:!1,position:{height:e.cardWidth}},on:{clicked:e.handleCardClicked}})})),1):i("div",{staticClass:"artist-card-empty"},[i("span",[e._v("该画师没有可展示的作品")])])])},qs=[],Vs={methods:{getImageProxyHost:function(){var e=this.$config.image_proxy_host;return"object"!==Object(bt["a"])(e)?e:Object.keys(e)[0]}}},Gs="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",Ys={props:{artist:Object,cardWidth:{type:Number,default:208}},components:{ImageCard:An},mixins:[Vs],computed:{avatar:function(){return this.artist&&this.artist.user?this.artist.user.profile_image_urls.medium.replace("i.pximg.net",this.getImageProxyHost()):Gs},name:function(){return this.artist.user.name},artistId:function(){return this.artist.user.id},userIllusts:function(){return Rt(this.artist.illusts,!1,!1).map((function(e,t){return Object(We["a"])(Object(We["a"])({},e),{},{index:t})}))}},methods:{handleCardClicked:function(e){this.$emit("card-clicked",e)},handleEntryClicked:function(){this.$emit("entry-clicked",this.artistId)}}},Js=Ys,Qs=Object(Ae["a"])(Js,Bs,qs,!1,null,null,null),Ks=Qs.exports,Xs=/^\d{2,8}$/,Zs={components:{ArtistCard:Ks,BackToTop:Kn},data:function(){return{artists:this.initData(),artistIdMap:{},infiniteId:0,loadFailed:!1,cachedState:!1,page:null!==this.$store.state.userSearch.page?this.$store.state.userSearch.page:1,keyword:this.$route.params.keyword,keywordInput:this.$route.params.keyword,imageCardWidth:this.getImageCardWidth(document.documentElement.clientWidth),screenWidth:document.documentElement.clientWidth,scrollTop:0,artistNotice:null}},watch:{"$route.params.keyword":"handleKeywordChanged",screenWidth:function(e){this.imageCardWidth=this.getImageCardWidth(e)}},mounted:function(){var e=this;this.$store.commit("userSearch/setKeyword",this.keyword),this.$nextTick((function(){window.addEventListener("resize",e.windowResized,!1),window.addEventListener("scroll",e.handleScroll,!1)})),this.checkIfId();var t=parseInt(this.$cookies.get("usearch-scroll"),10);this.artists.length>0?t&&this.$nextTick((function(){window.scrollTo(0,t),t>300&&e.$refs.backToTop&&e.$refs.backToTop.display()})):this.$cookies.set("usearch-scroll",0,"1h"),this.setOgTagData()},beforeDestroy:function(){window.removeEventListener("resize",this.windowResized,!1),window.removeEventListener("scroll",this.handleScroll,!1),this.artistNotice&&this.artistNotice.close()},methods:{initData:function(){return this.$store.state.userSearch.keyword===this.$route.params.keyword&&this.$store.state.userSearch.artists||[]},fetchNew:function(){var e=this;this.loadFailed=!1,this.artists?this.$nextTick((function(){var t;null===(t=e.cachedState)||void 0===t||t.reset()})):this.$nextTick((function(){e.infiniteId+=1,e.resetScrollState()}))},checkIfId:function(){Xs.test(this.keyword)&&!isNaN(this.keyword)&&this.checkIfArtist()},resetScrollState:function(){this.scrollTop=0,this.$cookies.set("usearch-scroll",0,"1h")},loadArtistsData:function(e){var t=this;this.keyword?(this.cachedState=e,this.axios.get("".concat(this.$config.api_prefix,"/search_user"),{params:{word:this.keyword,page:this.page}}).then((function(i){if(500===i.status)return e.complete(),void(t.loadFailed=!0);var n=i.data;if(n.user_previews){var a=n.user_previews;if(Array.isArray(a)&&0===a.length)e.complete();else{var o=a.filter((function(e){return!t.artistIdMap[e.user.id]&&(t.artistIdMap[e.user.id]=!0,!0)}));o.length<1?e.complete():(t.artists=t.artists.concat(o),t.$store.commit("userSearch/setArtists",t.artists),t.page+=1,t.$store.commit("userSearch/setPage",t.page),e.loaded())}}else e.complete()}),(function(i){console.error("Fetch artists search data error",i),e.complete(),t.loadFailed=!0,t.cachedState=null}))):e.complete()},handleKeywordChanged:function(e){e!==this.keyword&&(this.keyword=e,this.keywordInput=e,this.$store.commit("userSearch/setKeyword",this.keyword),this.$store.commit("userSearch/setArtists",[]),this.$store.commit("userSearch/setPage",1),this.artists=[],this.infiniteId+=1,this.resetScrollState(),this.loadFailed=!1,this.checkIfId(),document.title="".concat(this.keyword," - Pixiviz"),this.setOgTagData())},submitSearch:function(){if(!this.keywordInput||this.keywordInput.length<1||this.keywordInput&&this.keywordInput.trim().length<1)return this.$message.error("呐，输入画师名称或ID再搜索！！"),void(this.keywordInput="");this.keywordInput=this.keywordInput.trim(),this.keywordInput!==this.keyword&&this.$router.push("/usearch/".concat(encodeURIComponent(this.keywordInput)))},windowResized:function(){this.screenWidth=document.documentElement.clientWidth},handleScroll:function(){this.$cookies.set("usearch-scroll",document.documentElement.scrollTop,"1h")},getImageCardWidth:function(e){return e>=1024?282:e>=768&&e<1024?182:e<768?164:void 0},handleBack:function(){this.from?this.$router.push("/".concat(this.from)):this.$router.push("/")},handleCardClicked:function(e){this.$cookies.set("pic-from","usearch/".concat(encodeURIComponent(this.keyword)),"1h");var t=window.pixiviz.infoMap[e];t&&this.$store.commit("imageCache/setCache",t),this.$router.push("/pic/".concat(e))},handleEntryClicked:function(e){var t=window.localStorage.getItem("pic-routes"),i=t&&JSON.parse(t)||[];i.length<1&&i.push({type:"entry",from:this.from}),i.push({type:"usearch",keyword:this.keyword}),i.mtime=Date.now(),window.localStorage.setItem("pic-routes",JSON.stringify(i)),this.$router.push("/artist/".concat(e))},setOgTagData:function(){ma(ha(),{ogTitle:"".concat(this.keyword," - 搜索"),ogDesc:"二次元画师搜索，跨次元链接，就在 Pixiviz",ogUrl:window.location.href,ogImage:"".concat(this.$config.website_url,"/favicon.png")})},checkIfArtist:function(){var e=this;this.axios.get("".concat(this.$config.api_prefix,"/member"),{params:{id:parseInt(this.keyword,10)}}).then((function(t){if(t&&t.data&&t.data.user){var i=t.data.user;document.body.addEventListener("click",e.artistNoticeClick,!1),e.artistNotice=e.$notify({title:"您要找的可能是：",position:"bottom-left",dangerouslyUseHTMLString:!0,duration:5e3,onClose:e.artistNoticeClose,message:'\n            <div class="search-notify">\n              <span data-name="search-notify-artist">画师 '.concat(i.name," （ID: ").concat(e.keyword,"）</span>\n            </div>")})}}))},artistNoticeClick:function(e){e.target.dataset.name&&"search-notify-artist"===e.target.dataset.name&&(this.$router.push("/artist/".concat(encodeURIComponent(this.keyword))),this.artistNotice.close())},artistNoticeClose:function(){document.body.removeEventListener("click",this.artistNoticeClick,!1)}}},er=Zs,tr=Object(Ae["a"])(er,Us,Hs,!1,null,null,null),ir=tr.exports,nr=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:!e.infoLoaded,expression:"!infoLoaded"}],class:{"artist-container":!0,"artist-ipad-only":e.iPadStyle},attrs:{"element-loading-text":"正在获取画师信息"}},[i("div",{staticClass:"artist-header-wrapper"},[i("div",{staticClass:"artist-header"},[i("div",{staticClass:"artist-header-close"},[i("i",{staticClass:"el-icon-close",on:{click:e.handleBack}})]),i("ArtistDetail",{ref:"detail",attrs:{artistId:e.id},on:{loaded:e.handleInfoLoaded,failed:e.handleLoadFailed}})],1)]),e.infoLoaded&&!e.infoLoadFailed?i("div",{staticClass:"artist-content"},[i("div",{staticClass:"waterfall-wrapper"},[i("Waterfall",{key:e.waterfallResponsive,ref:"waterfall",class:{"waterfall-responsive":e.waterfallResponsive},style:e.waterfallResponsive?null:{width:e.mobileWaterfallWidth+"px"},attrs:{images:e.images,cardWidth:e.cardWidth,imageType:"medium"},on:{"card-clicked":e.handleCardClicked}})],1)]):e._e(),e.infoLoadFailed?i("Overlay",{attrs:{text:"画师信息加载失败"}}):e._e(),e.infoLoadFailed?e._e():i("infinite-loading",{attrs:{identifier:e.waterfallIdentifier,spinner:"spiral"},on:{infinite:e.infiniteHandler}}),i("BackToTop",{ref:"backToTop"})],1)},ar=[],or=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.loaded?i("div",{staticClass:"artist-detail"},[i("div",{staticClass:"artist-overview"},[i("div",{staticClass:"artist-overview-avatar"},[e.headPicSource?i("div",{directives:[{name:"lazy-container",rawName:"v-lazy-container"}],staticClass:"artist-overview-avatar__head-pic",style:e.avatarHeadPicStyle}):e._e(),i("div",{class:{"artist-overview-avatar__pic":!0,"artist-overview-avatar__pic--has-head":!!e.headPicSource}},[i("div",{directives:[{name:"lazy-container",rawName:"v-lazy-container"}],style:e.avatarPicStyle})])]),i("div",{staticClass:"artist-overview-content"},[i("div",{staticClass:"artist-overview-content-name"},[i("span",[e._v(e._s(e.name&&e.name.trim()))])]),i("div",{staticClass:"artist-overview-content-other"},[i("ArtistInfoTag",{staticClass:"artist-other-clickable",attrs:{content:"ID "+e.artistId},nativeOn:{click:function(t){return e.copyLink.apply(null,arguments)}}}),e.region?i("ArtistInfoTag",{attrs:{content:e.formattedRegion}}):e._e(),e.gender&&"male"===e.gender?i("Male"):e._e(),e.gender&&"female"===e.gender?i("Female"):e._e(),e.twitterUrl?i("Twitter",{staticClass:"artist-other-clickable",nativeOn:{click:function(t){return e.openTwitter.apply(null,arguments)}}}):e._e(),e.websiteUrl?i("Website",{staticClass:"artist-other-clickable",nativeOn:{click:function(t){return e.openWebsite.apply(null,arguments)}}}):e._e()],1),i("div",{staticClass:"artist-overview-content-data"},[i("div",{staticClass:"overview-data"},[e._m(0),i("div",{staticClass:"overview-data-number"},[i("span",[e._v(e._s(e.totalIllusts))])])]),i("div",{staticClass:"overview-data"},[e._m(1),i("div",{staticClass:"overview-data-number"},[i("span",[e._v(e._s(e.totalManga))])])]),i("div",{staticClass:"overview-data"},[e._m(2),i("div",{staticClass:"overview-data-number"},[i("span",[e._v(e._s(e.totalNovel))])])])])])]),e.comment?i("div",{staticClass:"artist-comment"},[i("pre",[e._v(e._s(e.comment))])]):i("div",{staticClass:"artist-comment-empty"})]):e._e()},sr=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"overview-data-name"},[i("span",[e._v("插画")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"overview-data-name"},[i("span",[e._v("漫画")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"overview-data-name"},[i("span",[e._v("小说")])])}],rr=i("707d"),cr=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("svg",{staticClass:"website",attrs:{viewBox:"0 0 1024 1023"}},[i("path",{attrs:{d:"M881 321q-10-2-15-2q-37 0-64 25q-61-27-114-44q-87-28-182-46q-9-24-27-40Q504 96 546 0q126 9 231.5 73T948 241q-37 40-67 80zM417 191q-26 0-49 14q-81-60-163-102Q329 9 483 0q-39 87-63 191h-3zM70 253q34-57 86-108q68 35 141 86q-129-3-227 22zm251 40q2 31 21.5 54.5T391 379q-6 70-6 133q0 44 3 101q-22 7-39 24q-54-21-104-48q11-22 11-45q0-40-28-68t-68-28q-44 0-73 34q-42-38-75-79q9-43 27-85q122-34 282-25zM65 552q3 37 30.5 62.5T160 640q11 0 24-4q64 37 137 64v4q0 39 26.5 66.5T413 800q25 122 70 223q-100-6-189-48.5T140.5 864T38 704T0 512q0-1 1-27q28 35 64 67zm436 197q72 13 145 17q7 20 22 37q-23 105-28 204q-51 13-94 16q-47-107-73-242q18-12 28-32zm310 48q13-16 18-34q73-6 141-19q-48 94-132 163q-9-52-27-110zm-163-95q-70-4-138-18q-11-50-57-69q-4-59-4-103q0-66 6-137q2 0 5-2t4-2q39 38 68 70q87 96 148 218q-22 17-32 43zm89 130q2 0 11-1q17 61 25 121q-29 17-70 34q7-78 24-155q8 1 10 1zm-5-239q-1 2-2.5 6t-2.5 6q-63-114-148-207q-31-35-74-76q1 0 1.5-1.5l.5-1.5q84 17 161 42q47 15 103 40q-2 10-2 15q0 30 18 55q-33 63-55 122zm47 58q12-35 12-36q20-50 50-107q13 4 25 4q34 0 61-23q49 34 96 76q-6 57-24 110q-82 17-173 24q-13-32-47-48zm183-236q0-33-22-60q21-27 42-49q36 82 42 169q-33-25-64-45q2-9 2-15z",fill:"currentColor"}})])},lr=[],dr={},ur=Object(Ae["a"])(dr,cr,lr,!1,null,null,null),hr=ur.exports,mr=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("svg",{staticClass:"twitter",attrs:{viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M22 5.8a8.49 8.49 0 0 1-2.36.64a4.13 4.13 0 0 0 1.81-2.27a8.21 8.21 0 0 1-2.61 1a4.1 4.1 0 0 0-7 3.74a11.64 11.64 0 0 1-8.45-4.29a4.16 4.16 0 0 0-.55 2.07a4.09 4.09 0 0 0 1.82 3.41a4.05 4.05 0 0 1-1.86-.51v.05a4.1 4.1 0 0 0 3.3 4a3.93 3.93 0 0 1-1.1.17a4.9 4.9 0 0 1-.77-.07a4.11 4.11 0 0 0 3.83 2.84A8.22 8.22 0 0 1 3 18.34a7.93 7.93 0 0 1-1-.06a11.57 11.57 0 0 0 6.29 1.85A11.59 11.59 0 0 0 20 8.45v-.53a8.43 8.43 0 0 0 2-2.12z",fill:"currentColor"}})])},pr=[],gr={},fr=Object(Ae["a"])(gr,mr,pr,!1,null,null,null),vr=fr.exports,wr=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("svg",{attrs:{viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M9 9c1.29 0 2.5.41 3.47 1.11L17.58 5H13V3h8v8h-2V6.41l-5.11 5.09c.7 1 1.11 2.2 1.11 3.5a6 6 0 0 1-6 6a6 6 0 0 1-6-6a6 6 0 0 1 6-6m0 2a4 4 0 0 0-4 4a4 4 0 0 0 4 4a4 4 0 0 0 4-4a4 4 0 0 0-4-4z",fill:"currentColor"}})])},br=[],kr={},yr=Object(Ae["a"])(kr,wr,br,!1,null,null,null),_r=yr.exports,xr=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("svg",{attrs:{viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M12 4a6 6 0 0 1 6 6c0 2.97-2.16 5.44-5 5.92V18h2v2h-2v2h-2v-2H9v-2h2v-2.08c-2.84-.48-5-2.95-5-5.92a6 6 0 0 1 6-6m0 2a4 4 0 0 0-4 4a4 4 0 0 0 4 4a4 4 0 0 0 4-4a4 4 0 0 0-4-4z",fill:"currentColor"}})])},Cr=[],$r={},Sr=Object(Ae["a"])($r,xr,Cr,!1,null,null,null),Tr=Sr.exports,Ir=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"artist-info-tag"},[i("div",{staticClass:"artist-info-tag__content"},[e._v(e._s(e.content))])])},Or=[],Er={props:["content"]},Lr=Er,zr=Object(Ae["a"])(Lr,Ir,Or,!1,null,null,null),Wr=zr.exports,jr=Lt(),Dr=/\s?\((.+)\)/,Mr={name:"Artist.ArtistDetail",props:{artistId:String},components:{Website:hr,Twitter:vr,ArtistInfoTag:Wr,Male:_r,Female:Tr},mixins:[Vs],data:function(){return{artist:null,name:"",comment:"",totalIllusts:0,totalManga:0,totalNovel:0,loaded:!1,websiteUrl:"",twitterUrl:"",gender:"",region:"",headPicSource:null,isMobile:document.documentElement.clientWidth<=767}},mounted:function(){this.fetchDetail()},computed:{avatar:function(){return this.artist?this.artist.user.profile_image_urls.medium.replace("i.pximg.net","i.pixiv.re"):""},avatarHeadPicStyle:function(){return this.headPicSource?{backgroundImage:"url(".concat(this.headPicSource,")")}:null},avatarPicStyle:function(){if(this.avatar)return{backgroundImage:"url(".concat(this.avatar,")")}},formattedRegion:function(){if(!this.region)return"";var e=Dr.exec(this.region);return e?e[1]:this.region}},methods:{getApiPrefix:function(){if(!this.artistId)throw new Error("No artist id.");var e=parseInt(this.artistId,10),t=this.$config.api_prefix_list;return t[e%t.length]},fetchDetail:function(){var e=this,t=this.$store.state.artist.map[this.artistId];if(t)return this.artist=t,void this.afterLoad();this.artistId&&this.axios.get("".concat(this.getApiPrefix(),"/member"),{params:{id:this.artistId}}).then((function(t){200===t.status&&t.data?(e.artist=t.data,e.$store.commit("artist/setMapItem",{id:e.artistId,content:e.artist}),e.afterLoad()):e.$emit("failed")}))},afterLoad:function(){var e=this.artist.profile;if(e){this.totalIllusts=e.total_illusts,this.totalManga=e.total_manga,this.totalNovel=e.total_novels,this.websiteUrl=e.webpage,this.twitterUrl=e.twitter_url,this.gender=e.gender,this.region=e.region,e.is_using_custom_profile_image&&e.background_image_url&&(this.headPicSource=e.background_image_url.replace("i.pximg.net","i.pixiv.re"));var t=this.artist.user;this.name=t.name,this.comment=this.checkComment(t.comment||"")?t.comment:"",this.loaded=!0,this.$emit("loaded",this.name)}else this.$emit("failed")},checkComment:function(e){if(!e)return!0;var t=jr.reduce((function(i,n){return i||(t||e.includes(n))}),!1);return!t},getComment:function(){return this.comment},copyLink:function(){rr["a"](window.location.href),this.$notify({title:"",position:"top-right",customClass:"oneline-notice-container",dangerouslyUseHTMLString:!0,duration:2e3,message:'<div class="oneline-notice"><span data-name="oneline-notice">画师链接已复制到剪贴板~</span></div>'})},openTwitter:function(){window.isSafari?window.location.href=this.twitterUrl:window.open(this.twitterUrl,"_blank")},openWebsite:function(){window.isSafari?window.location.href=this.websiteUrl:window.open(this.websiteUrl,"_blank")}}},Rr=Mr,Ar=Object(Ae["a"])(Rr,or,sr,!1,null,null,null),Pr=Ar.exports,Fr={name:"Artist",components:{Waterfall:Bn,BackToTop:Kn,ArtistDetail:Pr,Overlay:es},data:function(){return{page:this.initPage(),images:this.initImages(),profileBg:"",id:this.$route.params.id,artistName:null,infoLoaded:!1,infoLoadFailed:!1,waterfallIdentifier:Math.round(100*Math.random()),screenWidth:document.documentElement.clientWidth,cardWidth:this.getCardWidth(document.documentElement.clientWidth),waterfallResponsive:document.documentElement.clientWidth>767,scrollTop:0,iPadStyle:/iPad/i.test(navigator.userAgent)}},watch:{screenWidth:function(e){var t=this;this.resizeTimer&&clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout((function(){t.screenWidth=e,t.scrollTop=document.documentElement.scrollTop,t.screenWidth<=767?t.waterfallResponsive=!1:t.waterfallResponsive=!0,t.$nextTick((function(){t.cardWidth=t.getCardWidth(t.screenWidth),document.documentElement.scrollTop=t.scrollTop}))}),300)}},computed:{mobileWaterfallWidth:function(){return 2*this.cardWidth+32},artistBgStyle:function(){return this.profileBg?{backgroundImage:"url('".concat(this.profileBg,"')")}:null}},mounted:function(){var e=this;this.$store.commit("artist/setId",this.id),this.$nextTick((function(){window.addEventListener("resize",e.windowResized,!1),window.addEventListener("scroll",e.handleScroll,!1)}));var t=parseInt(this.$cookies.get("artist-scroll"),10);this.images.length>0?t&&this.$nextTick((function(){window.scrollTo(0,t),t>300&&e.$refs.backToTop&&e.$refs.backToTop.display()})):this.$cookies.set("artist-scroll",0,"1h"),this.artistName?document.title="".concat(this.artistName," - Pixiviz"):document.title="画师".concat(this.id||""," - Pixiviz"),this.setOgTagData();var i=window.localStorage.getItem("pic-routes"),n=i&&JSON.parse(i)||[];if(n&&n.length>0){var a=n.pop();"artist"===a.type&&a.from===this.id&&(n.mtime=Date.now(),window.localStorage.setItem("pic-routes",JSON.stringify(n)))}},beforeDestroy:function(){window.removeEventListener("resize",this.windowResized,!1),window.removeEventListener("scroll",this.handleScroll,!1)},methods:{initPage:function(){var e=this.$store.state.artist.page[this.$route.params.id];return e||1},initImages:function(){var e=this.$store.state.artist.images[this.$route.params.id];return e||[]},getApiPrefix:function(){if(!this.id)throw new Error("No artist id.");var e=parseInt(this.id,10),t=this.$config.api_prefix_list;return t[e%t.length]},infiniteHandler:function(e){var t=this;this.id?this.axios.get("".concat(this.getApiPrefix(),"/member_illust"),{params:{id:this.id,page:this.page}}).then((function(i){if(i.data.illusts)if(0!==i.data.illusts.length){var n=Rt(i.data.illusts,!1,!1);t.images=t.images.concat(n),t.$store.commit("artist/setImages",{id:t.id,images:t.images}),t.$refs.waterfall&&(t.$refs.waterfall.firstLoad=!1),t.page+=1,t.$store.commit("artist/setPage",{id:t.id,page:t.page}),e.loaded()}else e.complete();else e.complete()}),(function(){e.complete()})):e.complete()},handleCardClicked:function(e){var t=window.pixiviz.infoMap[e];t&&this.$store.commit("imageCache/setCache",t);var i=window.localStorage.getItem("pic-routes"),n=i&&JSON.parse(i)||[];n.push({type:"artist",from:this.id}),n.mtime=Date.now(),window.localStorage.setItem("pic-routes",JSON.stringify(n)),this.$router.push("/pic/".concat(e))},handleInfoLoaded:function(e){this.infoLoaded=!0,this.artistName=e,document.title="".concat(e," - Pixiviz"),this.setOgTagData()},handleLoadFailed:function(){this.infoLoaded=!0,this.infoLoadFailed=!0},setProfileBg:function(e){this.profileBg=e},handleBack:function(){var e=window.localStorage.getItem("pic-routes"),t=e&&JSON.parse(e)||[];if(t.length<1)this.$router.push("/");else{var i=t.pop();if("pic"===i.type){t.mtime=Date.now(),window.localStorage.setItem("pic-routes",JSON.stringify(t));var n=window.pixiviz.infoMap[i.from];n&&this.$store.commit("imageCache/setCache",n),this.$router.push("/pic/".concat(i.from))}else"usearch"===i.type?(t.mtime=Date.now(),window.localStorage.setItem("pic-routes",JSON.stringify(t)),this.$router.push("/usearch/".concat(i.keyword))):(window.localStorage.removeItem("pic-routes"),this.$router.push("/"))}},handleScroll:function(){this.$cookies.set("artist-scroll",document.documentElement.scrollTop,"1h")},windowResized:function(){this.screenWidth=document.documentElement.clientWidth},getCardWidth:function(e){return da.getCardWidth(e)},setOgTagData:function(){var e;this.$refs.detail&&(e=this.$refs.detail.getComment()),ma(ha(),{ogTitle:this.artistName?"".concat(this.artistName," - Pixiviz"):"画师".concat(this.id||""," - Pixiviz"),ogDesc:e?e.length>50?e.substr(0,50):e:"二次元插画分享，跨次元链接，就在 Pixiviz",ogUrl:window.location.href,ogImage:"".concat(this.$config.website_url,"/favicon.png")})}}},Nr=Fr,Ur=Object(Ae["a"])(Nr,nr,ar,!1,null,null,null),Hr=Ur.exports,Br=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"history"},[i("div",{staticClass:"history-header"},[i("div",{staticClass:"history-header-title"},[i("span",[e._v("历史记录")]),i("span",{staticClass:"history-header-title--small"},[e._v("（您最近浏览的 100 个作品）")]),i("div",{staticClass:"history-header-close"},[e.showEmpty?e._e():i("i",{staticClass:"el-icon-delete",on:{click:e.clearHistory}}),i("i",{staticClass:"el-icon-close",on:{click:e.handleBack}})])])]),i("div",{staticClass:"history-body"},[e.showEmpty?i("div",{staticClass:"history-body-empty"},[e._m(0)]):i("div",{staticClass:"waterfall-wrapper"},[i("Waterfall",{key:e.waterfallResponsive+"_"+e.waterfallKey,ref:"waterfall",class:{"waterfall-responsive":e.waterfallResponsive},style:e.waterfallResponsive?null:{width:e.mobileWaterfallWidth+"px"},attrs:{images:e.images,cardWidth:e.cardWidth,imageType:"medium"},on:{"card-clicked":e.handleCardClicked}}),i("p",{staticClass:"waterfall-end"},[e._v("没有更多记录了")])],1)]),i("BackToTop",{ref:"backToTop"})],1)},qr=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",[i("span",[e._v("这里还没有历史记录")]),i("span",{staticClass:"mobile-hide"},[e._v("，")]),i("span",[e._v("快去浏览你喜欢的作品吧~")])])}];function Vr(e){var t=this;e.isTrusted&&setTimeout((function(){t.getImages({bypass:!0})}))}var Gr={components:{Waterfall:Bn,BackToTop:Kn},data:function(){return{screenWidth:document.documentElement.screenWidth,cardWidth:da.getCardWidth(document.documentElement.clientWidth),waterfallResponsive:document.documentElement.clientWidth>767,waterfallKey:0,scrollTop:0,images:[]}},watch:{screenWidth:function(e){var t=this;this.resizeTimer&&clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout((function(){t.screenWidth=e,t.scrollTop=document.documentElement.scrollTop,t.screenWidth<=767?t.waterfallResponsive=!1:t.waterfallResponsive=!0,t.$nextTick((function(){t.cardWidth=da.getCardWidth(t.screenWidth),document.documentElement.scrollTop=t.scrollTop}))}),300)}},computed:{showEmpty:function(){return!this.images||!this.images.length},mobileWaterfallWidth:function(){return 2*this.cardWidth+32}},created:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$bus.$on("history-updated",e.getImages),window.BroadcastChannel&&(Ci=new BroadcastChannel("pixiviz-history"),Ci.onmessage=Vr.bind(e)),t.next=4,e.getImages();case 4:case"end":return t.stop()}}),t)})))()},mounted:function(){var e=this,t=parseInt(this.$cookies.get("user-history-scroll"),10);this.images.length>0?t&&this.$nextTick((function(){window.scrollTo(0,t),t>300&&e.$refs.backToTop&&e.$refs.backToTop.display()})):this.$cookies.set("user-history-scroll",0,"1h"),this.$nextTick((function(){window.addEventListener("resize",e.windowResized,!1),window.addEventListener("scroll",e.handleScroll,!1)})),document.title="历史记录 - Pixiviz"},beforeDestroy:function(){this.$bus.$off("history-updated",this.getImages),Ci&&Ci.close(),window.removeEventListener("scroll",this.handleScroll,!1),window.removeEventListener("resize",this.windowResized,!1)},methods:{getImages:function(){var e=arguments,t=this;return Object(n["a"])(regeneratorRuntime.mark((function i(){var n,a,o,s;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(n=e.length>0&&void 0!==e[0]?e[0]:{},a=n.bypass,o=void 0!==a&&a,!t.images.length){i.next=7;break}return t.images=[],t.waterfallKey+=1,t.$forceUpdate(),t.$nextTick((function(){t.getImages({bypass:o})})),i.abrupt("return");case 7:return i.next=9,ei({bypass:o});case 9:s=i.sent,t.images=s||[],t.$forceUpdate();case 13:case"end":return i.stop()}}),i)})))()},handleCardClicked:function(e){this.$cookies.set("pic-from","history","1h");var t=window.pixiviz.infoMap[e];t&&this.$store.commit("imageCache/setCache",t),this.$router.push("/pic/".concat(e))},handleBack:function(){this.$router.push("/")},handleScroll:function(){this.$cookies.set("user-history-scroll",document.documentElement.scrollTop,"1h")},windowResized:function(){this.screenWidth=document.documentElement.clientWidth},clearHistory:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=null===(i=e.pixland)||void 0===i?void 0:i.isLogin(),t.prev=1,t.next=4,e.$confirm("您确定要清空历史记录吗？被清空的记录将无法恢复".concat(n?"（已经同步到云端的记录将被一并清空）":""),"确认");case 4:t.next=9;break;case 6:return t.prev=6,t.t0=t["catch"](1),t.abrupt("return");case 9:ri(),n&&wi(),e.images=[],e.$forceUpdate();case 13:case"end":return t.stop()}}),t,null,[[1,6]])})))()}}},Yr=Gr,Jr=Object(Ae["a"])(Yr,Br,qr,!1,null,null,null),Qr=Jr.exports,Kr=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"collection"},[i("div",{staticClass:"collection-header"},[i("div",{staticClass:"collection-header-title"},[i("div",{staticClass:"collection-header-title__left"},[i("span",[e._v("收藏夹")]),i("span",{staticClass:"count-limit"},[e._v("已用栏位 "+e._s(e.existedCount)+"/"+e._s(e.COLLECTION_SIZE_LIMIT))])]),i("div",{staticClass:"collection-header-close"},[i("i",{staticClass:"el-icon-close",on:{click:e.handleBack}})])])]),i("div",{staticClass:"collection-body"},[e.showEmpty&&!e.collectionLoading?i("div",{staticClass:"collection-body-empty"},[e._m(0)]):e._e(),e.collectionLoading?i("div",{staticClass:"collection-body-empty collection-body-loading-wrapper"},[i("span",[e._v("稍等一下喵，正在寻找收藏夹的数据~")]),e._m(1)]):e._e(),e.showEmpty||e.collectionLoading?e._e():i("div",{staticClass:"waterfall-wrapper"},[i("Waterfall",{key:e.waterfallResponsive+"_"+e.waterfallKey,ref:"waterfall",class:{"waterfall-responsive":e.waterfallResponsive},style:e.waterfallResponsive?null:{width:e.mobileWaterfallWidth+"px"},attrs:{imageType:"medium",images:e.images,cardWidth:e.cardWidth,isCollection:!0},on:{"card-clicked":e.handleCardClicked,"card-removed":e.handleCardRemoved}}),i("p",{staticClass:"waterfall-end"},[e.existedCount<e.COLLECTION_SIZE_LIMIT?[e._v("没有更多收藏了，快去寻找一些你喜欢的画作吧~")]:[e._v("收藏夹看起来装不下更多画作了，先整理一下吧~")]],2)],1)]),i("BackToTop",{ref:"backToTop"})],1)},Xr=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",[i("span",[e._v("您尚未收藏任何作品")]),i("span",{staticClass:"mobile-hide"},[e._v("，")]),i("span",[e._v("快去浏览你喜欢的作品吧~")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"collection-body-loading"},[i("i",{staticClass:"loading-spiral",attrs:{spinner:"spiral"}})])}],Zr={components:{Waterfall:Bn,BackToTop:Kn},data:function(){return{screenWidth:document.documentElement.screenWidth,cardWidth:da.getCardWidth(document.documentElement.clientWidth),waterfallResponsive:document.documentElement.clientWidth>767,waterfallKey:0,scrollTop:0,images:[],existedCount:0,notFirstUse:"true"===window.localStorage.getItem("pixiviz-user-collect-first-entry"),currentCategory:"default",collectionLoading:!1,syncStatus:"",COLLECTION_SIZE_LIMIT:At}},watch:{screenWidth:function(e){var t=this;this.resizeTimer&&clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout((function(){t.screenWidth=e,t.scrollTop=document.documentElement.scrollTop,t.screenWidth<=767?t.waterfallResponsive=!1:t.waterfallResponsive=!0,t.$nextTick((function(){t.cardWidth=da.getCardWidth(t.screenWidth),document.documentElement.scrollTop=t.scrollTop}))}),300)}},computed:{showEmpty:function(){return!this.images||!this.images.length},mobileWaterfallWidth:function(){return 2*this.cardWidth+32}},created:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.collectionLoading=!0,t.prev=1,t.next=4,e.getImages();case 4:t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](1),console.error(t.t0);case 9:return t.prev=9,e.collectionLoading=!1,t.finish(9);case 12:null!==(i=e.pixland)&&void 0!==i&&i.isLogin&&e.syncRemoteData(!0);case 13:case"end":return t.stop()}}),t,null,[[1,6,9,12]])})))()},mounted:function(){var e=this,t=parseInt(this.$cookies.get("user-collection-scroll"),10);this.images.length>0?t&&this.$nextTick((function(){window.scrollTo(0,t),t>300&&e.$refs.backToTop&&e.$refs.backToTop.display()})):this.$cookies.set("user-collection-scroll",0,"1h"),this.$nextTick((function(){window.addEventListener("resize",e.windowResized,!1),window.addEventListener("scroll",e.handleScroll,!1)})),document.title="收藏夹 - Pixiviz",this.notFirstUse||(this.$notify({title:"",position:"top-right",customClass:"oneline-notice-container",dangerouslyUseHTMLString:!0,duration:1e4,message:'\n          <div class="oneline-notice">\n            <span data-name="notice-download">欢迎使用收藏夹，目前您可以在此收藏最多500个作品。收藏夹同步正在开发中，敬请期待~</span>\n          </div>'}),window.localStorage.setItem("pixiviz-user-collect-first-entry",!0))},beforeDestroy:function(){window.removeEventListener("scroll",this.handleScroll,!1),window.removeEventListener("resize",this.windowResized,!1)},methods:{getImages:function(){var e=arguments,t=this;return Object(n["a"])(regeneratorRuntime.mark((function i(){var n,a,o,s;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(n=e.length>0&&void 0!==e[0]?e[0]:{},a=n.bypass,o=void 0!==a&&a,!t.images.length){i.next=7;break}return t.images=[],t.waterfallKey+=1,t.$forceUpdate(),t.$nextTick((function(){t.getImages({bypass:o})})),i.abrupt("return");case 7:return i.next=9,Ht({bypass:o});case 9:if(i.t0=i.sent,i.t0){i.next=12;break}i.t0={};case 12:s=i.t0,t.existedCount=Object.keys(s).reduce((function(e,t){return Array.isArray(s[t])?e+s[t].length:e}),0)||0,t.images=s[t.currentCategory]||[],t.$forceUpdate();case 16:case"end":return i.stop()}}),i)})))()},handleCardClicked:function(e){this.$cookies.set("pic-from","collection","1h");var t=window.pixiviz.infoMap[e];t&&this.$store.commit("imageCache/setCache",t),this.$router.push("/pic/".concat(e))},handleCardRemoved:function(e){var t;Vt(this.currentCategory,e);var i=this.images.findIndex((function(t){return t.id===e}));i>=0&&this.images.splice(i,1),this.$message.success("已取消收藏该作品"),this.waterfallKey+=1,this.$forceUpdate(),null!==(t=this.pixland)&&void 0!==t&&t.isLogin&&this.syncRemoteData()},retrySync:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.syncRemoteData(!0);case 2:case"end":return t.stop()}}),t)})))()},syncRemoteData:function(){var e=arguments,t=this;return Object(n["a"])(regeneratorRuntime.mark((function i(){var n,a,o;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return n=e.length>0&&void 0!==e[0]&&e[0],i.prev=1,t.syncStatus="syncing",i.next=5,_i({immediate:!0});case 5:t.syncStatus="done",i.next=12;break;case 8:i.prev=8,i.t0=i["catch"](1),console.error(i.t0),t.syncStatus="error";case 12:if(!n){i.next=25;break}return i.next=15,Ht();case 15:if(i.t1=i.sent,i.t1){i.next=18;break}i.t1={};case 18:if(a=i.t1,o=a[t.currentCategory]||[],JSON.stringify(o)!==JSON.stringify(t.images)){i.next=22;break}return i.abrupt("return");case 22:t.images=[],t.waterfallKey+=1,t.$nextTick((function(){t.images=Object(yt["a"])(o)}));case 25:case"end":return i.stop()}}),i,null,[[1,8]])})))()},handleBack:function(){this.$router.push("/")},handleScroll:function(){this.$cookies.set("user-collection-scroll",document.documentElement.scrollTop,"1h")},windowResized:function(){this.screenWidth=document.documentElement.clientWidth}}},ec=Zr,tc=Object(Ae["a"])(ec,Kr,Xr,!1,null,null,null),ic=tc.exports,nc=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},ac=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"anti-share"},[i("div",{staticClass:"anti-share-wrapper"},[i("div",{staticClass:"anti-share-title"},[i("p",[e._v("我们拒绝营销号以营利为目的")]),i("p",{staticStyle:{"margin-bottom":"3rem"}},[e._v("对我们进行宣传、导流")]),i("p",[e._v("微信直链访问已全面屏蔽")]),i("p",[e._v("请自行寻找其他访问方式")])]),i("div",{staticClass:"anti-share-footer"},[i("p",[e._v("Pixiviz 站务 - 2022.4")])])])])}],oc={name:"AntiShare",mounted:function(){document.title="Anti Share - Pixiviz"}},sc=oc,rc=Object(Ae["a"])(sc,nc,ac,!1,null,null,null),cc=rc.exports,lc=function(){var e=this,t=this,i=t.$createElement,n=t._self._c||i;return t.loadError?n("div",{staticClass:"sponsor-error"},[n("div",{staticClass:"sponsor-error-main"},[t._m(1),t._m(2),n("div",{staticClass:"sponsor-error-main__action"},[n("el-button",{attrs:{type:"primary",round:""},on:{click:t.handleBack}},[t._v("返回主页")])],1)])]):n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"sponsor-container",attrs:{"element-loading-text":"数据加载中..."}},[t.loading?t._e():n("div",{staticClass:"sponsor"},[n("div",{staticClass:"sponsor-header"},[n("Battery",{staticClass:"sponsor-header__icon"}),n("p",{staticClass:"sponsor-header__title"},[t._v("感谢发电")]),n("i",{staticClass:"el-icon-close sponsor-header__close",on:{click:t.handleBack}})],1),n("div",{staticClass:"sponsor-amount"},[n("div",{staticClass:"sponsor-amount-item"},[n("div",{staticClass:"sponsor-amount-item__title"},[t._v(" 上月发电 ")]),n("div",{staticClass:"sponsor-amount-item__num"},[n("span",{staticClass:"number"},[t._v(t._s(t.lastMonthAmount)),n("span",{staticClass:"unit"},[t._v("kWh")])])])]),n("div",{staticClass:"sponsor-amount-item"},[n("div",{staticClass:"sponsor-amount-item__title"},[t._v(" 本月发电 ")]),n("div",{staticClass:"sponsor-amount-item__num"},[n("span",{staticClass:"number"},[t._v(t._s(t.currentMonthAmount)+" "),n("span",{staticClass:"unit"},[t._v("kWh")])])])]),n("div",{staticClass:"sponsor-amount-item"},[n("div",{staticClass:"sponsor-amount-item__title"},[t._v(" 总发电量 ")]),n("div",{staticClass:"sponsor-amount-item__num"},[n("span",{staticClass:"number"},[t._v(t._s(t.totalAmount)),n("span",{staticClass:"unit"},[t._v("kWh")])])])])]),n("div",{staticClass:"sponsor-list"},[t.topSponsors.length?n("div",{class:{"sponsor-list__top":!0,"sponsor-list__top--no-normal":!t.normalSponsors.length}},t._l(t.topSponsors,(function(e){return n("Sponsor",{key:e.user_id,attrs:{sponsor:e,type:"top"}})})),1):t._e(),t.normalSponsors.length?n("div",{class:{"sponsor-list__normal":!0,"sponsor-list__normal--no-top":!t.topSponsors.length}},t._l(t.normalSponsors,(function(e){return n("Sponsor",{key:e.user_id,attrs:{sponsor:e,type:"normal"}})})),1):t._e(),t.topSponsors.length||t.normalSponsors.length?t._e():n("div",{staticClass:"sponsor-list__placeholder"},[n("span",[t._v("本月暂无发电")])])]),n("div",{staticClass:"sponsor-footer"},[t._m(0),n("div",{staticClass:"sponsor-footer__desc"},[n("p",[n("span",{staticClass:"mobile-hide"},[t._v("数据每小时更新，最后")]),t._v("更新于 "+t._s(t.lastUpdateTime))])]),n("div",{staticClass:"sponsor-footer__op"},[n("span",{on:{click:function(){return e.showDesc=!0}}},[t._v("说明")]),n("span",{on:{click:t.openAfdian}},[t._v("点我发电")]),n("span",{on:{click:function(){return e.showAll=!0}}},[t._v("所有发电员")])])]),t.loadError?n("Overlay",{attrs:{text:"发电数据加载失败"}}):t._e()],1),n("el-dialog",{staticClass:"dialog dialog-sponsor-desc",attrs:{width:"780px",title:"发电说明",visible:t.showDesc},on:{"update:visible":function(e){t.showDesc=e}}},[n("pre",{domProps:{innerHTML:t._s(t.sponsorDesc)}}),n("pre",{staticClass:"dialog-sponsor-desc__footer"},[t._v("Pixiviz 站务")])]),n("el-dialog",{staticClass:"dialog dialog-sponsor-all",attrs:{top:"24px","append-to-body":"",title:"所有发电员",visible:t.showAll},on:{"update:visible":function(e){t.showAll=e}}},[t.allSponsorLoading||t.allSponsorLoadError?n("div",{staticClass:"all-sponsor__load"},[n("span",[t._v(t._s(t.allSponsorLoadText))])]):n("div",{staticClass:"all-sponsor"},t._l(t.allSponsors,(function(e){return n("Sponsor",{key:e.user_id,attrs:{sponsor:e,type:"all"}})})),1)])],1)},dc=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"sponsor-footer__text"},[i("p",[e._v("每一次发电对我们来说都是非常大的帮助~")]),i("p",[e._v("❤ 感谢大家的支持 ❤")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"sponsor-error-main__icon"},[i("i",{staticClass:"el-icon-warning-outline"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"sponsor-error-main__text"},[i("span",[e._v("赞助信息加载失败")])])}],uc=(i("b680"),i("710e")),hc=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("svg",{staticClass:"iconify iconify--ph",attrs:{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",width:"32",height:"32",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 256 256"}},[i("path",{attrs:{d:"M88 8a8 8 0 0 1 8-8h64a8 8 0 0 1 0 16H96a8 8 0 0 1-8-8zm120 48.008v152a24.026 24.026 0 0 1-24 24H72a24.026 24.026 0 0 1-24-24v-152a24.026 24.026 0 0 1 24-24h112a24.026 24.026 0 0 1 24 24zm-57.375 71.515a7.982 7.982 0 0 0-6.625-3.515l-20.188-.016l11.618-29.015a8 8 0 0 0-14.86-5.938l-16 39.984a8.001 8.001 0 0 0 7.43 10.97l20.188.015l-11.618 29.031a8 8 0 0 0 14.86 5.938l16-40a8.01 8.01 0 0 0-.805-7.454z",fill:"currentColor"}})])},mc=[],pc={},gc=Object(Ae["a"])(pc,hc,mc,!1,null,null,null),fc=gc.exports,vc=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:"sponsor-"+e.type},[i("div",{directives:[{name:"lazy-container",rawName:"v-lazy-container"}],class:"sponsor-"+e.type+"__avatar",style:e.avatar}),i("div",{staticClass:"sponsor-item-text"},[i("div",{class:"sponsor-"+e.type+"__name"},[e._v(e._s(e.sponsor.name))]),i("div",{class:"sponsor-"+e.type+"__price"},[i("span",{staticClass:"number"},[e._v(e._s("all"===e.type?e.sponsor.all_sum_amount:e.sponsor.current_plan_price))]),i("span",{staticClass:"unit"},[e._v("kWh")])])])])},wc=[],bc={props:{sponsor:{type:Object},type:{type:String}},computed:{avatar:function(){return"background-image: url(".concat(this.sponsor.avatar,"?imageView2/1/w/140/h/140);")}}},kc=bc,yc=Object(Ae["a"])(kc,vc,wc,!1,null,null,null),_c=yc.exports,xc="\n1. Pixiviz 为非营利性的网站，我们承诺获得的发电收入将完全投入到站点的维护与升级。\n2. 我们承诺在发电可以维持站点正常运作的情况下，不会在站内嵌入任何形式的广告或付费功能。\n3. 本页面所有数据来源于爱发电，本页面内 1 kWh = ￥1。\n4. 爱发电为我们的唯一发电渠道，所有发电款项均通过爱发电收集、统计、结算。\n5. 服务的每月固定支出和扩容所需支出均已公布在爱发电，支出数额为预估值，实际支出金额会有些许浮动。\n6. 由于站点支出项目较多且所用服务器付费模式复杂，受限于精力，支出明细将不会公开，请您理解。\n7. 为保护部分发电用户的隐私，我们会隐藏该用户的真实 ID。\n".trim(),Cc={components:{Battery:fc,Overlay:es,Sponsor:_c},data:function(){return{info:null,loading:!0,loadError:!1,allSponsors:[],allSponsorLoading:!0,allSponsorLoadError:!1,showDesc:!1,showAll:!1,sponsorDesc:xc}},watch:{showAll:{handler:function(e){e&&!this.allSponsor&&this.loadAllSponsor()}}},computed:{lastMonthAmount:function(){var e;return null!==(e=this.info)&&void 0!==e&&e.amount?parseFloat(this.info.amount.last_month).toFixed(2):""},currentMonthAmount:function(){var e;return null!==(e=this.info)&&void 0!==e&&e.amount?parseFloat(this.info.amount.current_month).toFixed(2):""},totalAmount:function(){var e;return null!==(e=this.info)&&void 0!==e&&e.amount?parseFloat(this.info.amount.total).toFixed(2):""},topSponsors:function(){var e,t;if(null===(e=this.info)||void 0===e||null===(t=e.sponsors)||void 0===t||!t.current)return[];try{var i;return null===(i=this.info.sponsors)||void 0===i?void 0:i.current.map((function(e){return Object(uc["isEmail"])(e.name)?Object(We["a"])(Object(We["a"])({},e),{},{name:"发电员#".concat(e.name.length>6?e.name.slice(0,6):e.name.slice(0,e.name.indexOf("@")))}):e})).filter((function(e){return e.current_plan_price>=50})).sort((function(e,t){return parseFloat(t.current_plan_price)-parseFloat(e.current_plan_price)}))}catch(n){return[]}},normalSponsors:function(){var e,t;if(null===(e=this.info)||void 0===e||null===(t=e.sponsors)||void 0===t||!t.current)return[];var i=this.topSponsors.map((function(e){return e.user_id}));try{var n;return null===(n=this.info.sponsors)||void 0===n?void 0:n.current.map((function(e){return Object(uc["isEmail"])(e.name)?Object(We["a"])(Object(We["a"])({},e),{},{name:"发电员#".concat(e.name.length>6?e.name.slice(0,6):e.name.slice(0,e.name.indexOf("@")))}):e})).filter((function(e){return!i.includes(e.user_id)})).sort((function(e,t){return parseFloat(t.current_plan_price)-parseFloat(e.current_plan_price)}))}catch(a){return[]}},lastUpdateTime:function(){return this.info?Ni()(this.info.last_update_time).format("YYYY-MM-DD HH:mm:ss"):""},allSponsorLoadText:function(){return this.allSponsorLoadError?"数据加载失败":this.allSponsorLoading?"数据加载中...":""}},created:function(){li(this.$config)?this.loadInfo():this.$router.replace("/404")},methods:{loadInfo:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.axios.get("".concat(e.$config.afdian_manage_api,"/current"));case 3:n=t.sent,t.next=11;break;case 6:return t.prev=6,t.t0=t["catch"](0),console.error("Failed to load current sponsors",t.t0),e.loadError=!0,t.abrupt("return");case 11:if(n&&200===n.status&&null!==(i=n.data)&&void 0!==i&&i.success){t.next=14;break}return e.loadError=!0,t.abrupt("return");case 14:e.$set(e,"info",n.data.data),e.loading=!1;case 16:case"end":return t.stop()}}),t,null,[[0,6]])})))()},loadAllSponsor:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.axios.get("".concat(e.$config.afdian_manage_api,"/allSponsors"));case 3:n=t.sent,t.next=11;break;case 6:return t.prev=6,t.t0=t["catch"](0),console.error("Failed to load all sponsors",t.t0),e.loadError=!0,t.abrupt("return");case 11:if(n&&200===n.status&&null!==(i=n.data)&&void 0!==i&&i.success){t.next=14;break}return e.allSponsorLoadError=!0,t.abrupt("return");case 14:e.$set(e,"allSponsors",n.data.data.sponsors.sort((function(e,t){var i=t.all_sum_amount-e.all_sum_amount;return 0!==i?i:e.first_pay_time-t.first_pay_time}))),e.allSponsorLoading=!1;case 16:case"end":return t.stop()}}),t,null,[[0,6]])})))()},openAfdian:function(){window.isSafari?window.location.href=this.$config.donate_url:window.open(this.$config.donate_url,"_blank")},handleBack:function(){this.$router.push("/")}}},$c=Cc,Sc=Object(Ae["a"])($c,lc,dc,!1,null,null,null),Tc=Sc.exports,Ic=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"container-notfound"},[i("div",{staticClass:"notfound-wrapper"},[e._m(0),i("div",{staticClass:"notfound-button"},[i("el-button",{attrs:{type:"primary",round:""},on:{click:e.goBack}},[e._v("返回之前的页面")])],1)])])},Oc=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"notfound-title"},[i("span",[e._v("啊，这里没有东西...")])])}],Ec={name:"NotFound",methods:{goBack:function(){window.history.go(-1)}},mounted:function(){document.title="404 - Pixiviz"}},Lc=Ec,zc=Object(Ae["a"])(Lc,Ic,Oc,!1,null,null,null),Wc=zc.exports,jc=zi["a"].prototype.push;zi["a"].prototype.push=function(e,t,i){return t||i?jc.call(this,e,t,i):jc.call(this,e).catch((function(e){return zi["a"].isNavigationFailure(e)?e:Promise.reject(e)}))},a["default"].use(zi["a"]);var Dc=[{path:"/",name:"Landing",component:xn,meta:{keepAlive:!1,ogTagsData:{ogTitle:"Pixiviz",ogDesc:"跨次元链接~，一个简单的二次元图片分享站",ogImage:"".concat(p.website_url,"/favicon.png"),ogUrl:"https://pixiviz.kanata.ml"}}},{path:"/rank",name:"Rank",component:wa,meta:{keepAlive:!0}},{path:"/pic/:id",name:"Pic",component:Es,meta:{keepAlive:!1}},{path:"/artist/:id",name:"Artist",component:Hr,meta:{keepAlive:!1}},{path:"/search/:keyword",name:"Search",component:Ns,meta:{keepAlive:!0}},{path:"/usearch/:keyword",name:"UserSearch",component:ir,meta:{keepAlive:!0}},{path:"/history",name:"History",component:Qr,meta:{keepAlive:!0,ogTagsData:{ogTitle:"浏览历史 - Pixiviz",ogDesc:"跨次元链接~，一个简单的二次元图片分享站",ogImage:"".concat(p.website_url,"favicon.png"),ogUrl:"".concat("https://pixiviz.kanata.ml","/history")}}},{path:"/collection",name:"Collection",component:ic,meta:{keepAlive:!0,ogTagsData:{ogTitle:"收藏夹 - Pixiviz",ogDesc:"跨次元链接~，一个简单的二次元图片分享站",ogImage:"".concat(p.website_url,"favicon.png"),ogUrl:"".concat("https://pixiviz.kanata.ml","/collection")}}},{path:"/sponsor",name:"Sponsor",component:Tc,meta:{keepAlive:!1,ogTagsData:{ogTitle:"感谢发电 - Pixiviz",ogDesc:"感谢每一位赞助了 Pixiviz 的用户",ogImage:"".concat(p.website_url,"favicon.png"),ogUrl:"".concat("https://pixiviz.kanata.ml","/sponsor")}}},{path:"/anti-share",name:"AntiShare",component:cc,meta:{keepAlive:!1,ogTagsData:{ogTitle:"AntiShare - Pixiviz",ogDesc:"阻止恶意分享",ogImage:"".concat(p.website_url,"favicon.png"),ogUrl:"".concat("https://pixiviz.kanata.ml","/anti-share")},ignoreShareToken:!0}},{path:"/404",name:"Page not found",component:Wc,meta:{ogTagsData:{ogTitle:"Not Found - Pixiviz",ogDesc:"跨次元链接~，一个简单的二次元图片分享站",ogImage:"".concat(p.website_url,"/favicon.png"),ogUrl:"https://pixiviz.kanata.ml",ignoreShareToken:!0}}},{path:"*",redirect:"/404"}],Mc=new zi["a"]({mode:"history",base:"/",routes:Dc});Mc.afterEach((function(e){if(window.pixiviz&&window.pixiviz.darkEnabled&&!window.pixiviz.darkPersist){var t=(new Date).getHours();t<6||t>=18?a["default"].prototype.$bus&&a["default"].prototype.$bus.$emit("dark-mode-enable"):document.documentElement.classList.contains("dark")&&a["default"].prototype.$bus&&a["default"].prototype.$bus.$emit("dark-mode-disable")}e.meta.ogTagsData&&ma(ha(),e.meta.ogTagsData)}));var Rc=Mc,Ac=i("8116"),Pc=i("4478"),Fc=(i("cb29"),i("820e"),i("a630"),i("6062"),i("61256")),Nc=i.n(Fc),Uc=function(e){var t,i=0,n=0,a=Math.random();for(t in e){if(i+=e[t],a<=i)return[t,n];n+=1}return[t,n]},Hc=["93981457","94162129","94041956","93932132","93882431","94050687","93514501","92391150","93647682","75966930"],Bc=("/illust?id=".concat(Hc[Date.now()%Hc.length]),"pixiviz-api-prefix"),qc=window.localStorage.getItem(Bc),Vc=function(e,t){if("object"===Object(bt["a"])(e)){var i=e.original||Object.keys(e);if(e.original||Object.defineProperty(e,"original",{value:Object(Pc["a"])(Array,Object(pt["a"])(i)),enumerable:!1,writable:!0,configurable:!0}),t&&Array.isArray(t)&&t.length){var n=t.filter((function(e){return i.includes(e)}));if(n.length===i.length)return window.localStorage.removeItem("pixiviz-proxy-disabled"),void Ct.$emit("proxy-not-available");i=i.filter((function(t){return!n.includes(t)||(delete e[t],!1)}));var a=0;i.forEach((function(t){a+=e[t]})),i.forEach((function(t){e[t]/=a}))}var o=[];i.forEach((function(t,i){Object.defineProperty(e,i,{value:t,enumerable:!1,writable:!0,configurable:!0});var n=100*e[t];o=o.concat(new Array(Math.floor(n)).fill(i))}));var s=100-o.length;if(s)for(var r=0;r<s;r++)o.push(0);var c=Nc()("pixiviz");o.sort((function(){return.5-c.quick()})),Object.defineProperty(e,"idxList",{value:o,enumerable:!1,writable:!0,configurable:!0})}},Gc=function(e,t){if(Array.isArray(e.api_prefix)){e.api_prefix_list=e.api_prefix;var i=t&&Array.isArray(t)&&t.length?e.api_prefix_list.filter((function(e){return!t.includes(e)})):e.api_prefix_list;if(qc&&i.includes(qc))return void(e.api_prefix=qc);var n=1/i.length,a={};i.forEach((function(e){a[e]=n}));var o=Uc(a),s=Object(wt["a"])(o,1),r=s[0];e.api_prefix=r,e.api_prefix_list=i,window.localStorage.setItem(Bc,r)}else window.localStorage.setItem(Bc,e.api_prefix)},Yc=i("9483");Object(Yc["a"])("".concat("/","service-worker.js")),a["default"].prototype.$sensitiveWords=Lt(),ee();var Jc=864e5;a["default"].prototype.pixland=$i,a["default"].config.productionTip=!1;var Qc=wn();a["default"].prototype.$config=Object.assign(p,Qc);var Kc=Object(Ac["b"])(Ac["a"],p);a["default"].prototype.axios=Kc,a["default"].prototype.$http=Kc,a["default"].use(r["a"],{observer:!0,observerOptions:{rootMargin:"0px",threshold:.1}}),a["default"].use(l.a),a["default"].use(m.a,{slots:{noResults:"这里没有图片...",noMore:"没有更多图片了..."}}),a["default"].use(s.a),a["default"].$cookies.config("7d"),a["default"].use(u.a,{useItem:!0,mobileSupport:!1});var Xc,Zc,el=window.localStorage.getItem("download-settings");if(el)try{a["default"].prototype.$downloadSettings=JSON.parse(el)}catch(ol){console.error("Cannot parse download settings.",ol)}else a["default"].prototype.$downloadSettings={singleFileName:"{title}-{id}",multiFileName:"{title}-{id}-{index}"};a["default"].prototype.$bus=Ct,a["default"].prototype.$idb=X,a["default"].prototype.$ogTags=ha();try{if(window.localStorage.getItem("pixiviz-api-disabled"),Xc){var tl=JSON.parse(Xc);(new Date).valueOf()-tl.time>=Jc?(Xc=[],window.localStorage.removeItem("pixiviz-api-disabled")):Xc=Xc.hosts}else Xc=[]}catch(ol){console.error("Failed to get disabled api host:",ol),Xc=[]}try{if(Zc=window.localStorage.getItem("pixiviz-proxy-disabled"),Zc){var il=JSON.parse(Zc);(new Date).valueOf()-il.time>=Jc?(Zc=[],window.localStorage.removeItem("pixiviz-proxy-disabled")):Zc=il.hosts}}catch(ol){console.error("Failed to get disabled proxy host:",ol),Zc=[]}var nl=function(){new a["default"]({router:Rc,store:Ee,render:function(e){return e(Li)},mounted:function(){document.dispatchEvent(new Event("render-event"))}}).$mount("#app")},al=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:Vc(p.image_proxy_host,Zc),Vc(p.download_proxy_host,Zc),Gc(p,Xc),nl();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();al()},6:function(e,t){},"6abf":function(e,t,i){},"6f27":function(e,t,i){},7:function(e,t){},"7dc5":function(e){e.exports=JSON.parse('{"website_url":"https://pixiviz.kanata.ml","public_proxy":"i.pixiv.re","image_proxy_host":"pximg.cocomi.cf","download_proxy_host":"pximg.cocomi.cf","remote_conf_url":"https://cfs.tigo.pwp.app/pixiviz-prod.json","api_prefix":["https://hibi.cocomi.cf/api/pixiv"],"guide_url":"https://blog.pwp.space/article/Pixiviz%E9%A3%9F%E7%94%A8%E6%8C%87%E5%8D%97.md","donate_url":"https://afdian.net/@backrunner","landing_bg_id":94067980,"trust_host":["pixiviz.kanata.ml"],"announcement_feed":"https://cfs.tigo.pwp.app/pixiviz-anno-prod.json","afdian_manage_api":"https://afdian-manage.pwp.app","show_guide":false,"show_donate":false,"check_announce":false,"maintain":{"enable":false}}')},"7ff8":function(e,t,i){},8:function(e,t){},"85ec":function(e,t,i){},8610:function(e,t,i){"use strict";i("7ff8")},"86b4":function(e,t,i){"use strict";i("af31")},9:function(e,t){},9624:function(e,t,i){},"974a":function(e,t,i){},a0bd:function(e,t,i){},a27f:function(e,t,i){i("ac1f"),i("466d"),i("d3b7"),i("3ca3"),i("ddb0"),i("2b3d"),i("9861"),i("d9e2"),Image.prototype.load=function(e){var t=this,i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(){if(4!==i.readyState||200!==i.status&&304!==i.status)t.failed=!0,"function"===typeof t.onerror&&t.onerror();else{var e=i.getAllResponseHeaders(),n=e.match(/^Content-Type:\s*(.*?)$/im),a=n[1]||"image/png",o=new Blob([i.response],{type:a});t.src=window.URL.createObjectURL(o),t.blob=o,t.blobLoaded=!0}},i.onprogress=function(e){t.percent=parseInt(e.loaded/e.total*100,10)},i.onloadstart=function(){t.percent=0},i.onloadend=function(){t.percent=100},i.onerror=function(){"function"===typeof t.onerror&&t.onerror()},t.xhrReq=i,i.send()},Image.prototype.getSize=function(e){return new Promise((function(t,i){var n=new XMLHttpRequest;n.open("HEAD",e,!0),n.onreadystatechange=function(){this.readyState===this.DONE&&t(parseInt(n.getResponseHeader("Content-Length"),10))},n.onerror=function(){i(new Error("Image head request failed."))},n.send()}))},Image.prototype.cancel=function(){this.xhrReq&&this.xhrReq.abort(),this.onload=function(){},this.onerror=function(){}},Image.prototype.percent=0},a4d1:function(e,t,i){},adbb:function(e,t,i){},af31:function(e,t,i){},b0d6:function(e){e.exports=JSON.parse("[]")},b265:function(e,t,i){},bbe2:function(e,t,i){},bd7d:function(e,t,i){},beef:function(e,t,i){},c4c2:function(e,t,i){},dfa3:function(e,t,i){}});